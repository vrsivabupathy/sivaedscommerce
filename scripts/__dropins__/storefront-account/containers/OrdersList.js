import{jsx as s,jsxs as f,Fragment as C}from"@dropins/tools/preact-jsx-runtime.js";import{classes as N,Slot as H}from"@dropins/tools/lib.js";import{S as m,c as B,E as K,C as V}from"../chunks/AddressFormWrapper.js";import"@dropins/tools/preact-compat.js";import{Card as F,Icon as z,ContentGrid as q,Image as Y,Header as J,Picker as R,Pagination as W}from"@dropins/tools/components.js";import{useText as x}from"@dropins/tools/i18n.js";import{useState as O,useEffect as I,useMemo as j,useCallback as P}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import{g as G}from"../chunks/getOrderHistoryList.js";import"../chunks/removeCustomerAddress.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact.js";const E={size:"32",stroke:"2"},T=({minifiedView:c,orderNumber:r,orderToken:t,routeOrdersList:e,routeOrderDetails:n})=>{const i=c?"minifiedView":"fullSizeView",l=x({viewAllOrdersButton:`Account.${i}.OrdersList.viewAllOrdersButton`,ariaLabelLink:`Account.${i}.OrdersList.ariaLabelLink`});return e?s("a",{className:N(["account-orders-list-action",["account-orders-list-action--minifiedView",c]]),"data-testid":"ordersListActionButtonMinifiedView",href:e(),children:s(F,{"data-testid":"ordersListActionMinifiedView",variant:"secondary",children:f("div",{className:"account-orders-list-action__card-wrapper",children:[s("p",{children:l.viewAllOrdersButton}),s(z,{source:m,...E})]})})}):s("a",{"aria-label":`${l.ariaLabelLink} ${r??t}`,href:B(n)?n(r,t):"#",className:"account-orders-list-action","data-testid":"ordersListActionButton",children:s(z,{source:m,...E})})},U=()=>{const[c,r]=O(window.innerWidth<768);return I(()=>{const t=()=>{r(window.innerWidth<768)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[]),c},Q=({minifiedView:c,item:r,withThumbnails:t,children:e,slots:n,routeTracking:i,routeOrderProduct:l,...A})=>{var h,y,_,w,$,b;const L=c?"minifiedView":"fullSizeView",p=x({orderNumber:`Account.${L}.OrdersList.OrdersListCard.orderNumber`,itemsAmount:`Account.${L}.OrdersList.OrdersListCard.itemsAmount`,carrier:`Account.${L}.OrdersList.OrdersListCard.carrier`,deliveryDateText:`Account.${L}.OrdersList.OrdersListCard.orderDate`}),o=U(),u=B(l);return f(F,{variant:"secondary",...A,className:N(["account-orders-list-card",["account-orders-list-card--full",((h=r==null?void 0:r.items)==null?void 0:h.length)>6]]),children:[s("div",{className:"account-orders-list-card__content",children:n!=null&&n.OrdersListCard?s(H,{"data-testid":`ordersListCard${r.id}`,name:"OrdersListCard",slot:n==null?void 0:n.OrdersListCard,context:{orderHistoryListItem:r}}):f(C,{children:[s("div",{children:r==null?void 0:r.status}),f("p",{children:[p.deliveryDateText," ",r==null?void 0:r.orderDate]}),f("p",{children:[p.orderNumber," ",r.number]}),(y=r==null?void 0:r.shipments)==null?void 0:y.map(a=>{var g;return(g=a==null?void 0:a.tracking)==null?void 0:g.map(d=>f("p",{"data-testid":d.number,children:[s("span",{children:`${p.carrier} ${d.carrier.toLocaleUpperCase()} `}),s("a",{href:(i==null?void 0:i(d))??"",className:"account-orders-list-card__content--track_number",children:d.number})]},a.id))}),f("p",{children:["$",(_=r==null?void 0:r.total)==null?void 0:_.grandTotal.value]}),f("p",{"data-testid":"itemsAmount",children:[((w=r==null?void 0:r.items)==null?void 0:w.length)??0," ",p.itemsAmount]}),($=r==null?void 0:r.items)==null?void 0:$.map((a,g)=>{if(g>=0&&g<10)return f("p",{className:"account-orders-list-card__content--product-name",children:[f("span",{className:"account-orders-list-card__content--quantity",children:[(a==null?void 0:a.quantityOrdered)>1?a==null?void 0:a.quantityOrdered:null," "]}),a==null?void 0:a.productName.replaceAll("-"," ")]},`${g}_${a.id}`);if(g===11)return s("p",{children:"..."},"ellipsis")})]})}),t&&((b=r==null?void 0:r.items)!=null&&b.length)?s(q,{maxColumns:o?3:9,emptyGridContent:s(C,{}),className:N(["account-orders-list-card__images",["account-orders-list-card__images-3",o]]),"data-testid":"ordersListCardImages",children:r.items.map((a,g)=>{var v;const d=(v=a==null?void 0:a.product)==null?void 0:v.smallImage.url,D=a==null?void 0:a.productName;return u?s("a",{href:l==null?void 0:l(a),target:"_blank",rel:"noreferrer",children:s(Y,{src:d,width:65,height:65,alt:D})},a.id+g):s(Y,{src:d,width:65,height:65,alt:D},a.id+g)})}):null,s("div",{className:"account-orders-list-card__actions",children:e})]})},X=({ordersInMinifiedView:c,minifiedView:r,pageSize:t,selectedDate:e,selectedPage:n,handleSetFirstOrderDate:i})=>{const[l,A]=O([]),[L,p]=O({totalPages:1,currentPage:1,pageSize:1}),[o,u]=O(!1);return I(()=>{u(!0),G(r?c:t,e,n).then(h=>{!h||!h.items||(p(h.pageInfo),A(h.items),i==null||i(h.dateOfFirstOrder))}).finally(()=>{u(!1)})},[i,r,c,t,e,n]),{loading:o,orderHistoryListItems:l,pageInfo:L}},M=(c,r=1)=>{const t=new Date,e=new Date(t);switch(c){case"sixMonthsAgo":{e.setMonth(e.getMonth()-r);break}case"oneYearAgo":{e.setFullYear(e.getFullYear()-r);break}default:return""}return{from:e==null?void 0:e.toISOString().split("T")[0],to:`${t==null?void 0:t.toISOString().split("T")[0]} 23:59:59`}},Z=c=>{const r=[],t=new Date().getFullYear();for(let e=c;e<=t-1;e++)r.push({value:`{"from":"${e}-01-01","to":"${e+1}-01-01 23:59:59"}`,text:e.toString()});return r},rr=()=>{const c=x({pastSixMonths:"Account.fullSizeView.OrdersList.OrdersListSelectDate.pastSixMonths",currentYear:"Account.fullSizeView.OrdersList.OrdersListSelectDate.currentYear",viewAll:"Account.fullSizeView.OrdersList.OrdersListSelectDate.viewAll"}),[r,t]=O(),[e,n]=O(JSON.stringify(M("sixMonthsAgo",6))),[i,l]=O(1);I(()=>{window==null||window.scrollTo({top:100,behavior:"smooth"})},[i]);const A=j(()=>{const o=[{value:JSON.stringify(M("sixMonthsAgo",6)),text:c.pastSixMonths},{value:JSON.stringify(M("oneYearAgo",1)),text:c.currentYear},{value:"viewAll",text:c.viewAll}];if(r){const h=new Date(r).getFullYear();o==null||o.splice(2,0,...Z(h))}return o},[c,r]),L=P(o=>{t(o)},[]),p=P(o=>{const h=o.target.value;n(h),l(1)},[]);return{selectableDateList:A,selectedDate:e,selectedPage:i,handleSelectDate:p,setSelectedPage:l,handleSetFirstOrderDate:L}},tr=({className:c,withHeader:r=!0,minifiedView:t=!1,withThumbnails:e=!0,withFilter:n=!0,ordersInMinifiedView:i=1,pageSize:l=10,routeOrdersList:A,routeOrderDetails:L,routeTracking:p,routeOrderProduct:o,slots:u})=>{const y=x({containerTitle:`Account.${t?"minifiedView":"fullSizeView"}.OrdersList.containerTitle`}),{selectableDateList:_,selectedDate:w,handleSelectDate:$,selectedPage:b,setSelectedPage:a,handleSetFirstOrderDate:g}=rr(),{pageInfo:d,loading:D,orderHistoryListItems:v}=X({minifiedView:t,pageSize:l,ordersInMinifiedView:i,selectedDate:w,selectedPage:b,handleSetFirstOrderDate:g});return f("div",{children:[r?s(J,{"aria-label":y.containerTitle,role:"region",title:y.containerTitle,divider:!t,className:t?"account-orders-list-header":""}):null,f("div",{className:N(["account-orders-list",c]),children:[!t&&n?s("div",{className:"account-orders-list__date-select",children:s(R,{value:w,name:"orderDatePicker",options:_,handleSelect:$})}):null,D?s(C,{children:Array.from(Array(d==null?void 0:d.pageSize).keys()).map(S=>s(V,{testId:"orderSkeletonLoader",withCard:!1},S))}):s(C,{children:v.length?s(C,{children:v.map((S,k)=>s(Q,{routeTracking:p,routeOrderProduct:o,minifiedView:t,item:S,withThumbnails:e,slots:u,children:u!=null&&u.OrdersListAction?s(H,{"data-testid":`ordersListActionSlot_${k}`,name:"OrdersListAction",slot:u==null?void 0:u.OrdersListAction,context:{orderHistoryListItem:S}}):s(T,{minifiedView:t,orderNumber:S.number,orderToken:S.token,routeOrderDetails:L})},k))}):s(K,{isEmpty:!v.length,typeList:"orders",minifiedView:t})}),!t&&(d==null?void 0:d.totalPages)>1?s(W,{totalPages:d==null?void 0:d.totalPages,currentPage:b,onChange:a}):null,t?s(T,{minifiedView:t,routeOrdersList:A}):null]})]})},pr=({className:c,withHeader:r,minifiedView:t,withThumbnails:e,withFilter:n,ordersInMinifiedView:i,pageSize:l,routeOrdersList:A,routeOrderDetails:L,routeTracking:p,routeOrderProduct:o,slots:u})=>s("div",{className:N(["account-orders-list",c]),"data-testid":"ordersListId",children:s(tr,{className:c,withHeader:r,minifiedView:t,withThumbnails:e,withFilter:n,ordersInMinifiedView:i,pageSize:l,routeOrdersList:A,routeOrderDetails:L,routeTracking:p,routeOrderProduct:o,slots:u})});export{pr as OrdersList,pr as default};
