import{jsx as s,jsxs as u,Fragment as _}from"@dropins/tools/preact-jsx-runtime.js";import{classes as C,Slot as B}from"@dropins/tools/lib.js";import{S as T,c as F,E as J,C as K}from"../chunks/CustomerInformationCard.js";import"@dropins/tools/preact-compat.js";import{Card as q,Icon as Y,ContentGrid as V,Image as D,Header as W,Picker as j,Pagination as G}from"@dropins/tools/components.js";import{useText as I}from"@dropins/tools/i18n.js";import{useState as v,useEffect as z,useMemo as U,useCallback as E}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import{g as Q}from"../chunks/getOrderHistoryList.js";import"../chunks/removeCustomerAddress.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact.js";const H={size:"32",stroke:"2"},m=({minifiedView:n,orderNumber:r,orderToken:e,routeOrdersList:a,routeOrderDetails:d})=>{const i=n?"minifiedView":"fullSizeView",l=I({viewAllOrdersButton:`Account.${i}.OrdersList.viewAllOrdersButton`,ariaLabelLink:`Account.${i}.OrdersList.ariaLabelLink`});return a?s("a",{className:C(["account-orders-list-action",["account-orders-list-action--minifiedView",n]]),"data-testid":"ordersListActionButtonMinifiedView",href:a(),children:s(q,{"data-testid":"ordersListActionMinifiedView",variant:"secondary",children:u("div",{className:"account-orders-list-action__card-wrapper",children:[s("p",{children:l.viewAllOrdersButton}),s(Y,{source:T,...H})]})})}):s("a",{"aria-label":`${l.ariaLabelLink} ${r??e}`,href:F(d)?d(r,e):"#",className:"account-orders-list-action","data-testid":"ordersListActionButton",children:s(Y,{source:T,...H})})},X=()=>{const[n,r]=v(window.innerWidth<768);return z(()=>{const e=()=>{r(window.innerWidth<768)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),n},Z=({minifiedView:n,item:r,withThumbnails:e,children:a,slots:d,routeTracking:i,routeOrderProduct:l,routeReturnDetails:p,...A})=>{var S,b,$,y,x,w,k,M;const h=n?"minifiedView":"fullSizeView",o=I({orderNumber:`Account.${h}.OrdersList.OrdersListCard.orderNumber`,itemsAmount:`Account.${h}.OrdersList.OrdersListCard.itemsAmount`,carrier:`Account.${h}.OrdersList.OrdersListCard.carrier`,returnsText:`Account.${h}.OrdersList.OrdersListCard.returns`,deliveryDateText:`Account.${h}.OrdersList.OrdersListCard.orderDate`}),g=X(),c=F(l);return u(q,{variant:"secondary",...A,className:C(["account-orders-list-card",["account-orders-list-card--full",((S=r==null?void 0:r.items)==null?void 0:S.length)>6]]),children:[s("div",{className:"account-orders-list-card__content",children:d!=null&&d.OrdersListCard?s(B,{"data-testid":`ordersListCard${r.id}`,name:"OrdersListCard",slot:d==null?void 0:d.OrdersListCard,context:{orderHistoryListItem:r}}):u(_,{children:[s("div",{children:r==null?void 0:r.status}),u("p",{children:[o.deliveryDateText," ",r==null?void 0:r.orderDate]}),u("p",{children:[o.orderNumber," ",r.number]}),(b=r==null?void 0:r.shipments)==null?void 0:b.map(t=>{var L;return(L=t==null?void 0:t.tracking)==null?void 0:L.map(O=>u("p",{"data-testid":O.number,children:[s("span",{children:`${o.carrier} ${O.carrier.toLocaleUpperCase()} `}),s("a",{href:(i==null?void 0:i(O))??"",className:"account-orders-list-card__content--track_number",children:O.number})]},t.id))}),r!=null&&r.returns&&(($=r.returns)!=null&&$.length)?u("p",{"data-testid":r.number,children:[u("span",{children:[o.returnsText," "]}),(y=r==null?void 0:r.returns)==null?void 0:y.map(t=>s("span",{"data-testid":t.number,children:u("a",{href:(p==null?void 0:p({orderNumber:r.number,orderToken:r.token,returnNumber:t.number}))??"#",className:"account-orders-list-card__content--return_number",children:[t.number," "]})},t.uid))]},r.id):null,u("p",{children:["$",(x=r==null?void 0:r.total)==null?void 0:x.grandTotal.value]}),u("p",{"data-testid":"itemsAmount",children:[((w=r==null?void 0:r.items)==null?void 0:w.length)??0," ",o.itemsAmount]}),(k=r==null?void 0:r.items)==null?void 0:k.map((t,L)=>{if(L>=0&&L<10)return u("p",{className:"account-orders-list-card__content--product-name",children:[u("span",{className:"account-orders-list-card__content--quantity",children:[(t==null?void 0:t.quantityOrdered)>1?t==null?void 0:t.quantityOrdered:null," "]}),t==null?void 0:t.productName.replaceAll("-"," ")]},`${L}_${t.id}`);if(L===11)return s("p",{children:"..."},"ellipsis")})]})}),e&&((M=r==null?void 0:r.items)!=null&&M.length)?s(V,{maxColumns:g?3:9,emptyGridContent:s(_,{}),className:C(["account-orders-list-card__images",["account-orders-list-card__images-3",g]]),"data-testid":"ordersListCardImages",children:r.items.map((t,L)=>{var N;const O=(N=t==null?void 0:t.product)==null?void 0:N.smallImage.url,f=t==null?void 0:t.productName;return c?s("a",{href:l==null?void 0:l(t),target:"_blank",rel:"noreferrer",children:s(D,{src:O,width:65,height:65,alt:f})},t.id+L):s(D,{src:O,width:65,height:65,alt:f},t.id+L)})}):null,s("div",{className:"account-orders-list-card__actions",children:a})]})},R=({ordersInMinifiedView:n,minifiedView:r,pageSize:e,selectedDate:a,selectedPage:d,handleSetFirstOrderDate:i})=>{const[l,p]=v([]),[A,h]=v({totalPages:1,currentPage:1,pageSize:1}),[o,g]=v(!1);return z(()=>{g(!0),Q(r?n:e,a,d).then(c=>{!c||!c.items||(h(c.pageInfo),p(c.items),i==null||i(c.dateOfFirstOrder))}).finally(()=>{g(!1)})},[i,r,n,e,a,d]),{loading:o,orderHistoryListItems:l,pageInfo:A}},P=(n,r=1)=>{const e=new Date,a=new Date(e);switch(n){case"sixMonthsAgo":{a.setMonth(a.getMonth()-r);break}case"oneYearAgo":{a.setFullYear(a.getFullYear()-r);break}default:return""}return{from:a==null?void 0:a.toISOString().split("T")[0],to:`${e==null?void 0:e.toISOString().split("T")[0]} 23:59:59`}},rr=n=>{const r=[],e=new Date().getFullYear();for(let a=n;a<=e-1;a++)r.push({value:`{"from":"${a}-01-01","to":"${a+1}-01-01 23:59:59"}`,text:a.toString()});return r},tr=()=>{const n=I({pastSixMonths:"Account.fullSizeView.OrdersList.OrdersListSelectDate.pastSixMonths",currentYear:"Account.fullSizeView.OrdersList.OrdersListSelectDate.currentYear",viewAll:"Account.fullSizeView.OrdersList.OrdersListSelectDate.viewAll"}),[r,e]=v(),[a,d]=v(JSON.stringify(P("sixMonthsAgo",6))),[i,l]=v(1);z(()=>{window==null||window.scrollTo({top:100,behavior:"smooth"})},[i]);const p=U(()=>{const o=[{value:JSON.stringify(P("sixMonthsAgo",6)),text:n.pastSixMonths},{value:JSON.stringify(P("oneYearAgo",1)),text:n.currentYear},{value:"viewAll",text:n.viewAll}];if(r){const c=new Date(r).getFullYear();o==null||o.splice(2,0,...rr(c))}return o},[n,r]),A=E(o=>{e(o)},[]),h=E(o=>{const c=o.target.value;d(c),l(1)},[]);return{selectableDateList:p,selectedDate:a,selectedPage:i,handleSelectDate:h,setSelectedPage:l,handleSetFirstOrderDate:A}},sr=({className:n,withHeader:r=!0,minifiedView:e=!1,withThumbnails:a=!0,withFilter:d=!0,ordersInMinifiedView:i=1,pageSize:l=10,routeOrdersList:p,routeOrderDetails:A,routeReturnDetails:h,routeTracking:o,routeOrderProduct:g,slots:c})=>{const S=e?"minifiedView":"fullSizeView",b=I({containerTitle:`Account.${S}.OrdersList.containerTitle`,dateOrderPlaced:`Account.${S}.OrdersList.dateOrderPlaced`}),{selectableDateList:$,selectedDate:y,handleSelectDate:x,selectedPage:w,setSelectedPage:k,handleSetFirstOrderDate:M}=tr(),{pageInfo:t,loading:L,orderHistoryListItems:O}=R({minifiedView:e,pageSize:l,ordersInMinifiedView:i,selectedDate:y,selectedPage:w,handleSetFirstOrderDate:M});return u("div",{children:[r?s(W,{"aria-label":b.containerTitle,role:"region",title:b.containerTitle,divider:!e,className:e?"account-orders-list-header":""}):null,u("div",{className:C(["account-orders-list",n]),children:[!e&&d?u("div",{className:"account-orders-list__date-select",children:[s("span",{children:b.dateOrderPlaced}),s(j,{value:y,name:"orderDatePicker",options:$,handleSelect:x})]}):null,L?s(_,{children:Array.from(Array(t==null?void 0:t.pageSize).keys()).map(f=>s(K,{testId:"orderSkeletonLoader",withCard:!1},f))}):s(_,{children:O.length?s(_,{children:O.map((f,N)=>s(Z,{routeTracking:o,routeOrderProduct:g,routeReturnDetails:h,minifiedView:e,item:f,withThumbnails:a,slots:c,children:c!=null&&c.OrdersListAction?s(B,{"data-testid":`ordersListActionSlot_${N}`,name:"OrdersListAction",slot:c==null?void 0:c.OrdersListAction,context:{orderHistoryListItem:f}}):s(m,{minifiedView:e,orderNumber:f.number,orderToken:f.token,routeOrderDetails:A})},N))}):s(J,{isEmpty:!O.length,typeList:"orders",minifiedView:e})}),!e&&(t==null?void 0:t.totalPages)>1?s(G,{totalPages:t==null?void 0:t.totalPages,currentPage:w,onChange:k}):null,e?s(m,{minifiedView:e,routeOrdersList:p}):null]})]})},gr=({className:n,withHeader:r,minifiedView:e,withThumbnails:a,withFilter:d,ordersInMinifiedView:i,pageSize:l,routeOrdersList:p,routeOrderDetails:A,routeReturnDetails:h,routeTracking:o,routeOrderProduct:g,slots:c})=>s("div",{className:C(["account-orders-list",n]),"data-testid":"ordersListId",children:s(sr,{className:n,withHeader:r,minifiedView:e,withThumbnails:a,withFilter:d,ordersInMinifiedView:i,pageSize:l,routeOrdersList:p,routeOrderDetails:A,routeReturnDetails:h,routeTracking:o,routeOrderProduct:g,slots:c})});export{gr as OrdersList,gr as default};
