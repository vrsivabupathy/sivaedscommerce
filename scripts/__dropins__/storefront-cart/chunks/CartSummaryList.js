import{jsx as r,jsxs as v,Fragment as j}from"@dropins/tools/preact-jsx-runtime.js";import*as s from"@dropins/tools/preact-compat.js";import{useState as O,useEffect as F}from"@dropins/tools/preact-compat.js";import{classes as P,VComponent as V,Slot as T}from"@dropins/tools/lib.js";/* empty css             */import{E as It}from"./EmptyCart.js";import{Divider as wt,Skeleton as St,SkeletonRow as Et,InLineAlert as _t,Icon as X,CartList as D,CartItem as Ot,Price as S,Image as Pt}from"@dropins/tools/components.js";import{g as xt}from"./persisted-data.js";import{events as Nt}from"@dropins/tools/event-bus.js";import{s as At}from"./resetCart.js";import{u as J}from"./updateProductsFromCart.js";import{useText as Qt}from"@dropins/tools/i18n.js";const K=d=>s.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...d},s.createElement("g",{clipPath:"url(#clip0_4797_15331)"},s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M10.25 20.91L1.5 17.55V6.51996L10.25 9.92996V20.91Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.24023 4.64001L14.9902 8.06001V11.42",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{className:"error-icon",vectorEffect:"non-scaling-stroke",d:"M19 13.31L15.5 19.37H22.5L19 13.31Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{className:"error-icon",vectorEffect:"non-scaling-stroke",d:"M19.0202 17.11H18.9802L18.9502 15.56H19.0502L19.0202 17.11ZM18.9602 18.29V18.06H19.0502V18.29H18.9602Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19 12.16V6.51996L10.25 9.92996V20.91L14.27 19.37L14.4 19.32",stroke:"currentColor",strokeLinejoin:"round"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M1.5 6.51999L10.25 3.04999L19 6.51999L10.25 9.92999L1.5 6.51999Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),s.createElement("defs",null,s.createElement("clipPath",{id:"clip0_4797_15331"},s.createElement("rect",{width:22,height:18.86,fill:"white",transform:"translate(1 2.54999)"})))),Gt=d=>s.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...d},s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),Vt=({className:d,children:Z,heading:g,emptyCart:k,products:p,outOfStockMessage:h,loading:x=!0,...f})=>r("div",{...f,className:P(["cart-cart-summary-list",d]),children:x?r(Xt,{}):v(j,{children:[(g||h)&&v("div",{"data-testid":"cart-summary-list-heading-wrapper",className:P(["cart-cart-summary-list__heading",["cart-cart-summary-list__heading--full-width",!p]]),children:[g&&v(j,{children:[r(V,{node:g,className:"cart-cart-summary-list__heading-text"}),r(wt,{variant:"primary",className:P(["cart-cart-summary-list__heading-divider"])})]}),h&&r(V,{node:h,className:"cart-cart-summary-list__out-of-stock-message"})]}),r("div",{className:P(["cart-cart-summary-list__content",["cart-cart-summary-list__content--empty",!p]]),children:p||r(V,{node:k,className:"cart-cart-summary-list__empty-cart"})})]})}),Xt=()=>r(St,{"data-testid":"cart-summary-list-skeleton",className:"cart-cart-summary-list__skeleton",rowGap:"medium",children:r(Et,{variant:"row",size:"xlarge",fullWidth:!0,lines:3,multilineGap:"small"})}),jt=({initialData:d=null,hideHeading:Z,routeProduct:g,routeEmptyCartCTA:k,onItemUpdate:p,onItemRemove:h,maxItems:x,slots:f,attributesToHide:o=[],enableRemoveItem:N,enableUpdateItemQuantity:$,onItemsErrorsChange:A,showDiscount:Y,showSavings:R,quantityType:H,dropdownOptions:b,...tt})=>{var q;const[nt,et]=O(!d),[a,rt]=O(d),[C,at]=O(new Set),[E,it]=O(new Map),c=(q=At.config)==null?void 0:q.shoppingCartDisplaySetting,i=Qt({file:"Cart.CartItem.file",files:"Cart.CartItem.files",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",recipient:"Cart.CartItem.recipient",regularPrice:"Cart.CartItem.regularPrice",discountedPrice:"Cart.CartItem.discountedPrice",sender:"Cart.CartItem.sender",lowInventory:"Cart.CartItem.lowInventory",insufficientQuantity:"Cart.CartItem.insufficientQuantity",insufficientQuantityGeneral:"Cart.CartItem.insufficientQuantityGeneral",outOfStockHeading:"Cart.OutOfStockMessage.heading",outOfStockDescription:"Cart.OutOfStockMessage.message",outOfStockAlert:"Cart.OutOfStockMessage.alert",removeAction:"Cart.OutOfStockMessage.action",notAvailableMessage:"Cart.CartItem.notAvailableMessage",discountPercent:"Cart.CartItem.discountPercentage",savingsAmount:"Cart.CartItem.savingsAmount"}),Q=(t,n)=>{at(e=>(n?e.add(t):e.delete(t),new Set(e)))},z=(t,n)=>{it(e=>(n?e.set(t,n):e.delete(t),new Map(e)))},G=(t,n)=>{Q(t.uid,!0),z(t.uid),N&&n===0?J([{uid:t.uid,quantity:n}]).then(()=>{h==null||h({item:t})}).finally(()=>{Q(t.uid,!1)}).catch(e=>{console.warn(e)}):$&&J([{uid:t.uid,quantity:n}]).then(()=>{p==null||p({item:t})}).finally(()=>{Q(t.uid,!1)}).catch(e=>{console.warn(e),z(t.uid,e.message)})};F(()=>{const t=Nt.on("cart/data",n=>{rt(n),et(!1)},{eager:!0});return()=>{t==null||t.off()}},[]),F(()=>{A&&A(E)},[E,A]);const ct=(t,n)=>{if(o.includes("image"))return;const e=r(Pt,{"data-testid":"cart-list-item-image",loading:n<4?"eager":"lazy",src:t.image.src,alt:t.image.alt,width:"300",height:"300",params:{width:300}});return g?r("a",{href:g(t),children:e}):e},ot=t=>{if(!o.includes("name"))return r("span",{"data-testid":"cart-list-item-title",children:g?r("a",{href:g(t),children:t.name}):t.name})},st=t=>{if(o.includes("configurations"))return;const n={...t.bundleOptions,...t.selectedOptions,...t.customizableOptions,...t.recipient?{[i.recipient]:t.recipient}:null,...t.recipientEmail&&t.recipient?{[i.recipient]:`${t.recipient} (${t.recipientEmail})`}:null,...t.sender?{[i.sender]:t.sender}:null,...t.senderEmail&&t.sender?{[i.sender]:`${t.sender} (${t.senderEmail})`}:{},...t.message?{[i.message]:t.message}:null,...t.links&&t.links.count?t.links.count>1?{[i.files.replace("{count}",t.links.count.toString())]:t.links.result}:{[i.file.replace("{count}",t.links.count.toString())]:t.links.result}:null};if(Object.keys(n).length!==0)return n},lt=t=>{var n,e,u,l;return(c==null?void 0:c.price)==="INCLUDING_TAX"?t.discounted?{amount:t.regularPrice.value,currency:t.regularPrice.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}:{amount:(n=t.taxedPrice)==null?void 0:n.value,currency:(e=t.taxedPrice)==null?void 0:e.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}:{amount:(u=t.regularPrice)==null?void 0:u.value,currency:(l=t.regularPrice)==null?void 0:l.currency,style:{font:"inherit"},"data-testid":"regular-item-price"}},ut=t=>{var n,e;return{amount:(n=t.savingsAmount)==null?void 0:n.value,currency:(e=t.savingsAmount)==null?void 0:e.currency,style:{font:"inherit"},"data-testid":"item-savings-amount"}},dt=t=>(c==null?void 0:c.price)==="INCLUDING_EXCLUDING_TAX"?r(S,{amount:t.rowTotal.value,currency:t.rowTotal.currency,"data-testid":"excluding-tax-total","aria-label":i.regularPrice}):void 0,gt=t=>{var u,l,y,m,L,I,w,M,W,B;const n={"aria-label":i.regularPrice},e=t.discounted?{}:null;return["INCLUDING_TAX","INCLUDING_EXCLUDING_TAX"].includes(c==null?void 0:c.price)?(n.amount=(u=t.rowTotalIncludingTax)==null?void 0:u.value,n.currency=(l=t.rowTotalIncludingTax)==null?void 0:l.currency,n.variant=t.discounted?"strikethrough":"default",n["data-testid"]="including-tax-item-total",e&&(n.amount=(y=t.total)==null?void 0:y.value,n.currency=(m=t.total)==null?void 0:m.currency,e.amount=(L=t.rowTotalIncludingTax)==null?void 0:L.value,e.currency=(I=t.rowTotalIncludingTax)==null?void 0:I.currency,e.sale=!0,e["aria-label"]=i.discountedPrice,e["data-testid"]="discount-total")):(n.amount=(w=t.total)==null?void 0:w.value,n.currency=(M=t.total)==null?void 0:M.currency,n.variant=t.discounted?"strikethrough":"default",n["data-testid"]="regular-item-total",e&&(e.amount=(W=t.discountedTotal)==null?void 0:W.value,e.currency=(B=t.discountedTotal)==null?void 0:B.currency,e.sale=!0,e["aria-label"]=i.regularPrice,e["data-testid"]="discount-total")),{totalProps:n,discountProps:e}},ft=t=>{var L,I,w;if(o.includes("warning"))return;const n=E.get(t.uid),e=(L=E.get(t.uid))==null?void 0:L.includes("The requested qty is not available"),u=C.has(t.uid),l=t.insufficientQuantity&&t.stockLevel?t.stockLevel==="noNumber"?i.insufficientQuantityGeneral:i.insufficientQuantity.replace("{inventory}",(I=t.stockLevel)==null?void 0:I.toString()).replace("{count}",t.quantity.toString()):"",y=t.lowInventory&&t.onlyXLeftInStock&&i.lowInventory.replace("{count}",(w=t.onlyXLeftInStock)==null?void 0:w.toString()),m=!t.outOfStock&&n&&e?i.notAvailableMessage:n;return!u&&(n||t.insufficientQuantity||t.lowInventory)?v("span",{"data-testid":"item-warning",children:[r(X,{source:Gt,size:"16"}),m||l||y]}):void 0},pt=t=>o!=null&&o.includes("alert")?void 0:!C.has(t.uid)&&t.outOfStock?v("span",{"data-testid":"item-alert",children:[r(X,{source:K,size:"16"}),i.outOfStockAlert]}):void 0,ht=t=>{if(!o.includes("sku"))return r("span",{"data-testid":"cart-list-item-sku",children:t.sku})},U=t=>a!=null&&a.totalQuantity?a.items.filter(t).map((n,e)=>{var y;const{totalProps:u,discountProps:l}=gt(n);return r(Ot,{updating:C==null?void 0:C.has(n.uid),"data-testid":`cart-list-item-entry-${n.uid}`,image:ct(n,e),title:ot(n),sku:ht(n),price:o.includes("price")?void 0:r(S,{...lt(n)}),quantity:o.includes("quantity")?void 0:n.quantity,total:v(j,{children:[o.includes("total")?void 0:r(S,{...u}),o.includes("totalDiscount")?void 0:l&&r(S,{...l})]}),configurations:st(n),totalExcludingTax:o.includes("totalExcludingTax")?void 0:dt(n),taxIncluded:(c==null?void 0:c.price)==="INCLUDING_TAX",taxExcluded:!o.includes("totalExcludingTax")&&(c==null?void 0:c.price)==="INCLUDING_EXCLUDING_TAX",warning:ft(n),alert:pt(n),quantityType:H,dropdownOptions:b,onQuantity:$?m=>{G(n,m)}:void 0,onRemove:N?()=>G(n,0):void 0,discount:Y&&n.discounted&&n.discountPercentage?r("div",{"data-testid":"item-discount-percent",children:i.discountPercent.replace("{discount}",((y=n.discountPercentage)==null?void 0:y.toString())??"")}):void 0,savings:R&&n.discounted&&n.savingsAmount?v("div",{children:[r("span",{children:r(S,{...ut(n)})})," ",i.savingsAmount]}):void 0},n.uid)}):null,yt=r(T,{name:"EmptyCart",slot:f==null?void 0:f.EmptyCart,context:{},children:r(It,{"data-testid":"empty-cart",ctaLinkURL:k==null?void 0:k()})}),vt=r(T,{name:"Heading",slot:f==null?void 0:f.Heading,context:{count:a==null?void 0:a.totalQuantity},children:r("div",{"data-testid":"default-cart-heading",children:i.heading.replace("({count})",a!=null&&a.totalQuantity?`(${a==null?void 0:a.totalQuantity.toString()})`:"")})}),mt=()=>{const t=a==null?void 0:a.items.filter(n=>n.outOfStock);t==null||t.forEach(n=>{G(n,0)})},kt=U(t=>t.outOfStock||t.insufficientQuantity||!1),Ct=a!=null&&a.hasOutOfStockItems?r(_t,{"data-testid":"cart-out-of-stock-message",icon:r(X,{source:K,size:"16"}),itemList:r(D,{"data-testid":"out-of-stock-cart-items",children:kt}),type:"warning",heading:i.outOfStockHeading,description:i.outOfStockDescription,variant:"primary",actionButtonPosition:"bottom",additionalActions:a!=null&&a.hasFullyOutOfStockItems&&N?[{label:i.removeAction,onClick:mt}]:void 0}):void 0,_=U(t=>!t.outOfStock&&!t.insufficientQuantity),Lt=a!=null&&a.totalQuantity?r(D,{"data-testid":"cart-list",children:_==null?void 0:_.slice(0,x??_.length)}):null;return r(Vt,{...tt,heading:Z?void 0:vt,loading:nt,emptyCart:yt,products:Lt,outOfStockMessage:Ct})};jt.getInitialData=async function(){return xt()};export{jt as C};
