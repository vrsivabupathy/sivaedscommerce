/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsxs as p,jsx as e,Fragment as wr}from"@dropins/tools/preact-jsx-runtime.js";import*as Cr from"@dropins/tools/preact-compat.js";import{useState as Y,useEffect as er,useCallback as Ir}from"@dropins/tools/preact-compat.js";import{classes as u,VComponent as l,Slot as vr}from"@dropins/tools/lib.js";import{events as Pr}from"@dropins/tools/event-bus.js";import{g as kr}from"./persisted-data.js";import{s as Nr}from"./resetCart.js";import{g as Er}from"./getEstimatedTotals.js";import{b as Br}from"./acdl.js";import{Accordion as Dr,AccordionSection as Lr,ProgressSpinner as Wr,Divider as Ar,Price as d,Icon as Or,Button as Fr}from"@dropins/tools/components.js";/* empty css       */import{S as Gr}from"./ChevronDown.js";import{useText as fr}from"@dropins/tools/i18n.js";import{S as zr}from"./Coupon.js";const Vr=()=>{const[I,A]=Y(!1),[P,m]=Y();return{handleEstimateTotals:(y,h)=>{A(!0);const{shippingCountry:r,shippingState:g="",shippingStateId:N,shippingZip:_=""}=y,S={countryCode:r,postcode:_,region:{region:g,id:N},shipping_method:{carrier_code:(h==null?void 0:h.carrier_code)||"",method_code:(h==null?void 0:h.method_code)||""}};Er(S).then(n=>{var t,E,B,a,f,w,b,x,T,D,L,W,s,O,F,G,z,V,Z,j;n&&m({estimatedTaxTotal:{amount:(t=n.totalTax)==null?void 0:t.value,currency:(E=n.totalTax)==null?void 0:E.currency},estimatedSubTotal:{excludingTax:{amount:(a=(B=n.subtotal)==null?void 0:B.excludingTax)==null?void 0:a.value,currency:(w=(f=n.subtotal)==null?void 0:f.excludingTax)==null?void 0:w.currency},includingTax:{amount:(x=(b=n.subtotal)==null?void 0:b.includingTax)==null?void 0:x.value,currency:(D=(T=n.subtotal)==null?void 0:T.includingTax)==null?void 0:D.currency},includingDiscountOnly:{amount:(W=(L=n.subtotal)==null?void 0:L.includingDiscountOnly)==null?void 0:W.value,currency:(O=(s=n.subtotal)==null?void 0:s.includingDiscountOnly)==null?void 0:O.currency}},estimatedGrandTotalPrice:{includingTax:{amount:(F=n.total)==null?void 0:F.includingTax.value,currency:(G=n.total)==null?void 0:G.includingTax.currency},excludingTax:{amount:(z=n.total)==null?void 0:z.excludingTax.value,currency:(V=n.total)==null?void 0:V.excludingTax.currency}},estimatedAppliedTaxes:{taxes:(Z=n.appliedTaxes)==null?void 0:Z.map(o=>{var C,v;return{label:o.label,amount:{value:(C=o.amount)==null?void 0:C.value,currency:(v=o.amount)==null?void 0:v.currency}}})},estimatedItems:{items:(j=n.items)==null?void 0:j.map(o=>{var C,v,U,Q,X,$,q,H,R,J;return{uid:o.uid,price:{amount:(C=o.price)==null?void 0:C.value,currency:(v=o.price)==null?void 0:v.currency},taxedPrice:{amount:(U=o.taxedPrice)==null?void 0:U.value,currency:(Q=o.taxedPrice)==null?void 0:Q.currency},rowTotal:{amount:(X=o.rowTotal)==null?void 0:X.value,currency:($=o.rowTotal)==null?void 0:$.currency},rowTotalIncludingTax:{amount:(q=o.rowTotalIncludingTax)==null?void 0:q.value,currency:(H=o.rowTotalIncludingTax)==null?void 0:H.currency},regularPrice:{amount:(R=o.regularPrice)==null?void 0:R.value,currency:(J=o.regularPrice)==null?void 0:J.currency}}})}})}).finally(()=>{A(!1)})},estimatedTotals:P,setEstimatedTotals:m,loading:I}},Zr=I=>Cr.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...I},Cr.createElement("path",{d:"M7.74512 14.132L12.0001 9.87701L16.2551 14.132",stroke:"#2B2B2B",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round"})),jr=({className:I,children:A,variant:P="primary",heading:m,loading:k=!0,subTotal:y,shipping:h,discounts:r,taxTotal:g,taxesApplied:N,total:_,primaryAction:S,coupons:n,...t})=>{const[E,B]=Y(!1),a=fr({checkout:"Cart.PriceSummary.checkout",discountedPrice:"Cart.CartItem.discountedPrice",download:"Cart.CartItem.download",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",regularPrice:"Cart.CartItem.regularPrice",recipient:"Cart.CartItem.recipient",sender:"Cart.CartItem.sender",file:"Cart.CartItem.file",files:"Cart.CartItem.files",orderSummary:"Cart.PriceSummary.orderSummary",taxesBreakdownTitle:"Cart.PriceSummary.taxes.breakdown",taxTotal:"Cart.PriceSummary.taxes.total",taxEstimated:"Cart.PriceSummary.taxes.estimated",taxTotalOnly:"Cart.PriceSummary.taxes.totalOnly",showTaxBreakdown:"Cart.PriceSummary.taxes.showBreakdown",hideTaxBreakdown:"Cart.PriceSummary.taxes.hideBreakdown",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined",subtotalLabel:"Cart.PriceSummary.subTotal.label",subtotalWithTaxes:"Cart.PriceSummary.subTotal.withTaxes",subtotalWithoutTaxes:"Cart.PriceSummary.subTotal.withoutTaxes",totalEstimated:"Cart.PriceSummary.total.estimated",totalLabel:"Cart.PriceSummary.total.label",totalWithoutTax:"Cart.PriceSummary.total.withoutTax",shippingLabel:"Cart.PriceSummary.shipping.label",zipPlaceholder:"Cart.PriceSummary.shipping.zipPlaceholder",editZipAction:"Cart.PriceSummary.shipping.editZipAction",shippingWithTaxes:"Cart.PriceSummary.shipping.withTaxes",shippingWithoutTaxes:"Cart.PriceSummary.shipping.withoutTaxes",shippingEstimated:"Cart.PriceSummary.shipping.estimated",shippingEstimatedByState:"Cart.PriceSummary.shipping.alternateField.state",shippingEstimatedByZip:"Cart.PriceSummary.shipping.alternateField.zip",destinationLinkAriaLabel:"Cart.PriceSummary.shipping.destinationLinkAriaLabel",applyButton:"Cart.PriceSummary.estimatedShippingForm.apply.label",countryField:"Cart.PriceSummary.estimatedShippingForm.country.placeholder",freeShipping:"Cart.PriceSummary.freeShipping",stateField:"Cart.PriceSummary.estimatedShippingForm.state.placeholder",zipField:"Cart.PriceSummary.estimatedShippingForm.zip.placeholder"}),f=y&&p("div",{className:u(["cart-order-summary__entry","cart-order-summary__subTotal"]),children:[e("span",{className:"cart-order-summary__label",children:a.subtotalLabel}),e(l,{node:y.price,className:"cart-order-summary__price"}),y.taxIncluded&&e("div",{"data-testid":"sub-total-tax-caption",className:"cart-order-summary__caption",children:e("span",{children:a.subtotalWithTaxes})}),y.taxExcluded?e("div",{"data-testid":"sub-total-tax-caption-excluded",className:"cart-order-summary__caption",children:p("span",{children:[y.priceExcludingTax,"Â ",a.subtotalWithoutTaxes]})}):void 0]}),w=h&&e(l,{node:h,className:"cart-order-summary__shipping"}),b=n&&e(l,{node:n,className:"cart-order-summary__coupons"}),x=r&&r.length>0&&e(wr,{children:r.map(s=>p("div",{className:u(["cart-order-summary__entry","cart-order-summary__discount"]),children:[e("span",{className:"cart-order-summary__label",children:s.label}),e(l,{node:s.price,className:"cart-order-summary__price"}),s.coupon&&e(l,{node:s.coupon,className:"cart-order-summary__coupon__code"}),s.caption&&e(l,{node:s.caption,className:"cart-order-summary__caption"})]},s.label))}),T=N&&N.length>0?e(Dr,{"data-testid":"tax-breakdown",className:"cart-order-summary__taxes",iconOpen:Gr,iconClose:Zr,children:p(Lr,{title:a.taxesBreakdownTitle,secondaryText:!E&&g?e(l,{node:g.price,className:"cart-order-summary__price"}):void 0,renderContentWhenClosed:!1,onStateChange:B,children:[e("div",{className:"cart-order-summary__appliedTaxes",children:N.map(s=>p("div",{className:u(["cart-order-summary__entry","cart-order-summary__taxEntry"]),children:[e("span",{className:u(["cart-order-summary__label","cart-order-summary__label--muted"]),children:s.label}),e(l,{node:s.price,className:u(["cart-order-summary__price","cart-order-summary__price--muted"])})]},s.label))}),p("div",{className:u(["cart-order-summary__entry","cart-order-summary__taxTotal"]),children:[e("span",{className:"cart-order-summary__label",children:a.taxTotal}),g&&e(l,{node:g.price,className:"cart-order-summary__price"})]})]})}):g&&p("div",{"data-testid":"tax-total-only",className:u(["cart-order-summary__entry","cart-order-summary__taxTotal"]),children:[e("span",{className:"cart-order-summary__label",children:g.estimated?a.taxEstimated:a.taxTotalOnly}),e(l,{node:g.price,className:"cart-order-summary__price"})]}),D=_&&p("div",{"data-testid":"total-content",className:u(["cart-order-summary__entry","cart-order-summary__total",_.estimated&&"cart-order-summary__total--padded"]),children:[e("span",{className:u(["cart-order-summary__label","cart-order-summary__label--bold"]),children:_.estimated?a.totalEstimated:a.totalLabel}),e(l,{node:_.price,className:u(["cart-order-summary__price","cart-order-summary__price--bold"])})]}),L=_&&_.priceWithoutTax&&p("div",{"data-testid":"total-without-tax",className:u(["cart-order-summary__entry","cart-order-summary__totalWithoutTax"]),children:[e("span",{className:u(["cart-order-summary__label","cart-order-summary__label--muted"]),children:a.totalWithoutTax}),e(l,{node:_.priceWithoutTax,className:u(["cart-order-summary__price","cart-order-summary__price--muted"])})]}),W=S&&e("div",{className:u(["cart-order-summary__entry","cart-order-summary__primaryAction"]),children:S});return p("div",{...t,className:u(["cart-order-summary",["cart-order-summary--loading",k],[`cart-order-summary__${P}`,P],I]),children:[k&&e(Wr,{className:"cart-order-summary__spinner"}),p("div",{className:"cart-order-summary__heading",children:[m&&e(l,{node:m,className:"cart-order-summary__heading-text"}),e(Ar,{variant:"primary",className:"cart-order-summary__divider-primary"})]}),p("div",{className:"cart-order-summary__content",children:[f,w,x,T,D,L,W,b]})]})},Ur=({children:I,initialData:A=null,routeCheckout:P,slots:m,errors:k,enableCoupons:y,...h})=>{var s,O,F,G,z,V,Z,j,o,C,v,U,Q,X,$,q,H,R,J,tr,ar,ir,nr,cr,or,sr,ur,mr,lr,dr,pr,xr,yr,hr;const[r,g]=Y(A),[N,_]=Y(!1),S=r==null?void 0:r.isVirtual;y=y??!0;const{handleEstimateTotals:n,estimatedTotals:t,setEstimatedTotals:E,loading:B}=Vr(),a=(s=Nr.config)==null?void 0:s.shoppingCartDisplaySetting,f=(a==null?void 0:a.subtotal)==="INCLUDING_TAX",w=(a==null?void 0:a.subtotal)==="INCLUDING_EXCLUDING_TAX",b=a==null?void 0:a.zeroTax;er(()=>{const c=Pr.on("cart/data",i=>{var K;g(i);const M=(K=i==null?void 0:i.addresses)==null?void 0:K.shipping,rr=i==null?void 0:i.isVirtual;(M||rr)&&E(null)},{eager:!0});return()=>{c==null||c.off()}},[]),er(()=>{_(k)},[k]),er(()=>{const c=Pr.on("shipping/estimate",i=>{var K,gr,_r,Tr,br,Sr;const M={shippingCountry:(K=i==null?void 0:i.address)==null?void 0:K.countryCode,shippingState:(gr=i==null?void 0:i.address)==null?void 0:gr.region,shippingStateId:(_r=i==null?void 0:i.address)==null?void 0:_r.regionId,shippingZip:(Tr=i==null?void 0:i.address)==null?void 0:Tr.postCode},rr={carrier_code:((br=i==null?void 0:i.shippingMethod)==null?void 0:br.carrierCode)||"",method_code:((Sr=i==null?void 0:i.shippingMethod)==null?void 0:Sr.methodCode)||""};n(M,rr)});return()=>{c==null||c.off()}},[n]);const x=fr({checkout:"Cart.PriceSummary.checkout",free:"Cart.PriceSummary.total.free",orderSummary:"Cart.PriceSummary.orderSummary",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined"}),T=(r==null?void 0:r.hasOutOfStockItems)||N,D=Ir(()=>{!T&&r&&Br(r,Nr.locale)},[T,r]),L=!S&&(m!=null&&m.EstimateShipping)?e(vr,{name:"EstimateShipping",slot:m.EstimateShipping},"estimateShippingId"):void 0;if(!Object.keys(r??{}).length||(r==null?void 0:r.totalQuantity)===0)return null;const W=y&&(m!=null&&m.Coupons)?e(vr,{name:"Coupons",slot:m.Coupons},"couponsId"):void 0;return e(jr,{...h,"data-testid":"cart-order-summary",heading:e("div",{children:x.orderSummary}),shipping:L,coupons:W,loading:B,subTotal:{taxIncluded:f&&!b,taxExcluded:w,zeroTaxSubtotal:b,priceExcludingTax:(O=t==null?void 0:t.estimatedSubTotal)!=null&&O.excludingTax?e(d,{"data-testid":"subtotal",...(F=t==null?void 0:t.estimatedSubTotal)==null?void 0:F.excludingTax}):e(d,{"data-testid":"subtotal",amount:(z=(G=r==null?void 0:r.subtotal)==null?void 0:G.excludingTax)==null?void 0:z.value,currency:(Z=(V=r==null?void 0:r.subtotal)==null?void 0:V.excludingTax)==null?void 0:Z.currency}),price:!b&&f||!b&&w?(j=t==null?void 0:t.estimatedSubTotal)!=null&&j.includingTax?e(d,{"data-testid":"subtotal",...(o=t==null?void 0:t.estimatedSubTotal)==null?void 0:o.includingTax}):e(d,{"data-testid":"subtotal",amount:(C=r==null?void 0:r.subtotal.includingTax)==null?void 0:C.value,currency:(v=r==null?void 0:r.subtotal.includingTax)==null?void 0:v.currency}):e(d,{"data-testid":"subtotal",amount:(Q=(U=r==null?void 0:r.subtotal)==null?void 0:U.excludingTax)==null?void 0:Q.value,currency:($=(X=r==null?void 0:r.subtotal)==null?void 0:X.excludingTax)==null?void 0:$.currency})},discounts:(q=r==null?void 0:r.appliedDiscounts)==null?void 0:q.map(c=>{var i;return{label:c.label,price:e(d,{"data-testid":"summary-discount-total",amount:-c.amount.value,currency:c.amount.currency,sale:!0}),coupon:c!=null&&c.coupon?p("span",{children:[e(Or,{source:zr,size:"16"}),(i=c==null?void 0:c.coupon)==null?void 0:i.code]}):void 0}}),taxTotal:S?{price:e("span",{"data-testid":"tax-total",children:x.taxToBeDetermined})}:{price:t!=null&&t.estimatedTaxTotal?e(d,{"data-testid":"tax-total",...t==null?void 0:t.estimatedTaxTotal}):e(d,{"data-testid":"tax-total",amount:(H=r==null?void 0:r.totalTax)==null?void 0:H.value,currency:(R=r==null?void 0:r.totalTax)==null?void 0:R.currency}),estimated:(!t||!!(t!=null&&t.estimatedTaxTotal))&&!((J=r==null?void 0:r.addresses)!=null&&J.shipping)},taxesApplied:S?void 0:a!=null&&a.fullSummary?(ar=((tr=t==null?void 0:t.estimatedAppliedTaxes)==null?void 0:tr.taxes)||(r==null?void 0:r.appliedTaxes))==null?void 0:ar.map(c=>({label:c.label,price:e(d,{"data-testid":"applied-taxes",amount:c.amount.value,currency:c.amount.currency})})):void 0,total:{price:t!=null&&t.estimatedGrandTotalPrice?((nr=(ir=t==null?void 0:t.estimatedGrandTotalPrice)==null?void 0:ir.includingTax)==null?void 0:nr.amount)===0?e("span",{"data-testid":"total-including-tax",children:x.free}):e(d,{"data-testid":"total-including-tax",...(cr=t==null?void 0:t.estimatedGrandTotalPrice)==null?void 0:cr.includingTax}):((or=r==null?void 0:r.total)==null?void 0:or.includingTax.value)===0?e("span",{"data-testid":"total-including-tax",children:x.free}):e(d,{"data-testid":"total-including-tax",amount:(sr=r==null?void 0:r.total)==null?void 0:sr.includingTax.value,currency:(ur=r==null?void 0:r.total)==null?void 0:ur.includingTax.currency}),estimated:(!t||!!(t!=null&&t.estimatedTaxTotal))&&!((mr=r==null?void 0:r.addresses)!=null&&mr.shipping),priceWithoutTax:a!=null&&a.grandTotal?t!=null&&t.estimatedAppliedTaxes?((dr=(lr=t==null?void 0:t.estimatedGrandTotalPrice)==null?void 0:lr.excludingTax)==null?void 0:dr.amount)===0?e("span",{"data-testid":"total-excluding-tax",children:x.free}):e(d,{"data-testid":"total-excluding-tax",...(pr=t==null?void 0:t.estimatedGrandTotalPrice)==null?void 0:pr.excludingTax}):((xr=r==null?void 0:r.total)==null?void 0:xr.excludingTax.value)===0?e("span",{"data-testid":"total-excluding-tax",children:x.free}):e(d,{"data-testid":"total-excluding-tax",amount:(yr=r==null?void 0:r.total)==null?void 0:yr.excludingTax.value,currency:(hr=r==null?void 0:r.total)==null?void 0:hr.excludingTax.currency}):void 0},primaryAction:P&&e(Fr,{"data-testid":"checkout-button",variant:"primary",disabled:T,"aria-disabled":T,href:T?void 0:P({cartId:r.id}),onClick:D,children:x.checkout})})};Ur.getInitialData=async function(){return kr()};export{Ur as O};
