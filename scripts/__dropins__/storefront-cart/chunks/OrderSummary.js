import{jsxs as d,jsx as t,Fragment as hr}from"@dropins/tools/preact-jsx-runtime.js";import*as M from"@dropins/tools/preact-compat.js";import{useState as Y,useEffect as tr}from"@dropins/tools/preact-compat.js";import{classes as o,VComponent as p,Slot as xr}from"@dropins/tools/lib.js";import{events as pr}from"@dropins/tools/event-bus.js";import{g as gr}from"./persisted-data.js";import{s as _r}from"./resetCart.js";import{g as Tr}from"./getEstimatedTotals.js";import{Accordion as br,AccordionSection as Sr,ProgressSpinner as Cr,Divider as vr,Price as l,Button as Pr}from"@dropins/tools/components.js";/* empty css             */import{useText as yr}from"@dropins/tools/i18n.js";const wr=()=>{const[g,D]=Y(!1),[S,y]=Y();return{handleEstimateTotals:(h,r)=>{D(!0);const{shippingCountry:C,shippingState:m="",shippingStateId:v,shippingZip:u=""}=h,P={countryCode:C,postcode:u,region:{region:m,id:v},shipping_method:{carrier_code:(r==null?void 0:r.carrier_code)||"",method_code:(r==null?void 0:r.method_code)||""}};Tr(P).then(e=>{var k,B,a,w,N,x,_,L,f,E,c,O,W,A,F,z,G,V,Z,j;e&&y({estimatedTaxTotal:{amount:(k=e.totalTax)==null?void 0:k.value,currency:(B=e.totalTax)==null?void 0:B.currency},estimatedSubTotal:{excludingTax:{amount:(w=(a=e.subtotal)==null?void 0:a.excludingTax)==null?void 0:w.value,currency:(x=(N=e.subtotal)==null?void 0:N.excludingTax)==null?void 0:x.currency},includingTax:{amount:(L=(_=e.subtotal)==null?void 0:_.includingTax)==null?void 0:L.value,currency:(E=(f=e.subtotal)==null?void 0:f.includingTax)==null?void 0:E.currency},includingDiscountOnly:{amount:(O=(c=e.subtotal)==null?void 0:c.includingDiscountOnly)==null?void 0:O.value,currency:(A=(W=e.subtotal)==null?void 0:W.includingDiscountOnly)==null?void 0:A.currency}},estimatedGrandTotalPrice:{includingTax:{amount:(F=e.total)==null?void 0:F.includingTax.value,currency:(z=e.total)==null?void 0:z.includingTax.currency},excludingTax:{amount:(G=e.total)==null?void 0:G.excludingTax.value,currency:(V=e.total)==null?void 0:V.excludingTax.currency}},estimatedAppliedTaxes:{taxes:(Z=e.appliedTaxes)==null?void 0:Z.map(n=>{var T,b;return{label:n.label,amount:{value:(T=n.amount)==null?void 0:T.value,currency:(b=n.amount)==null?void 0:b.currency}}})},estimatedItems:{items:(j=e.items)==null?void 0:j.map(n=>{var T,b,U,Q,X,q,$,H,R,J;return{uid:n.uid,price:{amount:(T=n.price)==null?void 0:T.value,currency:(b=n.price)==null?void 0:b.currency},taxedPrice:{amount:(U=n.taxedPrice)==null?void 0:U.value,currency:(Q=n.taxedPrice)==null?void 0:Q.currency},rowTotal:{amount:(X=n.rowTotal)==null?void 0:X.value,currency:(q=n.rowTotal)==null?void 0:q.currency},rowTotalIncludingTax:{amount:($=n.rowTotalIncludingTax)==null?void 0:$.value,currency:(H=n.rowTotalIncludingTax)==null?void 0:H.currency},regularPrice:{amount:(R=n.regularPrice)==null?void 0:R.value,currency:(J=n.regularPrice)==null?void 0:J.currency}}})}})}).finally(()=>{D(!1)})},estimatedTotals:S,setEstimatedTotals:y,loading:g}},Nr=g=>M.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...g},M.createElement("path",{d:"M7.74512 9.87701L12.0001 14.132L16.2551 9.87701",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round"})),fr=g=>M.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...g},M.createElement("path",{d:"M7.74512 14.132L12.0001 9.87701L16.2551 14.132",stroke:"#2B2B2B",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round"})),Er=({className:g,children:D,variant:S="primary",heading:y,loading:I=!0,subTotal:h,shipping:r,discounts:C,taxTotal:m,taxesApplied:v,total:u,primaryAction:P,...e})=>{const[k,B]=Y(!1),a=yr({checkout:"Cart.PriceSummary.checkout",discountedPrice:"Cart.CartItem.discountedPrice",download:"Cart.CartItem.download",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",regularPrice:"Cart.CartItem.regularPrice",recipient:"Cart.CartItem.recipient",sender:"Cart.CartItem.sender",file:"Cart.CartItem.file",files:"Cart.CartItem.files",orderSummary:"Cart.PriceSummary.orderSummary",taxesBreakdownTitle:"Cart.PriceSummary.taxes.breakdown",taxTotal:"Cart.PriceSummary.taxes.total",taxEstimated:"Cart.PriceSummary.taxes.estimated",taxTotalOnly:"Cart.PriceSummary.taxes.totalOnly",showTaxBreakdown:"Cart.PriceSummary.taxes.showBreakdown",hideTaxBreakdown:"Cart.PriceSummary.taxes.hideBreakdown",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined",subtotalLabel:"Cart.PriceSummary.subTotal.label",subtotalWithTaxes:"Cart.PriceSummary.subTotal.withTaxes",subtotalWithoutTaxes:"Cart.PriceSummary.subTotal.withoutTaxes",totalEstimated:"Cart.PriceSummary.total.estimated",totalLabel:"Cart.PriceSummary.total.label",totalWithoutTax:"Cart.PriceSummary.total.withoutTax",shippingLabel:"Cart.PriceSummary.shipping.label",zipPlaceholder:"Cart.PriceSummary.shipping.zipPlaceholder",editZipAction:"Cart.PriceSummary.shipping.editZipAction",shippingWithTaxes:"Cart.PriceSummary.shipping.withTaxes",shippingWithoutTaxes:"Cart.PriceSummary.shipping.withoutTaxes",shippingEstimated:"Cart.PriceSummary.shipping.estimated",shippingEstimatedByState:"Cart.PriceSummary.shipping.alternateField.state",shippingEstimatedByZip:"Cart.PriceSummary.shipping.alternateField.zip",destinationLinkAriaLabel:"Cart.PriceSummary.shipping.destinationLinkAriaLabel",applyButton:"Cart.PriceSummary.estimatedShippingForm.apply.label",countryField:"Cart.PriceSummary.estimatedShippingForm.country.placeholder",freeShipping:"Cart.PriceSummary.freeShipping",stateField:"Cart.PriceSummary.estimatedShippingForm.state.placeholder",zipField:"Cart.PriceSummary.estimatedShippingForm.zip.placeholder"}),w=h&&d("div",{className:o(["cart-order-summary__entry","cart-order-summary__subTotal"]),children:[t("span",{className:"cart-order-summary__label",children:a.subtotalLabel}),t(p,{node:h.price,className:"cart-order-summary__price"}),h.taxIncluded&&t("div",{"data-testid":"sub-total-tax-caption",className:"cart-order-summary__caption",children:t("span",{children:a.subtotalWithTaxes})}),h.taxExcluded?t("div",{"data-testid":"sub-total-tax-caption-excluded",className:"cart-order-summary__caption",children:d("span",{children:[h.priceExcludingTax,"Â ",a.subtotalWithoutTaxes]})}):void 0]}),N=r&&t(p,{node:r,className:"cart-order-summary__shipping"}),x=C&&C.length>0&&t(hr,{children:C.map(c=>d("div",{className:o(["cart-order-summary__entry","cart-order-summary__discount"]),children:[t("span",{className:"cart-order-summary__label",children:c.label}),t(p,{node:c.price,className:"cart-order-summary__price"}),c.caption&&t(p,{node:c.caption,className:"cart-order-summary__caption"})]},c.label))}),_=v&&v.length>0?t(br,{"data-testid":"tax-breakdown",className:"cart-order-summary__taxes",iconOpen:Nr,iconClose:fr,children:d(Sr,{title:a.taxesBreakdownTitle,secondaryText:!k&&m?t(p,{node:m.price,className:"cart-order-summary__price"}):void 0,renderContentWhenClosed:!1,onStateChange:B,children:[t("div",{className:"cart-order-summary__appliedTaxes",children:v.map(c=>d("div",{className:o(["cart-order-summary__entry","cart-order-summary__taxEntry"]),children:[t("span",{className:o(["cart-order-summary__label","cart-order-summary__label--muted"]),children:c.label}),t(p,{node:c.price,className:o(["cart-order-summary__price","cart-order-summary__price--muted"])})]},c.label))}),d("div",{className:o(["cart-order-summary__entry","cart-order-summary__taxTotal"]),children:[t("span",{className:"cart-order-summary__label",children:a.taxTotal}),m&&t(p,{node:m.price,className:"cart-order-summary__price"})]})]})}):m&&d("div",{"data-testid":"tax-total-only",className:o(["cart-order-summary__entry","cart-order-summary__taxTotal"]),children:[t("span",{className:"cart-order-summary__label",children:m.estimated?a.taxEstimated:a.taxTotalOnly}),t(p,{node:m.price,className:"cart-order-summary__price"})]}),L=u&&d("div",{"data-testid":"total-content",className:o(["cart-order-summary__entry","cart-order-summary__total",u.estimated&&"cart-order-summary__total--padded"]),children:[t("span",{className:o(["cart-order-summary__label","cart-order-summary__label--bold"]),children:u.estimated?a.totalEstimated:a.totalLabel}),t(p,{node:u.price,className:o(["cart-order-summary__price","cart-order-summary__price--bold"])})]}),f=u&&u.priceWithoutTax&&d("div",{"data-testid":"total-without-tax",className:o(["cart-order-summary__entry","cart-order-summary__totalWithoutTax"]),children:[t("span",{className:o(["cart-order-summary__label","cart-order-summary__label--muted"]),children:a.totalWithoutTax}),t(p,{node:u.priceWithoutTax,className:o(["cart-order-summary__price","cart-order-summary__price--muted"])})]}),E=P&&t("div",{className:o(["cart-order-summary__entry","cart-order-summary__primaryAction"]),children:P});return d("div",{...e,className:o(["cart-order-summary",["cart-order-summary--loading",I],[`cart-order-summary__${S}`,S],g]),children:[I&&t(Cr,{className:"cart-order-summary__spinner"}),d("div",{className:"cart-order-summary__heading",children:[y&&t(p,{node:y,className:"cart-order-summary__heading-text"}),t(vr,{variant:"primary",className:"cart-order-summary__divider-primary"})]}),d("div",{className:"cart-order-summary__content",children:[w,N,x,_,L,f,E]})]})},Ir=({children:g,initialData:D=null,routeCheckout:S,slots:y,errors:I,...h})=>{var f,E,c,O,W,A,F,z,G,V,Z,j,n,T,b,U,Q,X,q,$,H,R,J,ar,ir,nr,cr,sr;const[r,C]=Y(D),[m,v]=Y(!1),u=r==null?void 0:r.isVirtual,{handleEstimateTotals:P,estimatedTotals:e,setEstimatedTotals:k,loading:B}=wr(),a=(f=_r.config)==null?void 0:f.shoppingCartDisplaySetting,w=(a==null?void 0:a.subtotal)==="INCLUDING_TAX",N=(a==null?void 0:a.subtotal)==="INCLUDING_EXCLUDING_TAX",x=a==null?void 0:a.zeroTax;tr(()=>{const s=pr.on("cart/data",i=>{var K;C(i);const rr=(K=i==null?void 0:i.addresses)==null?void 0:K.shipping,er=i==null?void 0:i.isVirtual;(rr||er)&&k(null)},{eager:!0});return()=>{s==null||s.off()}},[]),tr(()=>{v(I)},[I]),tr(()=>{const s=pr.on("shipping/estimate",i=>{var K,or,mr,ur,lr,dr;const rr={shippingCountry:(K=i==null?void 0:i.address)==null?void 0:K.countryCode,shippingState:(or=i==null?void 0:i.address)==null?void 0:or.region,shippingStateId:(mr=i==null?void 0:i.address)==null?void 0:mr.regionId,shippingZip:(ur=i==null?void 0:i.address)==null?void 0:ur.postCode},er={carrier_code:((lr=i==null?void 0:i.shippingMethod)==null?void 0:lr.carrierCode)||"",method_code:((dr=i==null?void 0:i.shippingMethod)==null?void 0:dr.methodCode)||""};P(rr,er)});return()=>{s==null||s.off()}},[P]);const _=yr({checkout:"Cart.PriceSummary.checkout",orderSummary:"Cart.PriceSummary.orderSummary",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined"}),L=!u&&(y!=null&&y.EstimateShipping)?t(xr,{name:"EstimateShipping",slot:y.EstimateShipping},"estimateShippingId"):void 0;return!Object.keys(r??{}).length||(r==null?void 0:r.totalQuantity)===0?null:t(Er,{...h,"data-testid":"cart-order-summary",heading:t("div",{children:_.orderSummary}),shipping:L,loading:B,subTotal:{taxIncluded:w&&!x,taxExcluded:N,zeroTaxSubtotal:x,priceExcludingTax:(E=e==null?void 0:e.estimatedSubTotal)!=null&&E.excludingTax?t(l,{"data-testid":"subtotal",...(c=e==null?void 0:e.estimatedSubTotal)==null?void 0:c.excludingTax}):t(l,{"data-testid":"subtotal",amount:(W=(O=r==null?void 0:r.subtotal)==null?void 0:O.excludingTax)==null?void 0:W.value,currency:(F=(A=r==null?void 0:r.subtotal)==null?void 0:A.excludingTax)==null?void 0:F.currency}),price:!x&&w||!x&&N?(z=e==null?void 0:e.estimatedSubTotal)!=null&&z.includingTax?t(l,{"data-testid":"subtotal",...(G=e==null?void 0:e.estimatedSubTotal)==null?void 0:G.includingTax}):t(l,{"data-testid":"subtotal",amount:(V=r==null?void 0:r.subtotal.includingTax)==null?void 0:V.value,currency:(Z=r==null?void 0:r.subtotal.includingTax)==null?void 0:Z.currency}):t(l,{"data-testid":"subtotal",amount:(n=(j=r==null?void 0:r.subtotal)==null?void 0:j.excludingTax)==null?void 0:n.value,currency:(b=(T=r==null?void 0:r.subtotal)==null?void 0:T.excludingTax)==null?void 0:b.currency})},discounts:(U=r==null?void 0:r.appliedDiscounts)==null?void 0:U.map(s=>({label:s.label,price:t(l,{"data-testid":"summary-discount-total",amount:-s.amount.value,currency:s.amount.currency,sale:!0})})),taxTotal:u?{price:t("span",{"data-testid":"tax-total",children:_.taxToBeDetermined})}:{price:e!=null&&e.estimatedTaxTotal?t(l,{"data-testid":"tax-total",...e==null?void 0:e.estimatedTaxTotal}):t(l,{"data-testid":"tax-total",amount:(Q=r==null?void 0:r.totalTax)==null?void 0:Q.value,currency:(X=r==null?void 0:r.totalTax)==null?void 0:X.currency}),estimated:(!e||!!(e!=null&&e.estimatedTaxTotal))&&!((q=r==null?void 0:r.addresses)!=null&&q.shipping)},taxesApplied:u?void 0:a!=null&&a.fullSummary?(H=(($=e==null?void 0:e.estimatedAppliedTaxes)==null?void 0:$.taxes)||(r==null?void 0:r.appliedTaxes))==null?void 0:H.map(s=>({label:s.label,price:t(l,{"data-testid":"applied-taxes",amount:s.amount.value,currency:s.amount.currency})})):void 0,total:{price:e!=null&&e.estimatedGrandTotalPrice?t(l,{...(R=e==null?void 0:e.estimatedGrandTotalPrice)==null?void 0:R.includingTax}):t(l,{amount:(J=r==null?void 0:r.total)==null?void 0:J.includingTax.value,currency:(ar=r==null?void 0:r.total)==null?void 0:ar.includingTax.currency}),estimated:(!e||!!(e!=null&&e.estimatedTaxTotal))&&!((ir=r==null?void 0:r.addresses)!=null&&ir.shipping),priceWithoutTax:a!=null&&a.grandTotal?e!=null&&e.estimatedAppliedTaxes?t(l,{...(nr=e==null?void 0:e.estimatedGrandTotalPrice)==null?void 0:nr.excludingTax}):t(l,{amount:(cr=r==null?void 0:r.total)==null?void 0:cr.excludingTax.value,currency:(sr=r==null?void 0:r.total)==null?void 0:sr.excludingTax.currency}):void 0},primaryAction:S&&t(Pr,{"data-testid":"checkout-button",variant:"primary",disabled:(r==null?void 0:r.hasOutOfStockItems)||m,"aria-disabled":(r==null?void 0:r.hasOutOfStockItems)||m,href:r!=null&&r.hasOutOfStockItems||m?void 0:S({cartId:r.id}),children:_.checkout})})};Ir.getInitialData=async function(){return gr()};export{Ir as O};
