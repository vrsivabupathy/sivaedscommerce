/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsxs as p,jsx as t,Fragment as Er}from"@dropins/tools/preact-jsx-runtime.js";import*as Nr from"@dropins/tools/preact-compat.js";import{useState as er,useEffect as ir,useCallback as Br}from"@dropins/tools/preact-compat.js";import{classes as o,VComponent as l,Slot as fr}from"@dropins/tools/lib.js";import{events as wr}from"@dropins/tools/event-bus.js";import{g as Dr}from"./persisted-data.js";import{s as Ir}from"./resetCart.js";import{g as Lr}from"./getEstimatedTotals.js";import{b as Wr}from"./acdl.js";import{Accordion as Ar,AccordionSection as Or,ProgressSpinner as Fr,Divider as Gr,Price as d,Icon as zr,Button as Vr}from"@dropins/tools/components.js";/* empty css       */import{S as Zr}from"./ChevronDown.js";import{useText as kr}from"@dropins/tools/i18n.js";import{S as jr}from"./Coupon.js";const Ur=()=>{const[E,F]=er(!1),[v,m]=er();return{handleEstimateTotals:(g,x)=>{F(!0);const{shippingCountry:P,shippingState:r="",shippingStateId:N,shippingZip:y=""}=g,D={countryCode:P,postcode:y,region:{region:r,id:N},shipping_method:{carrier_code:(x==null?void 0:x.carrier_code)||"",method_code:(x==null?void 0:x.method_code)||""}};Lr(D).then(c=>{var S,e,f,L,i,w,I,T,h,_,W,A,O,k,u,G,z,V,Z,j;c&&m({estimatedTaxTotal:{amount:(S=c.totalTax)==null?void 0:S.value,currency:(e=c.totalTax)==null?void 0:e.currency},estimatedSubTotal:{excludingTax:{amount:(L=(f=c.subtotal)==null?void 0:f.excludingTax)==null?void 0:L.value,currency:(w=(i=c.subtotal)==null?void 0:i.excludingTax)==null?void 0:w.currency},includingTax:{amount:(T=(I=c.subtotal)==null?void 0:I.includingTax)==null?void 0:T.value,currency:(_=(h=c.subtotal)==null?void 0:h.includingTax)==null?void 0:_.currency},includingDiscountOnly:{amount:(A=(W=c.subtotal)==null?void 0:W.includingDiscountOnly)==null?void 0:A.value,currency:(k=(O=c.subtotal)==null?void 0:O.includingDiscountOnly)==null?void 0:k.currency}},estimatedGrandTotalPrice:{includingTax:{amount:(u=c.total)==null?void 0:u.includingTax.value,currency:(G=c.total)==null?void 0:G.includingTax.currency},excludingTax:{amount:(z=c.total)==null?void 0:z.excludingTax.value,currency:(V=c.total)==null?void 0:V.excludingTax.currency}},estimatedAppliedTaxes:{taxes:(Z=c.appliedTaxes)==null?void 0:Z.map(s=>{var b,C;return{label:s.label,amount:{value:(b=s.amount)==null?void 0:b.value,currency:(C=s.amount)==null?void 0:C.currency}}})},estimatedItems:{items:(j=c.items)==null?void 0:j.map(s=>{var b,C,U,Q,X,$,q,H,R,J;return{uid:s.uid,price:{amount:(b=s.price)==null?void 0:b.value,currency:(C=s.price)==null?void 0:C.currency},taxedPrice:{amount:(U=s.taxedPrice)==null?void 0:U.value,currency:(Q=s.taxedPrice)==null?void 0:Q.currency},rowTotal:{amount:(X=s.rowTotal)==null?void 0:X.value,currency:($=s.rowTotal)==null?void 0:$.currency},rowTotalIncludingTax:{amount:(q=s.rowTotalIncludingTax)==null?void 0:q.value,currency:(H=s.rowTotalIncludingTax)==null?void 0:H.currency},regularPrice:{amount:(R=s.regularPrice)==null?void 0:R.value,currency:(J=s.regularPrice)==null?void 0:J.currency}}})}})}).finally(()=>{F(!1)})},estimatedTotals:v,setEstimatedTotals:m,loading:E}},Qr=E=>Nr.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...E},Nr.createElement("path",{d:"M7.74512 14.132L12.0001 9.87701L16.2551 14.132",stroke:"#2B2B2B",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round"})),Xr=({className:E,children:F,variant:v="primary",heading:m,loading:B=!0,subTotal:g,shipping:x,discounts:P,taxTotal:r,taxesApplied:N,total:y,primaryAction:D,coupons:c,totalSaved:S,...e})=>{const[f,L]=er(!1),i=kr({checkout:"Cart.PriceSummary.checkout",discountedPrice:"Cart.CartItem.discountedPrice",download:"Cart.CartItem.download",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",regularPrice:"Cart.CartItem.regularPrice",recipient:"Cart.CartItem.recipient",sender:"Cart.CartItem.sender",file:"Cart.CartItem.file",files:"Cart.CartItem.files",orderSummary:"Cart.PriceSummary.orderSummary",taxesBreakdownTitle:"Cart.PriceSummary.taxes.breakdown",taxTotal:"Cart.PriceSummary.taxes.total",taxEstimated:"Cart.PriceSummary.taxes.estimated",taxTotalOnly:"Cart.PriceSummary.taxes.totalOnly",showTaxBreakdown:"Cart.PriceSummary.taxes.showBreakdown",hideTaxBreakdown:"Cart.PriceSummary.taxes.hideBreakdown",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined",subtotalLabel:"Cart.PriceSummary.subTotal.label",subtotalWithTaxes:"Cart.PriceSummary.subTotal.withTaxes",subtotalWithoutTaxes:"Cart.PriceSummary.subTotal.withoutTaxes",totalEstimated:"Cart.PriceSummary.total.estimated",totalLabel:"Cart.PriceSummary.total.label",totalWithoutTax:"Cart.PriceSummary.total.withoutTax",totalSaved:"Cart.PriceSummary.total.saved",shippingLabel:"Cart.PriceSummary.shipping.label",zipPlaceholder:"Cart.PriceSummary.shipping.zipPlaceholder",editZipAction:"Cart.PriceSummary.shipping.editZipAction",shippingWithTaxes:"Cart.PriceSummary.shipping.withTaxes",shippingWithoutTaxes:"Cart.PriceSummary.shipping.withoutTaxes",shippingEstimated:"Cart.PriceSummary.shipping.estimated",shippingEstimatedByState:"Cart.PriceSummary.shipping.alternateField.state",shippingEstimatedByZip:"Cart.PriceSummary.shipping.alternateField.zip",destinationLinkAriaLabel:"Cart.PriceSummary.shipping.destinationLinkAriaLabel",applyButton:"Cart.PriceSummary.estimatedShippingForm.apply.label",countryField:"Cart.PriceSummary.estimatedShippingForm.country.placeholder",freeShipping:"Cart.PriceSummary.freeShipping",stateField:"Cart.PriceSummary.estimatedShippingForm.state.placeholder",zipField:"Cart.PriceSummary.estimatedShippingForm.zip.placeholder"}),w=g&&p("div",{className:o(["cart-order-summary__entry","cart-order-summary__subTotal"]),children:[t("span",{className:"cart-order-summary__label",children:i.subtotalLabel}),t(l,{node:g.price,className:"cart-order-summary__price"}),g.taxIncluded&&t("div",{"data-testid":"sub-total-tax-caption",className:"cart-order-summary__caption",children:t("span",{children:i.subtotalWithTaxes})}),g.taxExcluded?t("div",{"data-testid":"sub-total-tax-caption-excluded",className:"cart-order-summary__caption",children:p("span",{children:[g.priceExcludingTax,"Â ",i.subtotalWithoutTaxes]})}):void 0]}),I=x&&t(l,{node:x,className:"cart-order-summary__shipping"}),T=c&&t(l,{node:c,className:"cart-order-summary__coupons"}),h=P&&P.length>0&&t(Er,{children:P.map(u=>p("div",{className:o(["cart-order-summary__entry","cart-order-summary__discount"]),children:[t("span",{className:"cart-order-summary__label",children:u.label}),t(l,{node:u.price,className:"cart-order-summary__price"}),u.coupon&&t(l,{node:u.coupon,className:"cart-order-summary__coupon__code"}),u.caption&&t(l,{node:u.caption,className:"cart-order-summary__caption"})]},u.label))}),_=N&&N.length>0?t(Ar,{"data-testid":"tax-breakdown",className:"cart-order-summary__taxes",iconOpen:Zr,iconClose:Qr,children:p(Or,{title:i.taxesBreakdownTitle,secondaryText:!f&&r?t(l,{node:r.price,className:"cart-order-summary__price"}):void 0,renderContentWhenClosed:!1,onStateChange:L,children:[t("div",{className:"cart-order-summary__appliedTaxes",children:N.map(u=>p("div",{className:o(["cart-order-summary__entry","cart-order-summary__taxEntry"]),children:[t("span",{className:o(["cart-order-summary__label","cart-order-summary__label--muted"]),children:u.label}),t(l,{node:u.price,className:o(["cart-order-summary__price","cart-order-summary__price--muted"])})]},u.label))}),p("div",{className:o(["cart-order-summary__entry","cart-order-summary__taxTotal"]),children:[t("span",{className:"cart-order-summary__label",children:i.taxTotal}),r&&t(l,{node:r.price,className:"cart-order-summary__price"})]})]})}):r&&p("div",{"data-testid":"tax-total-only",className:o(["cart-order-summary__entry","cart-order-summary__taxTotal"]),children:[t("span",{className:"cart-order-summary__label",children:r.estimated?i.taxEstimated:i.taxTotalOnly}),t(l,{node:r.price,className:"cart-order-summary__price"})]}),W=y&&p("div",{"data-testid":"total-content",className:o(["cart-order-summary__entry","cart-order-summary__total",y.estimated&&"cart-order-summary__total--padded"]),children:[t("span",{className:o(["cart-order-summary__label","cart-order-summary__label--bold"]),children:y.estimated?i.totalEstimated:i.totalLabel}),t(l,{node:y.price,className:o(["cart-order-summary__price","cart-order-summary__price--bold"])})]}),A=y&&y.priceWithoutTax&&p("div",{"data-testid":"total-without-tax",className:o(["cart-order-summary__entry","cart-order-summary__totalWithoutTax"]),children:[t("span",{className:o(["cart-order-summary__label","cart-order-summary__label--muted"]),children:i.totalWithoutTax}),t(l,{node:y.priceWithoutTax,className:o(["cart-order-summary__price","cart-order-summary__price--muted"])})]}),O=D&&t("div",{className:o(["cart-order-summary__entry","cart-order-summary__primaryAction"]),children:D}),k=S&&p("div",{"data-testid":"total-saved",className:o(["cart-order-summary__entry","cart-order-summary__saved"]),children:[t("span",{className:o(["cart-order-summary__label","cart-order-summary__label--muted"]),children:i.totalSaved}),t(l,{node:S,className:o(["cart-order-summary__price","cart-order-summary__price--muted"])})]});return p("div",{...e,className:o(["cart-order-summary",["cart-order-summary--loading",B],[`cart-order-summary__${v}`,v],E]),children:[B&&t(Fr,{className:"cart-order-summary__spinner"}),p("div",{className:"cart-order-summary__heading",children:[m&&t(l,{node:m,className:"cart-order-summary__heading-text"}),t(Gr,{variant:"primary",className:"cart-order-summary__divider-primary"})]}),p("div",{className:"cart-order-summary__content",children:[w,I,h,_,W,A,k,O,T]})]})},$r=({children:E,initialData:F=null,routeCheckout:v,slots:m,errors:B,showTotalSaved:g,enableCoupons:x,...P})=>{var k,u,G,z,V,Z,j,s,b,C,U,Q,X,$,q,H,R,J,cr,nr,sr,or,ur,mr,lr,dr,pr,xr,hr,yr,_r,gr,Tr,Sr,br,Cr;const[r,N]=er(F),[y,D]=er(!1),c=r==null?void 0:r.isVirtual;x=x??!0;const{handleEstimateTotals:S,estimatedTotals:e,setEstimatedTotals:f,loading:L}=Ur(),i=(k=Ir.config)==null?void 0:k.shoppingCartDisplaySetting,w=(i==null?void 0:i.subtotal)==="INCLUDING_TAX",I=(i==null?void 0:i.subtotal)==="INCLUDING_EXCLUDING_TAX",T=i==null?void 0:i.zeroTax;ir(()=>{const n=wr.on("cart/data",a=>{var K,Y,M,rr;N(a);const tr=(K=a==null?void 0:a.addresses)==null?void 0:K.shipping,ar=a==null?void 0:a.isVirtual;(tr||ar)&&f(null),((Y=a==null?void 0:a.totalTax)==null?void 0:Y.value)>0&&e===void 0&&f({estimatedTaxTotal:{amount:(M=a==null?void 0:a.totalTax)==null?void 0:M.value,currency:(rr=a==null?void 0:a.totalTax)==null?void 0:rr.currency}})},{eager:!0});return()=>{n==null||n.off()}},[]),ir(()=>{D(B)},[B]),ir(()=>{const n=wr.on("shipping/estimate",a=>{var K,Y,M,rr,vr,Pr;const tr={shippingCountry:(K=a==null?void 0:a.address)==null?void 0:K.countryCode,shippingState:(Y=a==null?void 0:a.address)==null?void 0:Y.region,shippingStateId:(M=a==null?void 0:a.address)==null?void 0:M.regionId,shippingZip:(rr=a==null?void 0:a.address)==null?void 0:rr.postCode},ar={carrier_code:((vr=a==null?void 0:a.shippingMethod)==null?void 0:vr.carrierCode)||"",method_code:((Pr=a==null?void 0:a.shippingMethod)==null?void 0:Pr.methodCode)||""};S(tr,ar)});return()=>{n==null||n.off()}},[S]);const h=kr({checkout:"Cart.PriceSummary.checkout",free:"Cart.PriceSummary.total.free",orderSummary:"Cart.PriceSummary.orderSummary",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined"}),_=(r==null?void 0:r.hasOutOfStockItems)||y,W=Br(()=>{!_&&r&&Wr(r,Ir.locale)},[_,r]),A=!c&&(m!=null&&m.EstimateShipping)?t(fr,{name:"EstimateShipping",slot:m.EstimateShipping},"estimateShippingId"):void 0;if(!Object.keys(r??{}).length||(r==null?void 0:r.totalQuantity)===0)return null;const O=x&&(m!=null&&m.Coupons)?t(fr,{name:"Coupons",slot:m.Coupons},"couponsId"):void 0;return t(Xr,{...P,"data-testid":"cart-order-summary",heading:t("div",{children:h.orderSummary}),shipping:A,coupons:O,loading:L,subTotal:{taxIncluded:w&&!T,taxExcluded:I,zeroTaxSubtotal:T,priceExcludingTax:(u=e==null?void 0:e.estimatedSubTotal)!=null&&u.excludingTax?t(d,{"data-testid":"subtotal",...(G=e==null?void 0:e.estimatedSubTotal)==null?void 0:G.excludingTax}):t(d,{"data-testid":"subtotal",amount:(V=(z=r==null?void 0:r.subtotal)==null?void 0:z.excludingTax)==null?void 0:V.value,currency:(j=(Z=r==null?void 0:r.subtotal)==null?void 0:Z.excludingTax)==null?void 0:j.currency}),price:!T&&w||!T&&I?(s=e==null?void 0:e.estimatedSubTotal)!=null&&s.includingTax?t(d,{"data-testid":"subtotal",...(b=e==null?void 0:e.estimatedSubTotal)==null?void 0:b.includingTax}):t(d,{"data-testid":"subtotal",amount:(C=r==null?void 0:r.subtotal.includingTax)==null?void 0:C.value,currency:(U=r==null?void 0:r.subtotal.includingTax)==null?void 0:U.currency}):t(d,{"data-testid":"subtotal",amount:(X=(Q=r==null?void 0:r.subtotal)==null?void 0:Q.excludingTax)==null?void 0:X.value,currency:(q=($=r==null?void 0:r.subtotal)==null?void 0:$.excludingTax)==null?void 0:q.currency})},discounts:(H=r==null?void 0:r.appliedDiscounts)==null?void 0:H.map(n=>{var a;return{label:n.label,price:t(d,{"data-testid":"summary-discount-total",amount:-n.amount.value,currency:n.amount.currency,sale:!0}),coupon:n!=null&&n.coupon?p("span",{children:[t(zr,{source:jr,size:"16"}),(a=n==null?void 0:n.coupon)==null?void 0:a.code]}):void 0}}),taxTotal:c||(e==null?void 0:e.estimatedTaxTotal)===void 0?{price:t("span",{"data-testid":"tax-total",children:h.taxToBeDetermined})}:{price:e!=null&&e.estimatedTaxTotal?t(d,{"data-testid":"tax-total",...e==null?void 0:e.estimatedTaxTotal}):t(d,{"data-testid":"tax-total",amount:(R=r==null?void 0:r.totalTax)==null?void 0:R.value,currency:(J=r==null?void 0:r.totalTax)==null?void 0:J.currency}),estimated:(!e||!!(e!=null&&e.estimatedTaxTotal))&&!((cr=r==null?void 0:r.addresses)!=null&&cr.shipping)},taxesApplied:c?void 0:i!=null&&i.fullSummary?(sr=((nr=e==null?void 0:e.estimatedAppliedTaxes)==null?void 0:nr.taxes)||(r==null?void 0:r.appliedTaxes))==null?void 0:sr.map(n=>({label:n.label,price:t(d,{"data-testid":"applied-taxes",amount:n.amount.value,currency:n.amount.currency})})):void 0,total:{price:e!=null&&e.estimatedGrandTotalPrice?((ur=(or=e==null?void 0:e.estimatedGrandTotalPrice)==null?void 0:or.includingTax)==null?void 0:ur.amount)===0?t("span",{"data-testid":"total-including-tax",children:h.free}):t(d,{"data-testid":"total-including-tax",...(mr=e==null?void 0:e.estimatedGrandTotalPrice)==null?void 0:mr.includingTax}):((lr=r==null?void 0:r.total)==null?void 0:lr.includingTax.value)===0?t("span",{"data-testid":"total-including-tax",children:h.free}):t(d,{"data-testid":"total-including-tax",amount:(dr=r==null?void 0:r.total)==null?void 0:dr.includingTax.value,currency:(pr=r==null?void 0:r.total)==null?void 0:pr.includingTax.currency}),estimated:(!e||!!(e!=null&&e.estimatedTaxTotal))&&!((xr=r==null?void 0:r.addresses)!=null&&xr.shipping),priceWithoutTax:i!=null&&i.grandTotal?e!=null&&e.estimatedAppliedTaxes?((yr=(hr=e==null?void 0:e.estimatedGrandTotalPrice)==null?void 0:hr.excludingTax)==null?void 0:yr.amount)===0?t("span",{"data-testid":"total-excluding-tax",children:h.free}):t(d,{"data-testid":"total-excluding-tax",...(_r=e==null?void 0:e.estimatedGrandTotalPrice)==null?void 0:_r.excludingTax}):((gr=r==null?void 0:r.total)==null?void 0:gr.excludingTax.value)===0?t("span",{"data-testid":"total-excluding-tax",children:h.free}):t(d,{"data-testid":"total-excluding-tax",amount:(Tr=r==null?void 0:r.total)==null?void 0:Tr.excludingTax.value,currency:(Sr=r==null?void 0:r.total)==null?void 0:Sr.excludingTax.currency}):void 0},primaryAction:v&&t(Vr,{"data-testid":"checkout-button",variant:"primary",disabled:_,"aria-disabled":_,href:_?void 0:v({cartId:r.id}),onClick:W,children:h.checkout}),totalSaved:g?t(d,{amount:(br=r==null?void 0:r.discount)==null?void 0:br.value,currency:(Cr=r==null?void 0:r.total)==null?void 0:Cr.includingTax.currency}):void 0})};$r.getInitialData=async function(){return Dr()};export{$r as O};
