import{jsxs as y,jsx as t,Fragment as br}from"@dropins/tools/preact-jsx-runtime.js";import*as hr from"@dropins/tools/preact-compat.js";import{useState as Y,useEffect as er,useCallback as Cr}from"@dropins/tools/preact-compat.js";import{classes as m,VComponent as d,Slot as xr}from"@dropins/tools/lib.js";import{events as _r}from"@dropins/tools/event-bus.js";import{g as Sr}from"./persisted-data.js";import{s as gr}from"./resetCart.js";import{g as vr}from"./getEstimatedTotals.js";import{b as Pr}from"./acdl.js";import{Accordion as Nr,AccordionSection as wr,ProgressSpinner as fr,Divider as Ir,Price as p,Icon as kr,Button as Er}from"@dropins/tools/components.js";/* empty css       */import{S as Br}from"./ChevronDown.js";import{useText as Tr}from"@dropins/tools/i18n.js";import{S as Dr}from"./Coupon.js";const Lr=()=>{const[I,A]=Y(!1),[S,u]=Y();return{handleEstimateTotals:(_,r)=>{A(!0);const{shippingCountry:v,shippingState:h="",shippingStateId:P,shippingZip:l=""}=_,N={countryCode:v,postcode:l,region:{region:h,id:P},shipping_method:{carrier_code:(r==null?void 0:r.carrier_code)||"",method_code:(r==null?void 0:r.method_code)||""}};vr(N).then(e=>{var E,B,n,s,w,g,T,x,D,L,W,f,o,O,F,z,G,V,Z,j;e&&u({estimatedTaxTotal:{amount:(E=e.totalTax)==null?void 0:E.value,currency:(B=e.totalTax)==null?void 0:B.currency},estimatedSubTotal:{excludingTax:{amount:(s=(n=e.subtotal)==null?void 0:n.excludingTax)==null?void 0:s.value,currency:(g=(w=e.subtotal)==null?void 0:w.excludingTax)==null?void 0:g.currency},includingTax:{amount:(x=(T=e.subtotal)==null?void 0:T.includingTax)==null?void 0:x.value,currency:(L=(D=e.subtotal)==null?void 0:D.includingTax)==null?void 0:L.currency},includingDiscountOnly:{amount:(f=(W=e.subtotal)==null?void 0:W.includingDiscountOnly)==null?void 0:f.value,currency:(O=(o=e.subtotal)==null?void 0:o.includingDiscountOnly)==null?void 0:O.currency}},estimatedGrandTotalPrice:{includingTax:{amount:(F=e.total)==null?void 0:F.includingTax.value,currency:(z=e.total)==null?void 0:z.includingTax.currency},excludingTax:{amount:(G=e.total)==null?void 0:G.excludingTax.value,currency:(V=e.total)==null?void 0:V.excludingTax.currency}},estimatedAppliedTaxes:{taxes:(Z=e.appliedTaxes)==null?void 0:Z.map(c=>{var b,C;return{label:c.label,amount:{value:(b=c.amount)==null?void 0:b.value,currency:(C=c.amount)==null?void 0:C.currency}}})},estimatedItems:{items:(j=e.items)==null?void 0:j.map(c=>{var b,C,U,Q,X,$,q,H,R,J;return{uid:c.uid,price:{amount:(b=c.price)==null?void 0:b.value,currency:(C=c.price)==null?void 0:C.currency},taxedPrice:{amount:(U=c.taxedPrice)==null?void 0:U.value,currency:(Q=c.taxedPrice)==null?void 0:Q.currency},rowTotal:{amount:(X=c.rowTotal)==null?void 0:X.value,currency:($=c.rowTotal)==null?void 0:$.currency},rowTotalIncludingTax:{amount:(q=c.rowTotalIncludingTax)==null?void 0:q.value,currency:(H=c.rowTotalIncludingTax)==null?void 0:H.currency},regularPrice:{amount:(R=c.regularPrice)==null?void 0:R.value,currency:(J=c.regularPrice)==null?void 0:J.currency}}})}})}).finally(()=>{A(!1)})},estimatedTotals:S,setEstimatedTotals:u,loading:I}},Wr=I=>hr.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...I},hr.createElement("path",{d:"M7.74512 14.132L12.0001 9.87701L16.2551 14.132",stroke:"#2B2B2B",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round"})),Ar=({className:I,children:A,variant:S="primary",heading:u,loading:k=!0,subTotal:_,shipping:r,discounts:v,taxTotal:h,taxesApplied:P,total:l,primaryAction:N,coupons:e,...E})=>{const[B,n]=Y(!1),s=Tr({checkout:"Cart.PriceSummary.checkout",discountedPrice:"Cart.CartItem.discountedPrice",download:"Cart.CartItem.download",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",regularPrice:"Cart.CartItem.regularPrice",recipient:"Cart.CartItem.recipient",sender:"Cart.CartItem.sender",file:"Cart.CartItem.file",files:"Cart.CartItem.files",orderSummary:"Cart.PriceSummary.orderSummary",taxesBreakdownTitle:"Cart.PriceSummary.taxes.breakdown",taxTotal:"Cart.PriceSummary.taxes.total",taxEstimated:"Cart.PriceSummary.taxes.estimated",taxTotalOnly:"Cart.PriceSummary.taxes.totalOnly",showTaxBreakdown:"Cart.PriceSummary.taxes.showBreakdown",hideTaxBreakdown:"Cart.PriceSummary.taxes.hideBreakdown",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined",subtotalLabel:"Cart.PriceSummary.subTotal.label",subtotalWithTaxes:"Cart.PriceSummary.subTotal.withTaxes",subtotalWithoutTaxes:"Cart.PriceSummary.subTotal.withoutTaxes",totalEstimated:"Cart.PriceSummary.total.estimated",totalLabel:"Cart.PriceSummary.total.label",totalWithoutTax:"Cart.PriceSummary.total.withoutTax",shippingLabel:"Cart.PriceSummary.shipping.label",zipPlaceholder:"Cart.PriceSummary.shipping.zipPlaceholder",editZipAction:"Cart.PriceSummary.shipping.editZipAction",shippingWithTaxes:"Cart.PriceSummary.shipping.withTaxes",shippingWithoutTaxes:"Cart.PriceSummary.shipping.withoutTaxes",shippingEstimated:"Cart.PriceSummary.shipping.estimated",shippingEstimatedByState:"Cart.PriceSummary.shipping.alternateField.state",shippingEstimatedByZip:"Cart.PriceSummary.shipping.alternateField.zip",destinationLinkAriaLabel:"Cart.PriceSummary.shipping.destinationLinkAriaLabel",applyButton:"Cart.PriceSummary.estimatedShippingForm.apply.label",countryField:"Cart.PriceSummary.estimatedShippingForm.country.placeholder",freeShipping:"Cart.PriceSummary.freeShipping",stateField:"Cart.PriceSummary.estimatedShippingForm.state.placeholder",zipField:"Cart.PriceSummary.estimatedShippingForm.zip.placeholder"}),w=_&&y("div",{className:m(["cart-order-summary__entry","cart-order-summary__subTotal"]),children:[t("span",{className:"cart-order-summary__label",children:s.subtotalLabel}),t(d,{node:_.price,className:"cart-order-summary__price"}),_.taxIncluded&&t("div",{"data-testid":"sub-total-tax-caption",className:"cart-order-summary__caption",children:t("span",{children:s.subtotalWithTaxes})}),_.taxExcluded?t("div",{"data-testid":"sub-total-tax-caption-excluded",className:"cart-order-summary__caption",children:y("span",{children:[_.priceExcludingTax,"Â ",s.subtotalWithoutTaxes]})}):void 0]}),g=r&&t(d,{node:r,className:"cart-order-summary__shipping"}),T=e&&t(d,{node:e,className:"cart-order-summary__coupons"}),x=v&&v.length>0&&t(br,{children:v.map(o=>y("div",{className:m(["cart-order-summary__entry","cart-order-summary__discount"]),children:[t("span",{className:"cart-order-summary__label",children:o.label}),t(d,{node:o.price,className:"cart-order-summary__price"}),o.coupon&&t(d,{node:o.coupon,className:"cart-order-summary__coupon__code"}),o.caption&&t(d,{node:o.caption,className:"cart-order-summary__caption"})]},o.label))}),D=P&&P.length>0?t(Nr,{"data-testid":"tax-breakdown",className:"cart-order-summary__taxes",iconOpen:Br,iconClose:Wr,children:y(wr,{title:s.taxesBreakdownTitle,secondaryText:!B&&h?t(d,{node:h.price,className:"cart-order-summary__price"}):void 0,renderContentWhenClosed:!1,onStateChange:n,children:[t("div",{className:"cart-order-summary__appliedTaxes",children:P.map(o=>y("div",{className:m(["cart-order-summary__entry","cart-order-summary__taxEntry"]),children:[t("span",{className:m(["cart-order-summary__label","cart-order-summary__label--muted"]),children:o.label}),t(d,{node:o.price,className:m(["cart-order-summary__price","cart-order-summary__price--muted"])})]},o.label))}),y("div",{className:m(["cart-order-summary__entry","cart-order-summary__taxTotal"]),children:[t("span",{className:"cart-order-summary__label",children:s.taxTotal}),h&&t(d,{node:h.price,className:"cart-order-summary__price"})]})]})}):h&&y("div",{"data-testid":"tax-total-only",className:m(["cart-order-summary__entry","cart-order-summary__taxTotal"]),children:[t("span",{className:"cart-order-summary__label",children:h.estimated?s.taxEstimated:s.taxTotalOnly}),t(d,{node:h.price,className:"cart-order-summary__price"})]}),L=l&&y("div",{"data-testid":"total-content",className:m(["cart-order-summary__entry","cart-order-summary__total",l.estimated&&"cart-order-summary__total--padded"]),children:[t("span",{className:m(["cart-order-summary__label","cart-order-summary__label--bold"]),children:l.estimated?s.totalEstimated:s.totalLabel}),t(d,{node:l.price,className:m(["cart-order-summary__price","cart-order-summary__price--bold"])})]}),W=l&&l.priceWithoutTax&&y("div",{"data-testid":"total-without-tax",className:m(["cart-order-summary__entry","cart-order-summary__totalWithoutTax"]),children:[t("span",{className:m(["cart-order-summary__label","cart-order-summary__label--muted"]),children:s.totalWithoutTax}),t(d,{node:l.priceWithoutTax,className:m(["cart-order-summary__price","cart-order-summary__price--muted"])})]}),f=N&&t("div",{className:m(["cart-order-summary__entry","cart-order-summary__primaryAction"]),children:N});return y("div",{...E,className:m(["cart-order-summary",["cart-order-summary--loading",k],[`cart-order-summary__${S}`,S],I]),children:[k&&t(fr,{className:"cart-order-summary__spinner"}),y("div",{className:"cart-order-summary__heading",children:[u&&t(d,{node:u,className:"cart-order-summary__heading-text"}),t(Ir,{variant:"primary",className:"cart-order-summary__divider-primary"})]}),y("div",{className:"cart-order-summary__content",children:[w,g,x,D,L,W,f,T]})]})},Or=({children:I,initialData:A=null,routeCheckout:S,slots:u,errors:k,..._})=>{var f,o,O,F,z,G,V,Z,j,c,b,C,U,Q,X,$,q,H,R,J,tr,ar,ir,nr,cr,or,sr,mr;const[r,v]=Y(A),[h,P]=Y(!1),l=r==null?void 0:r.isVirtual,{handleEstimateTotals:N,estimatedTotals:e,setEstimatedTotals:E,loading:B}=Lr(),n=(f=gr.config)==null?void 0:f.shoppingCartDisplaySetting,s=(n==null?void 0:n.subtotal)==="INCLUDING_TAX",w=(n==null?void 0:n.subtotal)==="INCLUDING_EXCLUDING_TAX",g=n==null?void 0:n.zeroTax;er(()=>{const i=_r.on("cart/data",a=>{var K;v(a);const M=(K=a==null?void 0:a.addresses)==null?void 0:K.shipping,rr=a==null?void 0:a.isVirtual;(M||rr)&&E(null)},{eager:!0});return()=>{i==null||i.off()}},[]),er(()=>{P(k)},[k]),er(()=>{const i=_r.on("shipping/estimate",a=>{var K,ur,lr,dr,pr,yr;const M={shippingCountry:(K=a==null?void 0:a.address)==null?void 0:K.countryCode,shippingState:(ur=a==null?void 0:a.address)==null?void 0:ur.region,shippingStateId:(lr=a==null?void 0:a.address)==null?void 0:lr.regionId,shippingZip:(dr=a==null?void 0:a.address)==null?void 0:dr.postCode},rr={carrier_code:((pr=a==null?void 0:a.shippingMethod)==null?void 0:pr.carrierCode)||"",method_code:((yr=a==null?void 0:a.shippingMethod)==null?void 0:yr.methodCode)||""};N(M,rr)});return()=>{i==null||i.off()}},[N]);const T=Tr({checkout:"Cart.PriceSummary.checkout",orderSummary:"Cart.PriceSummary.orderSummary",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined"}),x=(r==null?void 0:r.hasOutOfStockItems)||h,D=Cr(()=>{!x&&r&&Pr(r,gr.locale)},[x,r]),L=!l&&(u!=null&&u.EstimateShipping)?t(xr,{name:"EstimateShipping",slot:u.EstimateShipping},"estimateShippingId"):void 0;if(!Object.keys(r??{}).length||(r==null?void 0:r.totalQuantity)===0)return null;const W=u!=null&&u.Coupons?t(xr,{name:"Coupons",slot:u.Coupons},"couponsId"):void 0;return t(Ar,{..._,"data-testid":"cart-order-summary",heading:t("div",{children:T.orderSummary}),shipping:L,coupons:W,loading:B,subTotal:{taxIncluded:s&&!g,taxExcluded:w,zeroTaxSubtotal:g,priceExcludingTax:(o=e==null?void 0:e.estimatedSubTotal)!=null&&o.excludingTax?t(p,{"data-testid":"subtotal",...(O=e==null?void 0:e.estimatedSubTotal)==null?void 0:O.excludingTax}):t(p,{"data-testid":"subtotal",amount:(z=(F=r==null?void 0:r.subtotal)==null?void 0:F.excludingTax)==null?void 0:z.value,currency:(V=(G=r==null?void 0:r.subtotal)==null?void 0:G.excludingTax)==null?void 0:V.currency}),price:!g&&s||!g&&w?(Z=e==null?void 0:e.estimatedSubTotal)!=null&&Z.includingTax?t(p,{"data-testid":"subtotal",...(j=e==null?void 0:e.estimatedSubTotal)==null?void 0:j.includingTax}):t(p,{"data-testid":"subtotal",amount:(c=r==null?void 0:r.subtotal.includingTax)==null?void 0:c.value,currency:(b=r==null?void 0:r.subtotal.includingTax)==null?void 0:b.currency}):t(p,{"data-testid":"subtotal",amount:(U=(C=r==null?void 0:r.subtotal)==null?void 0:C.excludingTax)==null?void 0:U.value,currency:(X=(Q=r==null?void 0:r.subtotal)==null?void 0:Q.excludingTax)==null?void 0:X.currency})},discounts:($=r==null?void 0:r.appliedDiscounts)==null?void 0:$.map(i=>{var a;return{label:i.label,price:t(p,{"data-testid":"summary-discount-total",amount:-i.amount.value,currency:i.amount.currency,sale:!0}),coupon:i!=null&&i.coupon?y("span",{children:[t(kr,{source:Dr,size:"16"}),(a=i==null?void 0:i.coupon)==null?void 0:a.code]}):void 0}}),taxTotal:l?{price:t("span",{"data-testid":"tax-total",children:T.taxToBeDetermined})}:{price:e!=null&&e.estimatedTaxTotal?t(p,{"data-testid":"tax-total",...e==null?void 0:e.estimatedTaxTotal}):t(p,{"data-testid":"tax-total",amount:(q=r==null?void 0:r.totalTax)==null?void 0:q.value,currency:(H=r==null?void 0:r.totalTax)==null?void 0:H.currency}),estimated:(!e||!!(e!=null&&e.estimatedTaxTotal))&&!((R=r==null?void 0:r.addresses)!=null&&R.shipping)},taxesApplied:l?void 0:n!=null&&n.fullSummary?(tr=((J=e==null?void 0:e.estimatedAppliedTaxes)==null?void 0:J.taxes)||(r==null?void 0:r.appliedTaxes))==null?void 0:tr.map(i=>({label:i.label,price:t(p,{"data-testid":"applied-taxes",amount:i.amount.value,currency:i.amount.currency})})):void 0,total:{price:e!=null&&e.estimatedGrandTotalPrice?t(p,{...(ar=e==null?void 0:e.estimatedGrandTotalPrice)==null?void 0:ar.includingTax}):t(p,{amount:(ir=r==null?void 0:r.total)==null?void 0:ir.includingTax.value,currency:(nr=r==null?void 0:r.total)==null?void 0:nr.includingTax.currency}),estimated:(!e||!!(e!=null&&e.estimatedTaxTotal))&&!((cr=r==null?void 0:r.addresses)!=null&&cr.shipping),priceWithoutTax:n!=null&&n.grandTotal?e!=null&&e.estimatedAppliedTaxes?t(p,{...(or=e==null?void 0:e.estimatedGrandTotalPrice)==null?void 0:or.excludingTax}):t(p,{amount:(sr=r==null?void 0:r.total)==null?void 0:sr.excludingTax.value,currency:(mr=r==null?void 0:r.total)==null?void 0:mr.excludingTax.currency}):void 0},primaryAction:S&&t(Er,{"data-testid":"checkout-button",variant:"primary",disabled:x,"aria-disabled":x,href:x?void 0:S({cartId:r.id}),onClick:D,children:T.checkout})})};Or.getInitialData=async function(){return Sr()};export{Or as O};
