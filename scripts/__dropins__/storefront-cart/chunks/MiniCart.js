import{jsx as e,jsxs as h,Fragment as X}from"@dropins/tools/preact-jsx-runtime.js";import{useState as Q,useEffect as C,useCallback as j}from"@dropins/tools/preact-compat.js";import{classes as b,VComponent as f,Slot as S}from"@dropins/tools/lib.js";import{g as D}from"./persisted-data.js";import{events as O}from"@dropins/tools/event-bus.js";/* empty css             */import{Price as P,Button as T}from"@dropins/tools/components.js";import{useText as R}from"@dropins/tools/i18n.js";import{s as _}from"./resetCart.js";import{a as w,b as A}from"./acdl.js";import{u as G}from"./updateProductsFromCart.js";import"./CartSummaryGrid.js";import{C as H}from"./CartSummaryList.js";import"./OrderSummary.js";const F=({className:y,products:n,orderSummary:i,empty:r,...c})=>e("div",{...c,className:b(["cart-cart",y]),children:h("div",{className:b(["cart-cart__wrapper"]),children:[e("div",{"data-testid":"cart-content",className:b(["cart-cart__content",["cart-cart__content--empty",r||i==null],["cart-cart__content--full-width",r||i==null]]),children:n&&e(f,{node:n})}),n&&i&&e(f,{node:i,className:b(["cart-cart__order-summary"])})]})}),V=({className:y,products:n,subtotal:i,subtotalExcludingTaxes:r,ctas:c,...m})=>{const d=R({subtotal:"Cart.MiniCart.subtotal",subtotalExcludingTaxes:"Cart.MiniCart.subtotalExcludingTaxes"});return e("div",{...m,className:b(["cart-mini-cart",y]),children:n&&h(X,{children:[e("div",{className:"cart-mini-cart__products","data-testid":"mini-cart-products-wrapper",children:n}),h("div",{className:"cart-mini-cart__footer","data-testid":"mini-cart-subtotals",children:[i&&h("div",{className:"cart-mini-cart__footer__estimated-total","data-testid":"mini-cart-subtotal",children:[d.subtotal,e(f,{node:i})]}),r&&h("div",{className:"cart-mini-cart__footer__estimated-total-excluding-taxes","data-testid":"mini-cart-subtotal-excluding-taxes",children:[d.subtotalExcludingTaxes,e(f,{node:r,className:b(["dropin-price-summary__price","dropin-price-summary__price--muted"])})]}),c&&e(f,{node:c,className:"cart-mini-cart__footer__ctas"})]})]})})},$=({children:y,routeProduct:n,routeEmptyCartCTA:i,slots:r,showDiscount:c,showSavings:m,quantityType:d,dropdownOptions:I,initialData:s=null,...L})=>{const[t,N]=Q(s),[a,x]=Q(new Map),g={hasErrors:a.size>0},v=(o,p)=>G([{uid:o,quantity:p}]);C(()=>{const o=O.on("cart/data",p=>{N(p)},{eager:!0});return()=>{o==null||o.off()}},[]),C(()=>{s&&Object.keys(s).length>0&&w(s,_.locale??"en-US")},[s]);const u=r!=null&&r.OrderSummary?e(S,{name:"OrderSummary",slot:r.OrderSummary,context:{...g}}):void 0,k=o=>v(o,0),U=e(S,{name:"ProductList",slot:r==null?void 0:r.ProductList,context:{itemQuantityUpdateHandler:v,itemRemoveHandler:k},children:e(H,{"data-testid":"default-cart-summary-list",routeProduct:n,routeEmptyCartCTA:i,initialData:t,enableRemoveItem:!0,enableUpdateItemQuantity:!0,onItemsErrorsChange:x,showDiscount:c,showSavings:m,quantityType:d,dropdownOptions:I})});return e(F,{...L,empty:((t==null?void 0:t.items)&&t.items.length===0)??!0,orderSummary:u,products:U})};$.getInitialData=async function(){return D()};const z=({children:y,initialData:n=null,slots:i,routeProduct:r,routeCart:c,routeCheckout:m,routeEmptyCartCTA:d,showDiscount:I,showSavings:s,...L})=>{var p,M;const[t,N]=Q(n),a=(p=_.config)==null?void 0:p.shoppingCartDisplaySetting;C(()=>{const l=O.on("cart/data",E=>{N(E)},{eager:!0});return()=>{l==null||l.off()}},[]);const x=R({cartLink:"Cart.MiniCart.cartLink",checkoutLink:"Cart.MiniCart.checkoutLink"}),g=(l,E)=>G([{uid:l,quantity:E}]),v=l=>g(l,0),u=t==null?void 0:t.hasOutOfStockItems,k=j(()=>{t&&!u&&A(t,_.locale)},[t,u]);C(()=>{n&&Object.keys(n).length>0&&w(n,_.locale||"en-US")},[n]);const U=e(S,{name:"ProductList",slot:i==null?void 0:i.ProductList,context:{itemQuantityUpdateHandler:g,itemRemoveHandler:v,totalQuantity:t==null?void 0:t.totalQuantity},children:e(H,{"data-testid":"default-cart-summary-list",routeProduct:r,routeEmptyCartCTA:d,initialData:t,maxItems:(M=_.config)==null?void 0:M.miniCartMaxItemsDisplay,hideHeading:!(t!=null&&t.totalQuantity),enableRemoveItem:!0,showDiscount:I,showSavings:s})}),o=()=>(a==null?void 0:a.subtotal)==="INCLUDING_TAX"||(a==null?void 0:a.subtotal)==="INCLUDING_EXCLUDING_TAX"?{amount:t==null?void 0:t.subtotal.includingTax.value,currency:t==null?void 0:t.subtotal.includingTax.currency,"data-testid":"subtotal-including-tax",style:{font:"inherit"}}:{amount:t==null?void 0:t.subtotal.excludingTax.value,currency:t==null?void 0:t.subtotal.excludingTax.currency,"data-testid":"subtotal-excluding-tax",style:{font:"inherit"}};return e(V,{...L,subtotal:t!=null&&t.totalQuantity?(t==null?void 0:t.subtotal)&&e(P,{...o()}):void 0,subtotalExcludingTaxes:t!=null&&t.totalQuantity?(t==null?void 0:t.subtotal)&&((a==null?void 0:a.subtotal)==="INCLUDING_EXCLUDING_TAX"?e(P,{amount:t==null?void 0:t.subtotal.excludingTax.value,currency:t==null?void 0:t.subtotal.excludingTax.currency,"data-testid":"subtotal-including-excluding-tax",style:{font:"inherit"}}):void 0):void 0,ctas:t!=null&&t.totalQuantity?h("div",{children:[m&&e(T,{"data-testid":"route-checkout-button",variant:"primary",href:u?void 0:m(),disabled:u,"aria-disabled":u,onClick:k,children:x.checkoutLink}),c&&e(T,{"data-testid":"route-cart-button",variant:"tertiary",href:c(),children:x.cartLink})]}):void 0,products:U})};z.getInitialData=async function(){return D()};export{$ as C,z as M};
