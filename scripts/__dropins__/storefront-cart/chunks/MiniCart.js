import{jsx as e,jsxs as d,Fragment as R}from"@dropins/tools/preact-jsx-runtime.js";import{useState as L,useEffect as x}from"@dropins/tools/preact-compat.js";import{classes as p,VComponent as _,Slot as k}from"@dropins/tools/lib.js";import{g as Q}from"./persisted-data.js";import{events as E}from"@dropins/tools/event-bus.js";/* empty css             */import{Price as U,Button as O}from"@dropins/tools/components.js";import{useText as M}from"@dropins/tools/i18n.js";import{s as f}from"./resetCart.js";import{p as P,u as T}from"./updateProductsFromCart.js";import"./CartSummaryGrid.js";import{C as D}from"./CartSummaryList.js";import"./OrderSummary.js";const w=({className:h,products:n,orderSummary:i,empty:r,...a})=>e("div",{...a,className:p(["cart-cart",h]),children:d("div",{className:p(["cart-cart__wrapper"]),children:[e("div",{"data-testid":"cart-content",className:p(["cart-cart__content",["cart-cart__content--empty",r||i==null],["cart-cart__content--full-width",r||i==null]]),children:n&&e(_,{node:n})}),n&&i&&e(_,{node:i,className:p(["cart-cart__order-summary"])})]})}),G=({className:h,products:n,subtotal:i,subtotalExcludingTaxes:r,ctas:a,...l})=>{const o=M({subtotal:"Cart.MiniCart.subtotal",subtotalExcludingTaxes:"Cart.MiniCart.subtotalExcludingTaxes"});return e("div",{...l,className:p(["cart-mini-cart",h]),children:n&&d(R,{children:[e("div",{className:"cart-mini-cart__products","data-testid":"mini-cart-products-wrapper",children:n}),d("div",{className:"cart-mini-cart__footer","data-testid":"mini-cart-subtotals",children:[i&&d("div",{className:"cart-mini-cart__footer__estimated-total","data-testid":"mini-cart-subtotal",children:[o.subtotal,e(_,{node:i})]}),r&&d("div",{className:"cart-mini-cart__footer__estimated-total-excluding-taxes","data-testid":"mini-cart-subtotal-excluding-taxes",children:[o.subtotalExcludingTaxes,e(_,{node:r,className:p(["dropin-price-summary__price","dropin-price-summary__price--muted"])})]}),a&&e(_,{node:a,className:"cart-mini-cart__footer__ctas"})]})]})})},H=({children:h,routeProduct:n,routeEmptyCartCTA:i,slots:r,initialData:a=null,...l})=>{const[o,g]=L(a),[t,v]=L(new Map),c={hasErrors:t.size>0},y=(s,m)=>T([{uid:s,quantity:m}]);x(()=>{const s=E.on("cart/data",m=>{g(m)},{eager:!0});return()=>{s==null||s.off()}},[]),x(()=>{a&&Object.keys(a).length>0&&P(a,f.locale??"en-US")},[a]);const b=r!=null&&r.OrderSummary?e(k,{name:"OrderSummary",slot:r.OrderSummary,context:{...c}}):void 0,I=s=>y(s,0),C=e(k,{name:"ProductList",slot:r==null?void 0:r.ProductList,context:{itemQuantityUpdateHandler:y,itemRemoveHandler:I},children:e(D,{"data-testid":"default-cart-summary-list",routeProduct:n,routeEmptyCartCTA:i,initialData:o,enableRemoveItem:!0,enableUpdateItemQuantity:!0,onItemsErrorsChange:v})});return e(w,{...l,empty:((o==null?void 0:o.items)&&o.items.length===0)??!0,orderSummary:b,products:C})};H.getInitialData=async function(){return Q()};const X=({children:h,initialData:n=null,slots:i,routeProduct:r,routeCart:a,routeCheckout:l,routeEmptyCartCTA:o,...g})=>{var m,S;const[t,v]=L(n),c=(m=f.config)==null?void 0:m.shoppingCartDisplaySetting;x(()=>{const u=E.on("cart/data",N=>{v(N)},{eager:!0});return()=>{u==null||u.off()}},[]);const y=M({cartLink:"Cart.MiniCart.cartLink",checkoutLink:"Cart.MiniCart.checkoutLink"}),b=(u,N)=>T([{uid:u,quantity:N}]),I=u=>b(u,0);x(()=>{n&&Object.keys(n).length>0&&P(n,f.locale||"en-US")},[n]);const C=e(k,{name:"ProductList",slot:i==null?void 0:i.ProductList,context:{itemQuantityUpdateHandler:b,itemRemoveHandler:I,totalQuantity:t==null?void 0:t.totalQuantity},children:e(D,{"data-testid":"default-cart-summary-list",routeProduct:r,routeEmptyCartCTA:o,initialData:t,maxItems:(S=f.config)==null?void 0:S.miniCartMaxItemsDisplay,hideHeading:!(t!=null&&t.totalQuantity),enableRemoveItem:!0})}),s=()=>(c==null?void 0:c.subtotal)==="INCLUDING_TAX"||(c==null?void 0:c.subtotal)==="INCLUDING_EXCLUDING_TAX"?{amount:t==null?void 0:t.subtotal.includingTax.value,currency:t==null?void 0:t.subtotal.includingTax.currency,"data-testid":"subtotal-including-tax",style:{font:"inherit"}}:{amount:t==null?void 0:t.subtotal.excludingTax.value,currency:t==null?void 0:t.subtotal.excludingTax.currency,"data-testid":"subtotal-excluding-tax",style:{font:"inherit"}};return e(G,{...g,subtotal:t!=null&&t.totalQuantity?(t==null?void 0:t.subtotal)&&e(U,{...s()}):void 0,subtotalExcludingTaxes:t!=null&&t.totalQuantity?(t==null?void 0:t.subtotal)&&((c==null?void 0:c.subtotal)==="INCLUDING_EXCLUDING_TAX"?e(U,{amount:t==null?void 0:t.subtotal.excludingTax.value,currency:t==null?void 0:t.subtotal.excludingTax.currency,"data-testid":"subtotal-including-excluding-tax",style:{font:"inherit"}}):void 0):void 0,ctas:t!=null&&t.totalQuantity?d("div",{children:[l&&e(O,{"data-testid":"route-checkout-button",variant:"primary",href:t!=null&&t.hasOutOfStockItems?void 0:l(),disabled:t==null?void 0:t.hasOutOfStockItems,"aria-disabled":t==null?void 0:t.hasOutOfStockItems,children:y.checkoutLink}),a&&e(O,{"data-testid":"route-cart-button",variant:"tertiary",href:a(),children:y.cartLink})]}):void 0,products:C})};X.getInitialData=async function(){return Q()};export{H as C,X as M};
