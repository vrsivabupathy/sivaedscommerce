import{jsx as o,jsxs as v}from"@dropins/tools/preact-jsx-runtime.js";import*as r from"@dropins/tools/preact-compat.js";import{useRef as x,useState as S,useEffect as E}from"@dropins/tools/preact-compat.js";import{classes as p,VComponent as g,getFormValues as L}from"@dropins/tools/lib.js";/* empty css               */import{Accordion as A,AccordionSection as B,Button as y,Icon as N,Input as I}from"@dropins/tools/components.js";import{S as P}from"../chunks/Coupon.js";import{useText as _}from"@dropins/tools/i18n.js";import"../chunks/resetCart.js";import{events as b}from"@dropins/tools/event-bus.js";import{a as k}from"../chunks/applyCouponsToCart.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/persisted-data.js";import"../chunks/getStoreConfig.js";import"../fragments.js";const M=a=>r.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...a},r.createElement("g",{id:"Large"},r.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),r.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},r.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),r.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),T=a=>r.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a},r.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),r.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),j=a=>r.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a},r.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),q=({className:a,children:C,couponCodeField:u,applyCouponsButton:i,appliedCoupons:l,onApplyCoupon:d,...m})=>{const s=x(null),h=_({couponTitle:"Cart.PriceSummary.coupon.title"}),w=e=>{var c;e.preventDefault();const t=L(s.current);d==null||d(t);const n=(c=s==null?void 0:s.current)==null?void 0:c.querySelector("input");n&&(n.value="")};return o("div",{...m,"data-testid":"cart-coupons",className:p(["cart-coupons",a]),children:o(A,{"data-testid":"coupon-code",className:"cart-coupons__accordion",actionIconPosition:"right",iconOpen:M,iconClose:j,children:v(B,{title:h.couponTitle,iconLeft:P,showIconLeft:!0,renderContentWhenClosed:!1,"data-testid":"coupon-code-accordion-section",children:[o("form",{"data-testid":"coupon-code-form",className:p(["coupon-code-form--edit"]),ref:s,children:v("div",{className:p(["coupon-code-form__action"]),children:[u&&o(g,{node:u,className:p(["coupon-code-form__codes"])}),i&&o(g,{node:i,className:p(["coupon-code-form--button"]),onClick:w,type:"submit"})]})}),l&&o(g,{node:l,className:p(["coupon-code-form__applied"])})]})})})},X=({children:a,...C})=>{const[u,i]=S(new Set),[l,d]=S([]),m=_({applyButton:"Cart.PriceSummary.coupon.applyAction",placeholder:"Cart.PriceSummary.coupon.placeholder"}),s=async e=>{const t=e.coupon,n=new Set(u);n.add(t);const c=Array.from(n);k(c).then(f=>{if(f===null)throw new Error("Error adding coupon code");i(n)}).catch(f=>{console.warn(f)})},h=e=>{const t=new Set(u);t.delete(e);const n=Array.from(t);k(n).then(c=>{if(c===null)throw new Error("Error removing coupon code");i(t)}).catch(c=>{console.warn(c)})};E(()=>{const e=b.on("cart/data",t=>{const n=t==null?void 0:t.appliedCoupons;if(!n){d([]);return}const c=n.map(f=>f.code);d(c)},{eager:!0});return()=>{e==null||e.off()}},[]),E(()=>{i(new Set(l))},[l]);const w=l.map(e=>o(y,{variant:"tertiary",icon:o(N,{source:T,size:"24"}),onClick:()=>h(e),children:e},e));return o(q,{...C,couponCodeField:o(I,{"aria-label":m.placeholder,type:"text",placeholder:m.placeholder,name:"coupon",variant:"primary",value:"","data-testid":"coupon-code-input",maxLength:50}),applyCouponsButton:o(y,{variant:"secondary",children:m.applyButton}),appliedCoupons:o("div",{children:w}),onApplyCoupon:s})};export{X as Coupons,X as default};
