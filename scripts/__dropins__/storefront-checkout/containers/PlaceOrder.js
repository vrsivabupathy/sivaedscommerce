import{jsx as c}from"@dropins/tools/preact-jsx-runtime.js";import{events as O}from"@dropins/tools/event-bus.js";import{U as k,q as E,n as b}from"../chunks/fixtures.js";import{p as x}from"../chunks/placeOrder.js";import{classes as f}from"@dropins/tools/lib.js";/* empty css                   */import{Button as S}from"@dropins/tools/components.js";import{Text as C,useText as I}from"@dropins/tools/i18n.js";import{w as P}from"../chunks/withConditionalRendering.js";import{useState as w,useCallback as p,useEffect as U}from"@dropins/tools/preact-compat.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";const F=e=>e instanceof TypeError||e instanceof k,L=e=>{e.scrollIntoView({behavior:"smooth"}),e.focus()},N=e=>(Array.from(document.forms)||[]).filter(t=>e.includes(t.name)).filter(t=>t.offsetParent!==null).filter(t=>!t.checkValidity()),T=({className:e,onClick:s,disabled:t=!1})=>c("div",{className:f(["checkout-place-order",e]),children:c(S,{className:f(["checkout-place-order__button",e]),"data-testid":"place-order-button",disabled:t,onClick:s,size:"medium",type:"submit",variant:"primary",children:c(C,{id:"Checkout.PlaceOrder.button"})},"placeOrder")});var h=(e=>(e.BILLING="billing_address",e.LOGIN="login-form",e.SHIPPING="shipping_address",e))(h||{});const _=({onPlaceOrder:e})=>{var m;const[s,t]=w(!1),{data:n,pending:v}=E.value,g=!!n,a=((m=n==null?void 0:n.selectedPaymentMethod)==null?void 0:m.code)||"",l=I({CheckoutUnexpectedError:"Checkout.ServerError.unexpected"}),d=p(r=>{const o=F(r)?l.CheckoutUnexpectedError:r.message;b.value=o},[l]),y=p(async()=>{const r=N(Object.values(h));if(r.length>0){const i=r[0].querySelector(":invalid");i&&L(i)}else try{e?await e({code:a}):await x()}catch(o){d(o)}},[e,a,d]);return U(()=>{const r=O.on("cart/initialized",o=>{const i=(o==null?void 0:o.items)||[];t(i.some(u=>u.outOfStock||u.insufficientQuantity))},{eager:!0});return()=>{r==null||r.off()}},[]),c(T,{onClick:y,disabled:!g||v||s})},D=P(_);export{h as CheckoutForms,D as PlaceOrder,D as default};
