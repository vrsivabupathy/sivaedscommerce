import{jsx as t,jsxs as k,Fragment as z}from"@dropins/tools/preact-jsx-runtime.js";import"@dropins/tools/event-bus.js";import{q as b}from"../chunks/fixtures.js";import{s as R}from"../chunks/setPaymentMethod.js";import{H as U}from"../chunks/ShippingMethods.js";import"@dropins/tools/preact-hooks.js";import{classes as C,Slot as x}from"@dropins/tools/lib.js";import{IllustratedMessage as $,Icon as q,ProgressSpinner as B,ToggleButton as O,Skeleton as Z,SkeletonRow as y}from"@dropins/tools/components.js";/* empty css                              *//* empty css                   */import*as f from"@dropins/tools/preact-compat.js";import{useState as g,useCallback as _,useEffect as P}from"@dropins/tools/preact-compat.js";import{useText as F}from"@dropins/tools/i18n.js";import{w as G}from"../chunks/withConditionalRendering.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/getCart.graphql.js";import"../chunks/transform-shipping-methods.js";import"../chunks/getMultilineValues.js";const J=e=>f.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},f.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.93 14.8V18.75H5.97C4.75 18.75 3.75 17.97 3.75 17V6.5M3.75 6.5C3.75 5.53 4.74 4.75 5.97 4.75H15.94V8.25H5.97C4.75 8.25 3.75 7.47 3.75 6.5Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),f.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.35 11.64H14.04V14.81H19.35V11.64Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),f.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.9304 11.64V8.25H15.1504",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),K=({code:e,isLoading:n,isSelected:i,onChange:m,title:s})=>t(O,{className:"checkout-payment-methods__method",label:s,name:"payment-method",value:e,selected:i,onChange:m,busy:n}),Q=({className:e,paymentMethodContent:n,isLoading:i,onChange:m=()=>{},options:s,selection:d})=>{const u=F({Title:"Checkout.PaymentMethods.title",EmptyState:"Checkout.PaymentMethods.emptyState"});return s===void 0?t(X,{}):k("div",{className:C(["checkout-payment-methods",e]),children:[t(U,{level:2,className:"checkout-payment-methods__title",children:u.Title}),!i&&s.length===0&&t($,{icon:t(q,{source:J}),message:t("p",{children:u.EmptyState})}),k("div",{className:C(["checkout-payment-methods__wrapper"]),children:[i&&t(B,{className:"checkout-payment-methods__spinner"}),t("div",{className:C(["checkout-payment-methods__methods",["checkout-payment-methods--loading",i],["checkout-payment-methods--full-width",s.length%2!==0]]),children:s==null?void 0:s.map(l=>t(K,{code:l.code,onChange:m,isSelected:l.code===d,title:l.title},l.code))}),n&&t("div",{className:"checkout-payment-methods__content",children:n})]})]})},X=()=>k(Z,{"data-testid":"payment-methods-skeleton",children:[t(y,{variant:"heading",size:"medium"}),t(y,{variant:"empty",size:"medium"}),t(y,{size:"xlarge",fullWidth:!0}),t(y,{size:"xlarge",fullWidth:!0})]}),T={free:e=>{const n=document.createElement("div");n.innerText="",e.replaceHTML(n)},checkmo:e=>{const n=document.createElement("div");n.innerText="",e.replaceHTML(n)}};function Y({slots:e}){var E;const[n,i]=g(),[m,s]=g(),[d,u]=g(T),[l,V]=g(!0),{data:o}=b.value,N=(o==null?void 0:o.id)??"",v=!!o,H=!!((E=o==null?void 0:o.shippingAddresses)!=null&&E[0]),w=!((o==null?void 0:o.isVirtual)??!1),c=o==null?void 0:o.availablePaymentMethods,a=o==null?void 0:o.selectedPaymentMethod,p=_(async r=>{try{if(i(r),!H&&w||r===(a==null?void 0:a.code))return;await R(r)}catch(h){console.error("setting payment method failed:",h)}},[H,w,a]);P(()=>{v&&(a!=null&&a.code?(c==null?void 0:c.some(h=>h.code===a.code))?i(a.code):c!=null&&c.length?p(c[0].code):i(void 0):c[0]&&p(m||c[0].code))},[c,v,a,p,m]);const W=async r=>{await p(r),a!=null&&a.code||s(r)},S=_((r,h)=>{if(!r){console.warn("Payment method handler is ignored because it has no code");return}if(!h){console.warn("Payment method handler is ignored because it is empty");return}u(A=>({...A,[r]:h}))},[]);P(()=>{e!=null&&e.Handlers&&Object.entries(e.Handlers).forEach(([r,h])=>{S(r,h)})},[S,e==null?void 0:e.Handlers]);const I=e!=null&&e.Main?t(x,{name:"PaymentMethods",slot:e==null?void 0:e.Main,context:{replaceHTML(r){this.replaceWith(r),V(!1)}}}):null,M=n?d[n]:null,j=M?t(x,{name:"PaymentMethodContent",slot:M,context:{cartId:N,replaceHTML(r){this.replaceWith(r)}}},M):void 0;return P(()=>{!l&&d!=T&&console.warn("Payment method handlers you have added are ignored because the default content has been replaced")},[l,d]),{availablePaymentMethods:c,selectedPaymentMethod:n,onPaymentMethodChange:W,paymentMethodContent:j,mainSlotContent:I,isDefaultContentUsed:l}}const L=e=>{const{availablePaymentMethods:n,selectedPaymentMethod:i,onPaymentMethodChange:m,paymentMethodContent:s,mainSlotContent:d,isDefaultContentUsed:u}=Y(e);return k(z,{children:[d&&t(d.type,{ref:d.ref,...d.props}),u&&t(Q,{options:n,selection:i,onChange:m,paymentMethodContent:s,isLoading:b.value.pending})]})};L.displayName="PaymentMethodsContainer";const ke=G(L);export{ke as PaymentMethods,ke as default};
