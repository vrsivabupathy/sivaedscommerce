import{jsx as o,jsxs as S,Fragment as B}from"@dropins/tools/preact-jsx-runtime.js";import{e as P}from"../chunks/getMultilineValues.js";import{events as I}from"@dropins/tools/event-bus.js";import{v as C,w as y,q as N,t as q,x as Z}from"../chunks/fixtures.js";import{s as $}from"../chunks/setShippingMethods.js";import{H as F}from"../chunks/ShippingMethods.js";import{useState as R,useEffect as j}from"@dropins/tools/preact-hooks.js";import{classes as w,Slot as G}from"@dropins/tools/lib.js";import{IllustratedMessage as J,Icon as K,ProgressSpinner as Q,RadioButton as X,Price as Y,Skeleton as D,SkeletonRow as H}from"@dropins/tools/components.js";/* empty css                              *//* empty css                   */import*as d from"@dropins/tools/preact-compat.js";import{useCallback as U,useMemo as ee,useEffect as z}from"@dropins/tools/preact-compat.js";import{useText as te}from"@dropins/tools/i18n.js";import{w as ne}from"../chunks/withConditionalRendering.js";import"../chunks/transform-shipping-methods.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/getCart.graphql.js";const oe=e=>({countryCode:e.country_id,postCode:e.postcode||"",...e.region_id?{regionId:Number(e.region_id)}:{...e.region?{region:e.region}:{}}}),ie=e=>({carrierCode:e.carrier.code||"",methodCode:e.code||"",amount:e.amount,amountExclTax:e.amountExclTax,amountInclTax:e.amountInclTax}),re=e=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.47266 4.90002H15.1851V10.9645H21.2495L23 12.715V17.6124H20.073",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M15.1758 5.87573H19.0019L21.0394 10.7636",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.76151 16.7898C9.76151 18.0525 8.72845 19.076 7.46582 19.076C6.20318 19.076 5.17969 18.0429 5.17969 16.7803C5.17969 15.5176 6.20318 14.4941 7.46582 14.4941C8.72845 14.4941 9.75195 15.5176 9.76151 16.7803C9.76151 16.7803 9.76151 16.7803 9.76151 16.7898Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.8726 16.7898C19.8726 18.062 18.8491 19.0855 17.5769 19.0855C16.3047 19.0855 15.2812 18.062 15.2812 16.7898C15.2812 15.5176 16.3047 14.4941 17.5769 14.4941C18.8491 14.4941 19.8726 15.5176 19.8726 16.7898Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M8.08792 7.63574H1.69824",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M7.11229 10.3619H1",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.16084 13.0402H1.92773",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.76172 16.7611H15.2809",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.38672 16.7611H5.17025",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),se=({className:e,isLoading:t=!1,onSelectionChange:i=()=>{},options:r,selection:c,...s})=>{const u=te({Title:"Checkout.ShippingMethods.title",EmptyState:"Checkout.ShippingMethods.emptyState"});return r===void 0?o(ce,{}):S("div",{...s,className:w(["checkout-shipping-methods",e]),children:[o(F,{level:3,className:"checkout-shipping-methods__title",children:u.Title}),!t&&r.length===0&&o(J,{icon:o(K,{source:re}),message:o("p",{children:u.EmptyState})}),S("div",{className:w(["checkout-shipping-methods__content"]),children:[t&&o(Q,{className:"checkout-shipping-methods__spinner"}),o("div",{className:w(["checkout-shipping-methods__options",["checkout-shipping-methods__options--loading",t]]),children:r.map(n=>o(X,{"data-testid":"shipping-method-radiobutton","aria-busy":t,id:n.value,name:"shipping-method",className:"checkout-shipping-methods__method",label:S(B,{children:[o(Y,{amount:n.amount.value,currency:n.amount.currency}),"Â ",o("span",{children:n.carrier.title})]}),description:n.title,value:n.value,checked:(c==null?void 0:c.value)===n.value,onChange:()=>i(n)},n.value))})]})]})},ce=()=>S(D,{"data-testid":"shipping-methods-skeleton",children:[o(H,{variant:"heading",size:"small"}),o(H,{variant:"empty",size:"small"}),o(H,{size:"medium",fullWidth:!0}),o(H,{size:"medium",fullWidth:!0})]});function ae(){var a;const[e,t]=R(),[i,r]=R();j(()=>{I.on("checkout/address",({address:M,type:L,isValid:g})=>{L==="shipping"&&t({address:M,isValid:g})})},[]),j(()=>{r(C.value)},[C.value]),j(()=>{y.value.pending?r(void 0):r(C.value)},[y.value.pending]);const{country_id:c,region_id:s,region:u,postcode:n}=(e==null?void 0:e.address)||{},k=!!e,p=N.value.data,E=!!((a=p==null?void 0:p.shippingAddresses)!=null&&a[0]),v=e==null?void 0:e.isValid;j(()=>{E||v||!i||!k||I.emit("shipping/estimate",{address:oe({country_id:c,region_id:s,region:u,postcode:n}),shippingMethod:ie(i)})},[i,c,s,u,n,k,E,v])}const b=(e,t)=>e.code===t.code&&e.carrier.code===t.carrier.code;function le({onCheckoutDataUpdate:e,preSelectedMethod:t,onShippingMethodSelect:i}){const r=q.value.data,c=!r,s=N.value.data,u=N.value.pending,n=y.value.data,k=y.value.pending,p=C.value,E=s==null?void 0:s.id,v=s==null?void 0:s.shippingAddresses,a=v==null?void 0:v[0],M=!!a,L=a==null?void 0:a.availableShippingMethods,g=a==null?void 0:a.selectedShippingMethod,h=L||n,T=U(l=>{if(!M)return;const f={method_code:l.code,carrier_code:l.carrier.code};$([f]).then(()=>{e==null||e()}).catch(x=>{console.error("setting shipping methods on cart failed:",x)})},[M,e]),A=l=>{C.value=l,i==null||i(l)},m=ee(()=>{if(!(h!=null&&h.length))return;const l=h[0],f=p||g;return f?h.some(_=>b(_,f))?f:l:h.find(W=>W.carrier.code===(t==null?void 0:t.carrierCode)&&W.code===(t==null?void 0:t.methodCode))||l},[p,g,h,t]);return z(()=>{m&&((!p||!b(m,p))&&(C.value=m,i==null||i(m)),(!g||!b(m,g))&&T(m))},[m,p,g,T,i]),z(()=>{if(!E||L)return;const{country:l,selectedRegion:f,selectedRegionId:x}=Z.value,_=l||(r==null?void 0:r.defaultCountry);_&&P({criteria:{country_code:_,region_name:f,region_id:x}}).catch(O=>{y.value={pending:!1,data:[]},console.error("shipping methods estimation failed:",O)})},[E,L,r]),{isLoading:u||c||k,options:h,selection:m,onSelectionChange:A}}const V=({preSelectedMethod:e,onCheckoutDataUpdate:t,shippingMethodsSlot:i,onShippingMethodSelect:r,...c})=>{const{isLoading:s,options:u,selection:n,onSelectionChange:k}=le({preSelectedMethod:e,onCheckoutDataUpdate:t,onShippingMethodSelect:r});return ae(),S(B,{children:[o(se,{...c,className:"checkout-shipping-methods",isLoading:s,onSelectionChange:k,options:u,selection:n}),!s&&o(G,{name:"ShippingMethods",slot:i})]})};V.displayName="ShippingMethodsContainer";const He=ne(V);export{He as ShippingMethods,He as default};
