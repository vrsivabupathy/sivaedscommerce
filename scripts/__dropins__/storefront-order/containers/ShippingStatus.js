/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsx as i,jsxs as S,Fragment as a}from"@dropins/tools/preact-jsx-runtime.js";import{classes as _,VComponent as A,Slot as E}from"@dropins/tools/lib.js";import{Card as L,Header as w,Accordion as R,AccordionSection as q,ContentGrid as G,Image as V}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{useState as x,useEffect as k}from"@dropins/tools/preact-hooks.js";import{events as D}from"@dropins/tools/event-bus.js";import"@dropins/tools/preact.js";import{u as nn}from"../chunks/useIsMobile.js";import{Text as B,useText as en}from"@dropins/tools/i18n.js";import{C as pn}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";var M=(e=>(e.PENDING="pending",e.SHIPPING="shipping",e.COMPLETE="complete",e.PROCESSING="processing",e.HOLD="on hold",e.CANCELED="Canceled",e.SUSPECTED_FRAUD="suspected fraud",e.PAYMENT_REVIEW="payment review",e))(M||{});const tn=({orderData:e})=>{const[l,n]=x(!0),[t,m]=x(e),[h,f]=x(!1);return k(()=>{const u=D.on("order/data",d=>{m(d),f(d==null?void 0:d.isVirtual),n(!1)},{eager:!0});return e!=null&&e.id&&n(!1),()=>{u==null||u.off()}},[e]),{loading:l,order:t,isVirtualProduct:h}},v=({value:e,variant:l="primary",size:n="medium",icon:t,className:m,children:h,disabled:f=!1,active:u=!1,activeChildren:d,activeIcon:p,href:C,...b})=>{let g="dropin-button";(t&&!h||t&&u&&!d||!t&&u&&p)&&(g="dropin-iconButton"),u&&d&&(g="dropin-button"),m=_([g,`${g}--${n}`,`${g}--${l}`,[`${g}--${l}--disabled`,f],h&&t&&`${g}--with-icon`,!h&&d&&t&&`${g}--with-icon`,u&&p&&`${g}--with-icon`,m]);const c=_(["dropin-button-icon",`dropin-button-icon--${l}`,[`dropin-button-icon--${l}--disabled`,f],t==null?void 0:t.props.className]),y=C?{node:i("a",{}),role:"link",href:C,...b,disabled:f,active:u,onKeyDown:I=>{f&&I.preventDefault()},tabIndex:f?-1:0}:{node:i("button",{}),role:"button",...b,value:e,disabled:f,active:u};return S(A,{...y,className:m,children:[t&&!u&&i(A,{node:t,className:c}),p&&u&&i(A,{node:p,className:c}),h&&!u&&(typeof h=="string"?i("span",{children:h}):h),u&&d&&(typeof d=="string"?i("span",{children:d}):d)]})},sn=({slots:e,collapseThreshold:l,translations:n,returnData:t,routeTracking:m,routeProductDetails:h})=>{var d;const f=nn(),u=h?"a":"span";return S(L,{variant:"secondary",className:_(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[i(w,{title:n.returnOrderCardTitle}),S("div",{children:[(d=t==null?void 0:t.tracking)==null?void 0:d.map((p,C)=>{var y,I;const b={title:"",number:(p==null?void 0:p.trackingNumber)??"",carrier:((y=p==null?void 0:p.carrier)==null?void 0:y.label)??""},g=m==null?void 0:m(b),c=g?()=>{window.open(g,"_blank","noreferrer")}:null;return S("div",{className:"order-shipping-status-card__header",children:[S("div",{children:[`${n.carrier} `,`${(I=b.carrier)==null?void 0:I.toLocaleUpperCase()} | `,b.number]}),c?i(v,{onClick:c,children:n.trackButton}):null]},`${b.number}_${C}`)}),e!=null&&e.ReturnItemsDetails?i(E,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:e==null?void 0:e.ReturnItemsDetails,context:{items:t.items}}):null,i(R,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(q,{defaultOpen:l>=t.items.length,title:i(B,{id:"Order.ShippingStatusCard.itemText",plural:t.items.reduce((p,C)=>p+C.requestQuantity,0),fields:{count:t.items.reduce((p,C)=>p+C.requestQuantity,0)}}),children:i(G,{maxColumns:f?3:9,emptyGridContent:i(a,{}),className:_(["order-shipping-status-card__images",["order-shipping-status-card__images-3",f]]),children:t.items.map((p,C)=>{var c,y;const b=(c=p.thumbnail)==null?void 0:c.label,g=(y=p.thumbnail)==null?void 0:y.url;return i(u,{href:(h==null?void 0:h(p))??"#","data-testid":`${C}${p.uid}`,children:i(V,{alt:b,src:g,width:85,height:114})},`${C}${p.uid}`)})})})})]})]})},ln=({translations:e,slots:l,orderData:n,collapseThreshold:t=10,routeProductDetails:m,routeTracking:h})=>{var I,U,H,j,F,Q,K;const f=!!(n!=null&&n.returnNumber),u=n==null?void 0:n.returnNumber,d=m?"a":"span",p=(I=n==null?void 0:n.status)==null?void 0:I.toLocaleLowerCase(),b=((U=n==null?void 0:n.shipments)==null?void 0:U.length)===1&&(p==null?void 0:p.includes(M.COMPLETE)),g=(H=n==null?void 0:n.shipments)==null?void 0:H.every(s=>s.tracking.length===0),c=(j=n==null?void 0:n.items)==null?void 0:j.filter(s=>(s==null?void 0:s.quantityShipped)===0||(s==null?void 0:s.quantityShipped)<(s==null?void 0:s.quantityOrdered)),y=(F=n==null?void 0:n.items)==null?void 0:F.reduce((s,o)=>{const N=o.quantityOrdered-o.quantityShipped;return s+(N>0?N:0)},0);if(f&&(n!=null&&n.returns.length)){const s=n.returns.find(o=>o.returnNumber===u);return!s||s.tracking.length===0?null:i(sn,{slots:l,collapseThreshold:t,translations:e,returnData:s,routeTracking:h,routeProductDetails:m})}return!n||p!=null&&p.includes(M.CANCELED)?null:(Q=n==null?void 0:n.shipments)!=null&&Q.length?g&&!(c!=null&&c.length)&&b?null:S(a,{children:[(K=n==null?void 0:n.shipments)==null?void 0:K.map(({tracking:s,items:o,id:N},P)=>{const W=o.reduce((r,O)=>r+((O==null?void 0:O.quantityShipped)??0),0);return S(L,{variant:"secondary",className:"order-shipping-status-card",children:[i(w,{title:e.shippingCardTitle}),s==null?void 0:s.map(r=>{var T;const O=h==null?void 0:h(r),$=O?()=>{window.open(O,"_blank","noreferrer")}:null;return S("div",{className:"order-shipping-status-card__header",role:"status",children:[S("div",{className:"order-shipping-status-card__header--content",children:[S("p",{children:[e.carrier," ",(T=r==null?void 0:r.carrier)==null?void 0:T.toLocaleUpperCase()," | ",r==null?void 0:r.number]}),i("p",{children:r==null?void 0:r.title})]}),l!=null&&l.DeliveryTrackActions?i(E,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:l==null?void 0:l.DeliveryTrackActions,context:{trackInformation:r}}):$?i(v,{onClick:$,children:e.trackButton}):null]},r.number)}),b?null:i(R,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(q,{"data-position":P+1,defaultOpen:t>=(o==null?void 0:o.length),title:i(B,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:W,fields:{count:W}}),children:i(G,{maxColumns:6,emptyGridContent:i(a,{}),className:"order-shipping-status-card__images",children:o==null?void 0:o.map(r=>{var T,Y,z,J,X,Z;const O=(z=(Y=(T=r==null?void 0:r.orderItem)==null?void 0:T.product)==null?void 0:Y.thumbnail)==null?void 0:z.label,$=(Z=(X=(J=r==null?void 0:r.orderItem)==null?void 0:J.product)==null?void 0:X.thumbnail)==null?void 0:Z.url;return i(d,{href:(m==null?void 0:m(r))??"#",children:i(V,{alt:O,src:$||"",width:85,height:114})},r.id)})})})}),l!=null&&l.DeliveryTimeLine?i(E,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:l==null?void 0:l.DeliveryTimeLine,context:{}}):null]},N)}),c!=null&&c.length?S(L,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[i(w,{title:e.notYetShippedTitle}),i(R,{actionIconPosition:"right",children:i(q,{defaultOpen:t>=(c==null?void 0:c.length),title:i(B,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:y,fields:{count:y}}),children:i(G,{maxColumns:6,emptyGridContent:i(a,{}),className:"order-shipping-status-card__images",children:c==null?void 0:c.map(s=>{var o,N;return i(d,{href:(m==null?void 0:m(s))??"#",children:i(V,{alt:(o=s.thumbnail)==null?void 0:o.label,src:((N=s.thumbnail)==null?void 0:N.url)||"",width:85,height:114})},s.id)})})})})]}):null]}):S(L,{variant:"secondary",className:"order-shipping-status-card",children:[i(w,{title:e.shippingInfoTitle}),i("div",{className:"order-shipping-status-card__header",children:S("div",{className:"order-shipping-status-card__header--content",children:[n!=null&&n.carrier?i("p",{children:n==null?void 0:n.carrier}):null,i("p",{children:e.noInfoTitle})]})})]})},bn=({slots:e,className:l,collapseThreshold:n,orderData:t,routeOrderDetails:m,routeTracking:h,routeProductDetails:f})=>{const{loading:u,order:d,isVirtualProduct:p}=tn({orderData:t}),C=en({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber",trackButton:"Order.ShippingStatusCard.trackButton"});return!u&&p?null:i("div",{className:_(["order-shipping-status",l]),children:!u&&d?i(ln,{translations:C,routeOrderDetails:m,routeTracking:h,slots:e,orderData:d,collapseThreshold:n,routeProductDetails:f}):i(pn,{withCard:!1})})};export{bn as ShippingStatus,bn as default};
