/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsx as n,jsxs as o,Fragment as N}from"@dropins/tools/preact-jsx-runtime.js";import{classes as T,VComponent as A,Slot as R}from"@dropins/tools/lib.js";import{Card as L,Header as w,Accordion as E,AccordionSection as B,ContentGrid as W,Image as G}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{useState as x,useEffect as Q}from"@dropins/tools/preact-hooks.js";import{events as X}from"@dropins/tools/event-bus.js";import{u as Z}from"../chunks/useIsMobile.js";import{Text as V,useText as Y}from"@dropins/tools/i18n.js";import{C as P}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";import"@dropins/tools/preact.js";var M=(e=>(e.PENDING="pending",e.SHIPPING="shipping",e.COMPLETE="complete",e.PROCESSING="processing",e.HOLD="on hold",e.CANCELED="Canceled",e.SUSPECTED_FRAUD="suspected fraud",e.PAYMENT_REVIEW="payment review",e))(M||{});const k=({orderData:e})=>{const[s,i]=x(!0),[l,c]=x(e),[t,f]=x(!1);return Q(()=>{const h=X.on("order/data",d=>{c(d),f(d==null?void 0:d.isVirtual),i(!1)},{eager:!0});return()=>{h==null||h.off()}},[]),{loading:s,order:l,isVirtualProduct:t}},z=({value:e,variant:s="primary",size:i="medium",icon:l,className:c,children:t,disabled:f=!1,active:h=!1,activeChildren:d,activeIcon:r,href:b,...C})=>{let p="dropin-button";(l&&!t||l&&h&&!d||!l&&h&&r)&&(p="dropin-iconButton"),h&&d&&(p="dropin-button"),c=T([p,`${p}--${i}`,`${p}--${s}`,[`${p}--${s}--disabled`,f],t&&l&&`${p}--with-icon`,!t&&d&&l&&`${p}--with-icon`,h&&r&&`${p}--with-icon`,c]);const a=T(["dropin-button-icon",`dropin-button-icon--${s}`,[`dropin-button-icon--${s}--disabled`,f],l==null?void 0:l.props.className]),S=b?{node:n("a",{}),role:"link",href:b,...C,disabled:f,active:h,onKeyDown:I=>{f&&I.preventDefault()},tabIndex:f?-1:0}:{node:n("button",{}),role:"button",...C,value:e,disabled:f,active:h};return o(A,{...S,className:c,children:[l&&!h&&n(A,{node:l,className:a}),r&&h&&n(A,{node:r,className:a}),t&&!h&&(typeof t=="string"?n("span",{children:t}):t),h&&d&&(typeof d=="string"?n("span",{children:d}):d)]})},D=({slots:e,collapseThreshold:s,translations:i,returnData:l,routeTracking:c,routeProductDetails:t})=>{var d;const f=Z(),h=t?"a":"span";return o(L,{variant:"secondary",className:T(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[n(w,{title:i.returnOrderCardTitle}),o("div",{children:[(d=l==null?void 0:l.tracking)==null?void 0:d.map((r,b)=>{var S,I;const C={title:"",number:(r==null?void 0:r.trackingNumber)??"",carrier:((S=r==null?void 0:r.carrier)==null?void 0:S.label)??""},p=c==null?void 0:c(C),a=p?()=>{window.open(p,"_blank","noreferrer")}:null;return o("div",{className:"order-shipping-status-card__header",children:[o("div",{children:[`${i.carrier} `,`${(I=C.carrier)==null?void 0:I.toLocaleUpperCase()} | `,C.number]}),a?n(z,{onClick:a,children:i.trackButton}):null]},`${C.number}_${b}`)}),e!=null&&e.ReturnItemsDetails?n(R,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:e==null?void 0:e.ReturnItemsDetails,context:{items:l.items}}):null,n(E,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n(B,{defaultOpen:s>=l.items.length,title:n(V,{id:"Order.ShippingStatusCard.itemText",plural:l.items.length,fields:{count:l.items.length}}),children:n(W,{maxColumns:f?3:9,emptyGridContent:n(N,{}),className:T(["order-shipping-status-card__images",["order-shipping-status-card__images-3",f]]),children:l.items.map((r,b)=>{var a,S;const C=(a=r.thumbnail)==null?void 0:a.label,p=(S=r.thumbnail)==null?void 0:S.url;return n(h,{href:(t==null?void 0:t(r))??"#","data-testid":`${b}${r.uid}`,children:n(G,{alt:C,src:p,width:85,height:114})},`${b}${r.uid}`)})})})})]})]})},nn=({translations:e,slots:s,orderData:i,collapseThreshold:l=10,routeProductDetails:c,routeTracking:t})=>{var a,S,I,U,v;const f=!!(i!=null&&i.returnNumber),h=i==null?void 0:i.returnNumber,d=c?"a":"span",r=(a=i==null?void 0:i.status)==null?void 0:a.toLocaleLowerCase(),C=((S=i==null?void 0:i.shipments)==null?void 0:S.length)===1&&(r==null?void 0:r.includes(M.COMPLETE)),p=(I=i==null?void 0:i.items)==null?void 0:I.filter(m=>(m==null?void 0:m.quantityShipped)===0);if(f&&(i!=null&&i.returns.length)){const m=i.returns.find(g=>g.returnNumber===h);return n(N,{children:m&&m.tracking.length>0?n(D,{slots:s,collapseThreshold:l,translations:e,returnData:m,routeTracking:t,routeProductDetails:c}):null})}return!i||r!=null&&r.includes(M.CANCELED)?null:(U=i==null?void 0:i.shipments)!=null&&U.length?o(N,{children:[(v=i==null?void 0:i.shipments)==null?void 0:v.map(({tracking:m,items:g,id:_},J)=>o(L,{variant:"secondary",className:"order-shipping-status-card",children:[n(w,{title:e.shippingCardTitle}),m==null?void 0:m.map(u=>{var O;const y=t==null?void 0:t(u),$=y?()=>{window.open(y,"_blank","noreferrer")}:null;return o("div",{className:"order-shipping-status-card__header",role:"status",children:[o("div",{className:"order-shipping-status-card__header--content",children:[o("p",{children:[e.carrier," ",(O=u==null?void 0:u.carrier)==null?void 0:O.toLocaleUpperCase()," | ",u==null?void 0:u.number]}),n("p",{children:u==null?void 0:u.title})]}),s!=null&&s.DeliveryTrackActions?n(R,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:s==null?void 0:s.DeliveryTrackActions,context:{trackInformation:u}}):$?n(z,{onClick:$,children:e.trackButton}):null]},u.number)}),C?null:n(E,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n(B,{"data-position":J+1,defaultOpen:l>=(g==null?void 0:g.length),title:n(N,{children:n(V,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:g==null?void 0:g.length,fields:{count:g==null?void 0:g.length}})}),children:n(W,{maxColumns:6,emptyGridContent:n(N,{}),className:"order-shipping-status-card__images",children:g==null?void 0:g.map(u=>{var O,H,j,F,q,K;const y=(j=(H=(O=u==null?void 0:u.orderItem)==null?void 0:O.product)==null?void 0:H.thumbnail)==null?void 0:j.label,$=(K=(q=(F=u==null?void 0:u.orderItem)==null?void 0:F.product)==null?void 0:q.thumbnail)==null?void 0:K.url;return n(d,{href:(c==null?void 0:c(u))??"#",children:n(G,{alt:y,src:$||"",width:85,height:114})},u.id)})})})}),s!=null&&s.DeliveryTimeLine?n(R,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:s==null?void 0:s.DeliveryTimeLine,context:{}}):null]},_)),p!=null&&p.length?o(L,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[n(w,{title:e.notYetShippedTitle}),n(E,{actionIconPosition:"right",children:n(B,{defaultOpen:l>=(p==null?void 0:p.length),title:n(V,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:p==null?void 0:p.length,fields:{count:p==null?void 0:p.length}}),children:n("div",{className:"order-shipping-status-card__images",children:p==null?void 0:p.map(m=>{var g,_;return n(d,{href:(c==null?void 0:c(m))??"#",children:n(G,{alt:(g=m.thumbnail)==null?void 0:g.label,src:((_=m.thumbnail)==null?void 0:_.url)||"",width:85,height:114})},m.id)})})})})]}):null]}):o(L,{variant:"secondary",className:"order-shipping-status-card",children:[n(w,{title:e.shippingInfoTitle}),n("div",{className:"order-shipping-status-card__header",children:o("div",{className:"order-shipping-status-card__header--content",children:[i!=null&&i.carrier?n("p",{children:i==null?void 0:i.carrier}):null,n("p",{children:e.noInfoTitle})]})})]})},mn=({slots:e,className:s,collapseThreshold:i,orderData:l,routeOrderDetails:c,routeTracking:t,routeProductDetails:f})=>{const{loading:h,order:d,isVirtualProduct:r}=k({orderData:l}),b=Y({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber",trackButton:"Order.ShippingStatusCard.trackButton"});return!h&&r?null:n("div",{className:T(["order-shipping-status",s]),children:!h&&d?n(nn,{translations:b,routeOrderDetails:c,routeTracking:t,slots:e,orderData:d,collapseThreshold:i,routeProductDetails:f}):n(P,{withCard:!1})})};export{mn as ShippingStatus,mn as default};
