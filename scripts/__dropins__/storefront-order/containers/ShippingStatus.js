/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsxs as r,jsx as p,Fragment as A}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as E,classes as U}from"@dropins/tools/lib.js";import{Card as a,Header as m,Accordion as x,AccordionSection as $,ContentGrid as j,Image as w}from"@dropins/tools/components.js";import"../chunks/OrderCancelReasonsForm.js";import"../chunks/ReturnOrder.js";import{useText as F}from"@dropins/tools/i18n.js";import{C as q}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";import{useState as N,useEffect as V}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/preact.js";import{events as W}from"@dropins/tools/event-bus.js";var o=(n=>(n.PENDING="pending",n.SHIPPING="shipping",n.COMPLETE="complete",n.PROCESSING="processing",n.HOLD="on hold",n.CANCELED="Canceled",n.SUSPECTED_FRAUD="suspected fraud",n.PAYMENT_REVIEW="payment review",n))(o||{});const z=({slots:n,orderData:e,collapseThreshold:g=10})=>{var C,I,f,S,T;const l=F({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",notYetShippedImagesTitle:"Order.ShippingStatusCard.notYetShippedImagesTitle",notYetShippedItems:"Order.ShippingStatusCard.notYetShippedItems",notYetShippedItem:"Order.ShippingStatusCard.notYetShippedItem",noInfoTitle:"Order.OrderStatusContent.noInfoTitle"}),h=(C=e==null?void 0:e.status)==null?void 0:C.toLocaleLowerCase(),G=((I=e==null?void 0:e.shipments)==null?void 0:I.length)===1&&(h==null?void 0:h.includes(o.COMPLETE)),i=(f=e==null?void 0:e.items)==null?void 0:f.filter(c=>(c==null?void 0:c.quantityShipped)===0);return!e||h!=null&&h.includes(o.CANCELED)?null:(S=e==null?void 0:e.shipments)!=null&&S.length?r(A,{children:[(T=e==null?void 0:e.shipments)==null?void 0:T.map(({tracking:c,items:t,id:H},M)=>r(a,{variant:"secondary",className:"order-shipping-status-card",children:[p(m,{title:l.shippingCardTitle}),c==null?void 0:c.map(s=>{var d;return r("div",{className:"order-shipping-status-card__header",role:"status",children:[r("div",{className:"order-shipping-status-card__header--content",children:[r("p",{children:[l.carrier," ",(d=s==null?void 0:s.carrier)==null?void 0:d.toLocaleUpperCase()," | ",s==null?void 0:s.number]}),p("p",{children:s==null?void 0:s.title})]}),n!=null&&n.DeliveryTrackActions?p(E,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:n==null?void 0:n.DeliveryTrackActions,context:{trackInformation:s}}):null]},s.number)}),G?null:p(x,{actionIconPosition:"right","data-testid":"dropinAccordion",children:p($,{"data-position":M+1,defaultOpen:g>=(t==null?void 0:t.length),title:`${l.notYetShippedImagesTitle} (${i==null?void 0:i.length} ${i!=null&&i.length&&(i==null?void 0:i.length)>1?l.notYetShippedItems:l.notYetShippedItem})`,children:p(j,{maxColumns:6,emptyGridContent:p(A,{}),className:"order-shipping-status-card__images",children:t==null?void 0:t.map(s=>{var u,v,O,y,_,L;const d=(O=(v=(u=s==null?void 0:s.orderItem)==null?void 0:u.product)==null?void 0:v.thumbnail)==null?void 0:O.label,R=(L=(_=(y=s==null?void 0:s.orderItem)==null?void 0:y.product)==null?void 0:_.thumbnail)==null?void 0:L.url;return p(w,{alt:d,src:R||"",width:85,height:114},s.id)})})})}),n!=null&&n.DeliveryTimeLine?p(E,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:n==null?void 0:n.DeliveryTimeLine,context:{}}):null]},H)),i!=null&&i.length?r(a,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[p(m,{title:l.notYetShippedTitle}),p(x,{actionIconPosition:"right",children:p($,{defaultOpen:g>=(i==null?void 0:i.length),title:`${l.notYetShippedImagesTitle} (${i==null?void 0:i.length} ${i!=null&&i.length&&(i==null?void 0:i.length)>1?l.notYetShippedItems:l.notYetShippedItem})`,children:p("div",{className:"order-shipping-status-card__images",children:i==null?void 0:i.map(({id:c,thumbnail:t})=>p(w,{alt:t==null?void 0:t.label,src:(t==null?void 0:t.url)||"",width:85,height:114},c))})})})]}):null]}):r(a,{variant:"secondary",className:"order-shipping-status-card",children:[p(m,{title:l.shippingInfoTitle}),p("div",{className:"order-shipping-status-card__header",children:r("div",{className:"order-shipping-status-card__header--content",children:[e!=null&&e.carrier?p("p",{children:e==null?void 0:e.carrier}):null,p("p",{children:l.noInfoTitle})]})})]})},B=({orderData:n})=>{const[e,g]=N(n);return V(()=>{const l=W.on("order/data",h=>{g(h)},{eager:!0});return()=>{l==null||l.off()}},[]),{order:e}},ei=({slots:n,className:e,collapseThreshold:g,orderData:l})=>{const{order:h}=B({orderData:l});return p("div",{className:U(["order-shipping-status",e]),children:h?p(z,{slots:n,orderData:h,collapseThreshold:g}):p(q,{withCard:!1})})};export{ei as ShippingStatus,ei as default};
