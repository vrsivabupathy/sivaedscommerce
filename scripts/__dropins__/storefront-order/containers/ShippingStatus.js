/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsx as i,jsxs as S,Fragment as _}from"@dropins/tools/preact-jsx-runtime.js";import{classes as $,VComponent as A,Slot as E}from"@dropins/tools/lib.js";import{Card as L,Header as w,Accordion as R,AccordionSection as G,ContentGrid as V,Image as q}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{useState as x,useEffect as k}from"@dropins/tools/preact-hooks.js";import{events as D}from"@dropins/tools/event-bus.js";import"@dropins/tools/preact.js";import{u as nn}from"../chunks/useIsMobile.js";import{Text as B,useText as en}from"@dropins/tools/i18n.js";import{C as pn}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";var M=(e=>(e.PENDING="pending",e.SHIPPING="shipping",e.COMPLETE="complete",e.PROCESSING="processing",e.HOLD="on hold",e.CANCELED="Canceled",e.SUSPECTED_FRAUD="suspected fraud",e.PAYMENT_REVIEW="payment review",e))(M||{});const tn=({orderData:e})=>{const[r,n]=x(!0),[t,m]=x(e),[h,o]=x(!1);return k(()=>{const d=D.on("order/data",u=>{m(u),o(u==null?void 0:u.isVirtual),n(!1)},{eager:!0});return()=>{d==null||d.off()}},[]),{loading:r,order:t,isVirtualProduct:h}},Z=({value:e,variant:r="primary",size:n="medium",icon:t,className:m,children:h,disabled:o=!1,active:d=!1,activeChildren:u,activeIcon:p,href:C,...b})=>{let g="dropin-button";(t&&!h||t&&d&&!u||!t&&d&&p)&&(g="dropin-iconButton"),d&&u&&(g="dropin-button"),m=$([g,`${g}--${n}`,`${g}--${r}`,[`${g}--${r}--disabled`,o],h&&t&&`${g}--with-icon`,!h&&u&&t&&`${g}--with-icon`,d&&p&&`${g}--with-icon`,m]);const c=$(["dropin-button-icon",`dropin-button-icon--${r}`,[`dropin-button-icon--${r}--disabled`,o],t==null?void 0:t.props.className]),a=C?{node:i("a",{}),role:"link",href:C,...b,disabled:o,active:d,onKeyDown:y=>{o&&y.preventDefault()},tabIndex:o?-1:0}:{node:i("button",{}),role:"button",...b,value:e,disabled:o,active:d};return S(A,{...a,className:m,children:[t&&!d&&i(A,{node:t,className:c}),p&&d&&i(A,{node:p,className:c}),h&&!d&&(typeof h=="string"?i("span",{children:h}):h),d&&u&&(typeof u=="string"?i("span",{children:u}):u)]})},sn=({slots:e,collapseThreshold:r,translations:n,returnData:t,routeTracking:m,routeProductDetails:h})=>{var u;const o=nn(),d=h?"a":"span";return S(L,{variant:"secondary",className:$(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[i(w,{title:n.returnOrderCardTitle}),S("div",{children:[(u=t==null?void 0:t.tracking)==null?void 0:u.map((p,C)=>{var a,y;const b={title:"",number:(p==null?void 0:p.trackingNumber)??"",carrier:((a=p==null?void 0:p.carrier)==null?void 0:a.label)??""},g=m==null?void 0:m(b),c=g?()=>{window.open(g,"_blank","noreferrer")}:null;return S("div",{className:"order-shipping-status-card__header",children:[S("div",{children:[`${n.carrier} `,`${(y=b.carrier)==null?void 0:y.toLocaleUpperCase()} | `,b.number]}),c?i(Z,{onClick:c,children:n.trackButton}):null]},`${b.number}_${C}`)}),e!=null&&e.ReturnItemsDetails?i(E,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:e==null?void 0:e.ReturnItemsDetails,context:{items:t.items}}):null,i(R,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(G,{defaultOpen:r>=t.items.length,title:i(B,{id:"Order.ShippingStatusCard.itemText",plural:t.items.reduce((p,C)=>p+C.totalQuantity,0),fields:{count:t.items.reduce((p,C)=>p+C.totalQuantity,0)}}),children:i(V,{maxColumns:o?3:9,emptyGridContent:i(_,{}),className:$(["order-shipping-status-card__images",["order-shipping-status-card__images-3",o]]),children:t.items.map((p,C)=>{var c,a;const b=(c=p.thumbnail)==null?void 0:c.label,g=(a=p.thumbnail)==null?void 0:a.url;return i(d,{href:(h==null?void 0:h(p))??"#","data-testid":`${C}${p.uid}`,children:i(q,{alt:b,src:g,width:85,height:114})},`${C}${p.uid}`)})})})})]})]})},rn=({translations:e,slots:r,orderData:n,collapseThreshold:t=10,routeProductDetails:m,routeTracking:h})=>{var y,U,H,j,v,F,Q;const o=!!(n!=null&&n.returnNumber),d=n==null?void 0:n.returnNumber,u=m?"a":"span",p=(y=n==null?void 0:n.status)==null?void 0:y.toLocaleLowerCase(),b=((U=n==null?void 0:n.shipments)==null?void 0:U.length)===1&&(p==null?void 0:p.includes(M.COMPLETE)),g=(H=n==null?void 0:n.shipments)==null?void 0:H.every(s=>s.tracking.length===0),c=(j=n==null?void 0:n.items)==null?void 0:j.filter(s=>(s==null?void 0:s.quantityShipped)===0||(s==null?void 0:s.quantityShipped)<(s==null?void 0:s.quantityOrdered)),a=(v=n==null?void 0:n.items)==null?void 0:v.reduce((s,f)=>{const I=f.quantityOrdered-f.quantityShipped;return s+(I>0?I:0)},0);if(o&&(n!=null&&n.returns.length)){const s=n.returns.find(f=>f.returnNumber===d);return!s||s.tracking.length===0?null:i(sn,{slots:r,collapseThreshold:t,translations:e,returnData:s,routeTracking:h,routeProductDetails:m})}return!n||p!=null&&p.includes(M.CANCELED)?null:(F=n==null?void 0:n.shipments)!=null&&F.length?g&&!(c!=null&&c.length)&&b?null:S(_,{children:[(Q=n==null?void 0:n.shipments)==null?void 0:Q.map(({tracking:s,items:f,id:I},P)=>{const K=f.reduce((l,N)=>{var O;return l+(((O=N.orderItem)==null?void 0:O.quantityShipped)??0)},0);return S(L,{variant:"secondary",className:"order-shipping-status-card",children:[i(w,{title:e.shippingCardTitle}),s==null?void 0:s.map(l=>{var T;const N=h==null?void 0:h(l),O=N?()=>{window.open(N,"_blank","noreferrer")}:null;return S("div",{className:"order-shipping-status-card__header",role:"status",children:[S("div",{className:"order-shipping-status-card__header--content",children:[S("p",{children:[e.carrier," ",(T=l==null?void 0:l.carrier)==null?void 0:T.toLocaleUpperCase()," | ",l==null?void 0:l.number]}),i("p",{children:l==null?void 0:l.title})]}),r!=null&&r.DeliveryTrackActions?i(E,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:r==null?void 0:r.DeliveryTrackActions,context:{trackInformation:l}}):O?i(Z,{onClick:O,children:e.trackButton}):null]},l.number)}),b?null:i(R,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(G,{"data-position":P+1,defaultOpen:t>=(f==null?void 0:f.length),title:i(_,{children:i(B,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:K,fields:{count:K}})}),children:i(V,{maxColumns:6,emptyGridContent:i(_,{}),className:"order-shipping-status-card__images",children:f==null?void 0:f.map(l=>{var T,W,Y,z,J,X;const N=(Y=(W=(T=l==null?void 0:l.orderItem)==null?void 0:T.product)==null?void 0:W.thumbnail)==null?void 0:Y.label,O=(X=(J=(z=l==null?void 0:l.orderItem)==null?void 0:z.product)==null?void 0:J.thumbnail)==null?void 0:X.url;return i(u,{href:(m==null?void 0:m(l))??"#",children:i(q,{alt:N,src:O||"",width:85,height:114})},l.id)})})})}),r!=null&&r.DeliveryTimeLine?i(E,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:r==null?void 0:r.DeliveryTimeLine,context:{}}):null]},I)}),c!=null&&c.length?S(L,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[i(w,{title:e.notYetShippedTitle}),i(R,{actionIconPosition:"right",children:i(G,{defaultOpen:t>=(c==null?void 0:c.length),title:i(B,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:a,fields:{count:a}}),children:i(V,{maxColumns:6,emptyGridContent:i(_,{}),className:"order-shipping-status-card__images",children:c==null?void 0:c.map(s=>{var f,I;return i(u,{href:(m==null?void 0:m(s))??"#",children:i(q,{alt:(f=s.thumbnail)==null?void 0:f.label,src:((I=s.thumbnail)==null?void 0:I.url)||"",width:85,height:114})},s.id)})})})})]}):null]}):S(L,{variant:"secondary",className:"order-shipping-status-card",children:[i(w,{title:e.shippingInfoTitle}),i("div",{className:"order-shipping-status-card__header",children:S("div",{className:"order-shipping-status-card__header--content",children:[n!=null&&n.carrier?i("p",{children:n==null?void 0:n.carrier}):null,i("p",{children:e.noInfoTitle})]})})]})},bn=({slots:e,className:r,collapseThreshold:n,orderData:t,routeOrderDetails:m,routeTracking:h,routeProductDetails:o})=>{const{loading:d,order:u,isVirtualProduct:p}=tn({orderData:t}),C=en({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber",trackButton:"Order.ShippingStatusCard.trackButton"});return!d&&p?null:i("div",{className:$(["order-shipping-status",r]),children:!d&&u?i(rn,{translations:C,routeOrderDetails:m,routeTracking:h,slots:e,orderData:u,collapseThreshold:n,routeProductDetails:o}):i(pn,{withCard:!1})})};export{bn as ShippingStatus,bn as default};
