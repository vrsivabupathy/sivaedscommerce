/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsxs as u,jsx as n,Fragment as b}from"@dropins/tools/preact-jsx-runtime.js";import{classes as L,Slot as A}from"@dropins/tools/lib.js";import{Card as N,Header as _,Accordion as o,AccordionSection as x,ContentGrid as W,Image as E}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{useState as y,useEffect as J}from"@dropins/tools/preact-hooks.js";import{events as K}from"@dropins/tools/event-bus.js";import{u as Q}from"../chunks/useIsMobile.js";import{Text as $,useText as X}from"@dropins/tools/i18n.js";import{C as Z}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";import"@dropins/tools/preact.js";var R=(e=>(e.PENDING="pending",e.SHIPPING="shipping",e.COMPLETE="complete",e.PROCESSING="processing",e.HOLD="on hold",e.CANCELED="Canceled",e.SUSPECTED_FRAUD="suspected fraud",e.PAYMENT_REVIEW="payment review",e))(R||{});const Y=({orderData:e})=>{const[r,i]=y(!0),[c,d]=y(e),[m,f]=y(!1);return J(()=>{const a=K.on("order/data",t=>{d(t),f(t==null?void 0:t.isVirtual),i(!1)},{eager:!0});return()=>{a==null||a.off()}},[]),{loading:r,order:c,isVirtualProduct:m}},P=({slots:e,collapseThreshold:r,translations:i,returnData:c,routeTracking:d,routeProductDetails:m})=>{var t;const f=Q(),a=m?"a":"span";return u(N,{variant:"secondary",className:L(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[n(_,{title:i.returnOrderCardTitle}),u("div",{children:[(t=c==null?void 0:c.tracking)==null?void 0:t.map((l,C)=>{var S,p;return u("p",{children:[`${i.carrier} ${(p=(S=l==null?void 0:l.carrier)==null?void 0:S.label)==null?void 0:p.toLocaleUpperCase()}: `,n("a",{href:`${(d==null?void 0:d(l))??"#"}`,rel:"noreferrer",children:l.trackingNumber})]},`${l.trackingNumber}_${C}`)}),e!=null&&e.ReturnItemsDetails?n(A,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:e==null?void 0:e.ReturnItemsDetails,context:{items:c.items}}):null,n(o,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n(x,{defaultOpen:r>=c.items.length,title:n($,{id:"Order.ShippingStatusCard.itemText",plural:c.items.length,fields:{count:c.items.length}}),children:n(W,{maxColumns:f?3:9,emptyGridContent:n(b,{}),className:L(["order-shipping-status-card__images",["order-shipping-status-card__images-3",f]]),children:c.items.map((l,C)=>{var I,T;const S=(I=l.thumbnail)==null?void 0:I.label,p=(T=l.thumbnail)==null?void 0:T.url;return n(a,{href:(m==null?void 0:m(l))??"#","data-testid":`${C}${l.uid}`,children:n(E,{alt:S,src:p,width:85,height:114})},`${C}${l.uid}`)})})})})]})]})},k=({translations:e,slots:r,orderData:i,collapseThreshold:c=10,routeProductDetails:d,routeTracking:m})=>{var I,T,w,G,M;const f=!!(i!=null&&i.returnNumber),a=i==null?void 0:i.returnNumber,t=d?"a":"span",l=(I=i==null?void 0:i.status)==null?void 0:I.toLocaleLowerCase(),S=((T=i==null?void 0:i.shipments)==null?void 0:T.length)===1&&(l==null?void 0:l.includes(R.COMPLETE)),p=(w=i==null?void 0:i.items)==null?void 0:w.filter(g=>(g==null?void 0:g.quantityShipped)===0);if(f&&(i!=null&&i.returns.length)){const g=i.returns.find(s=>s.returnNumber===a);return n(b,{children:g&&g.tracking.length>0?n(P,{slots:r,collapseThreshold:c,translations:e,returnData:g,routeTracking:m,routeProductDetails:d}):null})}return!i||l!=null&&l.includes(R.CANCELED)?null:(G=i==null?void 0:i.shipments)!=null&&G.length?u(b,{children:[(M=i==null?void 0:i.shipments)==null?void 0:M.map(({tracking:g,items:s,id:O},z)=>u(N,{variant:"secondary",className:"order-shipping-status-card",children:[n(_,{title:e.shippingCardTitle}),g==null?void 0:g.map(h=>{var v;return u("div",{className:"order-shipping-status-card__header",role:"status",children:[u("div",{className:"order-shipping-status-card__header--content",children:[u("p",{children:[e.carrier," ",(v=h==null?void 0:h.carrier)==null?void 0:v.toLocaleUpperCase()," | ",h==null?void 0:h.number]}),n("p",{children:h==null?void 0:h.title})]}),r!=null&&r.DeliveryTrackActions?n(A,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:r==null?void 0:r.DeliveryTrackActions,context:{trackInformation:h}}):null]},h.number)}),S?null:n(o,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n(x,{"data-position":z+1,defaultOpen:c>=(s==null?void 0:s.length),title:n(b,{children:n($,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:s==null?void 0:s.length,fields:{count:s==null?void 0:s.length}})}),children:n(W,{maxColumns:6,emptyGridContent:n(b,{}),className:"order-shipping-status-card__images",children:s==null?void 0:s.map(h=>{var V,U,H,j,F,q;const v=(H=(U=(V=h==null?void 0:h.orderItem)==null?void 0:V.product)==null?void 0:U.thumbnail)==null?void 0:H.label,B=(q=(F=(j=h==null?void 0:h.orderItem)==null?void 0:j.product)==null?void 0:F.thumbnail)==null?void 0:q.url;return n(t,{href:(d==null?void 0:d(h))??"#",children:n(E,{alt:v,src:B||"",width:85,height:114})},h.id)})})})}),r!=null&&r.DeliveryTimeLine?n(A,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:r==null?void 0:r.DeliveryTimeLine,context:{}}):null]},O)),p!=null&&p.length?u(N,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[n(_,{title:e.notYetShippedTitle}),n(o,{actionIconPosition:"right",children:n(x,{defaultOpen:c>=(p==null?void 0:p.length),title:n($,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:p==null?void 0:p.length,fields:{count:p==null?void 0:p.length}}),children:n("div",{className:"order-shipping-status-card__images",children:p==null?void 0:p.map(g=>{var s,O;return n(t,{href:(d==null?void 0:d(g))??"#",children:n(E,{alt:(s=g.thumbnail)==null?void 0:s.label,src:((O=g.thumbnail)==null?void 0:O.url)||"",width:85,height:114})},g.id)})})})})]}):null]}):u(N,{variant:"secondary",className:"order-shipping-status-card",children:[n(_,{title:e.shippingInfoTitle}),n("div",{className:"order-shipping-status-card__header",children:u("div",{className:"order-shipping-status-card__header--content",children:[i!=null&&i.carrier?n("p",{children:i==null?void 0:i.carrier}):null,n("p",{children:e.noInfoTitle})]})})]})},gi=({slots:e,className:r,collapseThreshold:i,orderData:c,routeOrderDetails:d,routeTracking:m,routeProductDetails:f})=>{const{loading:a,order:t,isVirtualProduct:l}=Y({orderData:c}),C=X({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber"});return!a&&l?null:n("div",{className:L(["order-shipping-status",r]),children:!a&&t?n(k,{translations:C,routeOrderDetails:d,routeTracking:m,slots:e,orderData:t,collapseThreshold:i,routeProductDetails:f}):n(Z,{withCard:!1})})};export{gi as ShippingStatus,gi as default};
