import{jsx as a,jsxs as b,Fragment as w}from"@dropins/tools/preact-jsx-runtime.js";import{Card as U,Header as X,Price as Y,CartItem as g,Icon as I,Image as P}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{classes as C}from"@dropins/tools/lib.js";import*as u from"@dropins/tools/preact-compat.js";import{useMemo as T,useCallback as p,useState as S,useEffect as R}from"@dropins/tools/preact-hooks.js";import{Fragment as ee}from"@dropins/tools/preact.js";import{O as te}from"../chunks/OrderLoaders.js";import{events as le}from"@dropins/tools/event-bus.js";import{useText as ne}from"@dropins/tools/i18n.js";import{s as ae}from"../chunks/setTaxStatus.js";import{g as se}from"../chunks/getStoreConfig.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";const ie=v=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...v},u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),me=({loading:v,taxConfig:e,order:y=null,withHeader:O=!0,showConfigurableOptions:r,routeProductDetails:f})=>{const h=ne({cancelled:"Order.OrderProductListContent.cancelledTitle",allOrders:"Order.OrderProductListContent.allOrdersTitle",sender:"Order.OrderProductListContent.GiftCard.sender",recipient:"Order.OrderProductListContent.GiftCard.recipient",message:"Order.OrderProductListContent.GiftCard.message",outOfStock:"Order.OrderProductListContent.stockStatus.outOfStock",downloadableCount:"Order.OrderProductListContent.downloadableCount"}),i=T(()=>{if(!y)return[];const{items:m}=y;return[{type:"cancelled",list:m.filter(s=>s.quantityCanceled),title:h.cancelled},{type:"",list:m.filter(s=>!s.quantityCanceled),title:h.allOrders}]},[y,h]);return y?a(U,{variant:"secondary",className:"order-order-product-list-content",children:i.filter(m=>m.list.length).map((m,s)=>{var k;return b(ee,{children:[O?a(X,{title:`${m.title} (${m.list.length})`}):null,a("ul",{className:"order-order-product-list-content__items",children:(k=m.list)==null?void 0:k.map(E=>a("li",{"data-testid":"order-product-list-content-item",children:a(re,{loading:v,product:E,itemType:m.type,taxConfig:e,translations:h,showConfigurableOptions:r,routeProductDetails:f})},E.id))})]},s)})}):a(te,{})},re=({loading:v,product:e,itemType:y,taxConfig:O,translations:r,showConfigurableOptions:f,routeProductDetails:h})=>{var _,c,x,Q,H,V,$,M,q,F,G,Z,j,z,W,B,K;const{taxExcluded:i,taxIncluded:m}=O,s=p((d,D,J)=>a(Y,{amount:d,currency:D,weight:"normal",...J}),[]);let k={};const E=y==="cancelled",A=(c=(_=e==null?void 0:e.product)==null?void 0:_.stockStatus)==null?void 0:c.includes("IN_STOCK"),t=(e==null?void 0:e.giftCard)||{},l=(x=e==null?void 0:e.itemPrices)==null?void 0:x.priceIncludingTax,n=(Q=e==null?void 0:e.itemPrices)==null?void 0:Q.originalPrice,o=(H=e==null?void 0:e.itemPrices)==null?void 0:H.price,L=e.discounted&&((V=e.price)==null?void 0:V.value)!==(n==null?void 0:n.value)*(e==null?void 0:e.totalQuantity),N={..."configurableOptions"in e?e.configurableOptions:{},..."bundleOptions"in e?e.bundleOptions:{},..."senderName"in t&&(t!=null&&t.senderName)?{[r.sender]:t==null?void 0:t.senderName}:{},..."senderEmail"in t&&(t!=null&&t.senderEmail)?{[r.sender]:t==null?void 0:t.senderEmail}:{},..."recipientName"in t&&(t!=null&&t.recipientName)?{[r.recipient]:t==null?void 0:t.recipientName}:{},..."recipientEmail"in t&&(t!=null&&t.recipientEmail)?{[r.recipient]:t==null?void 0:t.recipientEmail}:{},..."message"in t&&(t!=null&&t.message)?{[r.message]:t==null?void 0:t.message}:{},..."downloadableLinks"in e&&(e!=null&&e.downloadableLinks)?{[`${($=e==null?void 0:e.downloadableLinks)==null?void 0:$.count} ${r.downloadableCount}`]:(M=e==null?void 0:e.downloadableLinks)==null?void 0:M.result}:{}};if(m&&i){const d=L?n==null?void 0:n.value:(l==null?void 0:l.value)*(e==null?void 0:e.totalQuantity);k={taxExcluded:!0,taxIncluded:void 0,price:s(n==null?void 0:n.value,n==null?void 0:n.currency),total:b(w,{children:[s(d,n==null?void 0:n.currency,{variant:e.discounted&&(l==null?void 0:l.value)!==d?"strikethrough":"default"}),e.discounted&&(l==null?void 0:l.value)!==d?s(l==null?void 0:l.value,l==null?void 0:l.currency,{sale:!0,weight:"bold"}):null]}),totalExcludingTax:s((o==null?void 0:o.value)*e.totalQuantity,o==null?void 0:o.currency)}}else if(!m&&i)k={taxExcluded:void 0,taxIncluded:void 0,price:s(n==null?void 0:n.value,n==null?void 0:n.currency),total:b(w,{children:[s((n==null?void 0:n.value)*(e==null?void 0:e.totalQuantity),l==null?void 0:l.currency,{variant:L?"strikethrough":"default"}),L?s((q=e.price)==null?void 0:q.value,(F=e.price)==null?void 0:F.currency,{sale:!0,weight:"bold"}):null]}),totalExcludingTax:s((o==null?void 0:o.value)*(e==null?void 0:e.totalQuantity),o==null?void 0:o.currency)};else if(m&&!i){const d=L?n.value:l.value*e.totalQuantity;k={taxExcluded:void 0,taxIncluded:!0,price:s(l==null?void 0:l.value,l==null?void 0:l.currency),total:b(w,{children:[s(d,l==null?void 0:l.currency,{variant:L?"strikethrough":"default",weight:"bold"}),L?s(l==null?void 0:l.value,l==null?void 0:l.currency,{sale:!0,weight:"bold"}):null]})}}return a(g,{loading:v,alert:E&&A?b("span",{children:[a(I,{source:ie}),r.outOfStock]}):a(w,{}),configurations:(f==null?void 0:f(N))??N,title:h?a("a",{"data-testid":"product-name",className:C(["cart-summary-item__title",["cart-summary-item__title--strikethrough",E]]),href:h(e),children:(G=e==null?void 0:e.product)==null?void 0:G.name}):a("div",{"data-testid":"product-name",className:C(["cart-summary-item__title",["cart-summary-item__title--strikethrough",E]]),children:(Z=e==null?void 0:e.product)==null?void 0:Z.name}),sku:a("div",{children:(j=e==null?void 0:e.product)==null?void 0:j.sku}),quantity:e.totalQuantity,image:h?a("a",{href:h(e),children:a(P,{src:(z=e==null?void 0:e.product)==null?void 0:z.thumbnail.url,alt:(W=e==null?void 0:e.product)==null?void 0:W.thumbnail.label,loading:"lazy",width:"90",height:"120"})}):a(P,{src:(B=e==null?void 0:e.product)==null?void 0:B.thumbnail.url,alt:(K=e==null?void 0:e.product)==null?void 0:K.thumbnail.label,loading:"lazy",width:"90",height:"120"}),...k})},he=({orderData:v})=>{const[e,y]=S(!0),[O,r]=S(v),[f,h]=S({taxIncluded:!1,taxExcluded:!1});return R(()=>{se().then(i=>{i&&h(ae(i==null?void 0:i.shoppingCartDisplayPrice))}).finally(()=>{y(!1)})},[]),R(()=>{const i=le.on("order/data",m=>{r(m)},{eager:!0});return()=>{i==null||i.off()}},[]),{loading:e,taxConfig:f,order:O}},Ce=({className:v,orderData:e,withHeader:y,showConfigurableOptions:O,routeProductDetails:r})=>{const{loading:f,taxConfig:h,order:i}=he({orderData:e});return a("div",{className:C(["order-order-product-list",v]),children:a(me,{loading:f,taxConfig:h,order:i,withHeader:y,showConfigurableOptions:O,routeProductDetails:r})})};export{Ce as OrderProductList,Ce as default};
