/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as k,Fragment as E}from"@dropins/tools/preact-jsx-runtime.js";import{Card as z,Header as B,Price as K,CartItem as A,Icon as J,Image as U}from"@dropins/tools/components.js";import"../chunks/OrderCancelReasonsForm.js";import{u as X}from"../chunks/ReturnOrder.js";import{classes as Z}from"@dropins/tools/lib.js";import*as b from"@dropins/tools/preact-compat.js";import{useMemo as Y,useCallback as g,useState as w,useEffect as G}from"@dropins/tools/preact-hooks.js";import{Fragment as I}from"@dropins/tools/preact.js";import{O as T}from"../chunks/OrderLoaders.js";import{events as p}from"@dropins/tools/event-bus.js";import{useText as ee}from"@dropins/tools/i18n.js";import{s as te}from"../chunks/setTaxStatus.js";import{g as ne}from"../chunks/getStoreConfig.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";const le=y=>b.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...y},b.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),b.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),se=({loading:y,taxConfig:e,order:u=null,withHeader:O=!0,showConfigurableOptions:i})=>{const d=X(),m=ee({cancelled:"Order.OrderProductListContent.cancelledTitle",allOrders:d?"Order.OrderProductListContent.allReturnOrdersTitle":"Order.OrderProductListContent.allOrdersTitle",returned:"Order.OrderProductListContent.Returned",sender:"Order.OrderProductListContent.GiftCard.sender",recipient:"Order.OrderProductListContent.GiftCard.recipient",message:"Order.OrderProductListContent.GiftCard.message",outOfStock:"Order.OrderProductListContent.stockStatus.outOfStock",downloadableCount:"Order.OrderProductListContent.downloadableCount"}),r=Y(()=>{if(!u)return[];const s=d?u.returns[0]:u,{items:v}=s;return[{type:"returned",list:v.filter(h=>h.quantityReturned),title:m.returned},{type:"cancelled",list:v.filter(h=>h.quantityCanceled),title:m.cancelled},{type:"",list:v.filter(h=>!h.quantityCanceled),title:m.allOrders}]},[u,d,m]);return u?a(z,{variant:"secondary",className:"order-order-product-list-content",children:r.filter(s=>s.list.length).map((s,v)=>{var h;return k(I,{children:[O?a(B,{title:`${s.title} (${s.list.length})`}):null,a("ul",{className:"order-order-product-list-content__items",children:(h=s.list)==null?void 0:h.map(L=>a("li",{"data-testid":"order-product-list-content-item",children:a(ae,{loading:y,product:L,itemType:s.type,taxConfig:e,translations:m,showConfigurableOptions:i})},L.id))})]},v)})}):a(T,{})},ae=({loading:y,product:e,itemType:u,taxConfig:O,translations:i,showConfigurableOptions:d})=>{var S,N,x,Q,_,P,H,R,V,$,q,M,D,F;const{taxExcluded:m,taxIncluded:r}=O,s=g((f,j,W)=>a(K,{amount:f,currency:j,weight:"normal",...W}),[]);let v={};const h=u==="cancelled",L=(N=(S=e==null?void 0:e.product)==null?void 0:S.stockStatus)==null?void 0:N.includes("IN_STOCK"),t=(e==null?void 0:e.giftCard)||{},n=(x=e==null?void 0:e.itemPrices)==null?void 0:x.priceIncludingTax,l=(Q=e==null?void 0:e.itemPrices)==null?void 0:Q.originalPrice,o=(_=e==null?void 0:e.itemPrices)==null?void 0:_.price,c=e.discounted&&((P=e.price)==null?void 0:P.value)!==(l==null?void 0:l.value)*(e==null?void 0:e.totalQuantity),C={..."configurableOptions"in e?e.configurableOptions:{},..."bundleOptions"in e?e.bundleOptions:{},..."senderName"in t&&(t!=null&&t.senderName)?{[i.sender]:t==null?void 0:t.senderName}:{},..."senderEmail"in t&&(t!=null&&t.senderEmail)?{[i.sender]:t==null?void 0:t.senderEmail}:{},..."recipientName"in t&&(t!=null&&t.recipientName)?{[i.recipient]:t==null?void 0:t.recipientName}:{},..."recipientEmail"in t&&(t!=null&&t.recipientEmail)?{[i.recipient]:t==null?void 0:t.recipientEmail}:{},..."message"in t&&(t!=null&&t.message)?{[i.message]:t==null?void 0:t.message}:{},..."downloadableLinks"in e&&(e!=null&&e.downloadableLinks)?{[`${(H=e==null?void 0:e.downloadableLinks)==null?void 0:H.count} ${i.downloadableCount}`]:(R=e==null?void 0:e.downloadableLinks)==null?void 0:R.result}:{}};if(r&&m){const f=c?l==null?void 0:l.value:(n==null?void 0:n.value)*(e==null?void 0:e.totalQuantity);v={taxExcluded:!0,taxIncluded:void 0,price:s(l==null?void 0:l.value,l==null?void 0:l.currency),total:k(E,{children:[s(f,l==null?void 0:l.currency,{variant:e.discounted&&(n==null?void 0:n.value)!==f?"strikethrough":"default"}),e.discounted&&(n==null?void 0:n.value)!==f?s(n==null?void 0:n.value,n==null?void 0:n.currency,{sale:!0,weight:"bold"}):null]}),totalExcludingTax:s((o==null?void 0:o.value)*e.totalQuantity,o==null?void 0:o.currency)}}else if(!r&&m)v={taxExcluded:void 0,taxIncluded:void 0,price:s(l==null?void 0:l.value,l==null?void 0:l.currency),total:k(E,{children:[s((l==null?void 0:l.value)*(e==null?void 0:e.totalQuantity),n==null?void 0:n.currency,{variant:c?"strikethrough":"default"}),c?s((V=e.price)==null?void 0:V.value,($=e.price)==null?void 0:$.currency,{sale:!0,weight:"bold"}):null]}),totalExcludingTax:s((o==null?void 0:o.value)*(e==null?void 0:e.totalQuantity),o==null?void 0:o.currency)};else if(r&&!m){const f=c?l.value:n.value*e.totalQuantity;v={taxExcluded:void 0,taxIncluded:!0,price:s(n==null?void 0:n.value,n==null?void 0:n.currency),total:k(E,{children:[s(f,n==null?void 0:n.currency,{variant:c?"strikethrough":"default",weight:"bold"}),c?s(n==null?void 0:n.value,n==null?void 0:n.currency,{sale:!0,weight:"bold"}):null]})}}return a(A,{loading:y,alert:h&&L?k("span",{children:[a(J,{source:le}),i.outOfStock]}):a(E,{}),configurations:(d==null?void 0:d(C))??C,title:a("div",{"data-testid":"product-name",className:Z(["cart-summary-item__title",["cart-summary-item__title--strikethrough",h]]),children:(q=e==null?void 0:e.product)==null?void 0:q.name}),sku:a("div",{children:(M=e==null?void 0:e.product)==null?void 0:M.sku}),quantity:e.totalQuantity,image:a(U,{src:(D=e==null?void 0:e.product)==null?void 0:D.thumbnail.url,alt:(F=e==null?void 0:e.product)==null?void 0:F.thumbnail.label,loading:"lazy",width:"90",height:"120"}),...v})},re=({orderData:y})=>{const[e,u]=w(!0),[O,i]=w(y),[d,m]=w({taxIncluded:!1,taxExcluded:!1});return G(()=>{ne().then(r=>{r&&m(te(r==null?void 0:r.shoppingCartDisplayPrice))}).finally(()=>{u(!1)})},[]),G(()=>{const r=p.on("order/data",s=>{i(s)},{eager:!0});return()=>{r==null||r.off()}},[]),{loading:e,taxConfig:d,order:O}},be=({className:y,orderData:e,withHeader:u,showConfigurableOptions:O})=>{const{loading:i,taxConfig:d,order:m}=re({orderData:e});return a("div",{className:Z(["order-order-product-list",y]),children:a(se,{loading:i,taxConfig:d,order:m,withHeader:u,showConfigurableOptions:O})})};export{be as OrderProductList,be as default};
