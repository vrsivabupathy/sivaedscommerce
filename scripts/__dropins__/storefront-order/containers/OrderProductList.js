/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsx as r,jsxs as E,Fragment as w}from"@dropins/tools/preact-jsx-runtime.js";import{Card as Y,Header as g,Price as D,CartItem as I,Icon as T,Image as A}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{classes as S}from"@dropins/tools/lib.js";import{useState as N,useEffect as J,useMemo as p,useCallback as ee}from"@dropins/tools/preact-hooks.js";import{events as te}from"@dropins/tools/event-bus.js";import{s as ne}from"../chunks/setTaxStatus.js";import{g as le}from"../chunks/getStoreConfig.js";import*as C from"@dropins/tools/preact-compat.js";import{Fragment as se}from"@dropins/tools/preact.js";import{O as ae}from"../chunks/OrderLoaders.js";import{useText as re}from"@dropins/tools/i18n.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";const ie=v=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...v},C.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),C.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),me=({orderData:v})=>{const[e,s]=N(!0),[O,u]=N(v),[y,f]=N({taxIncluded:!1,taxExcluded:!1});return J(()=>{le().then(i=>{i&&f(ne(i==null?void 0:i.shoppingCartDisplayPrice))}).finally(()=>{s(!1)})},[]),J(()=>{const i=te.on("order/data",o=>{u(o)},{eager:!0});return()=>{i==null||i.off()}},[]),{loading:e,taxConfig:y,order:O}},he=({loading:v,taxConfig:e,order:s=null,withHeader:O=!0,showConfigurableOptions:u,routeProductDetails:y})=>{const f=!!(s!=null&&s.returnNumber),i=s==null?void 0:s.returnNumber,o=re({cancelled:"Order.OrderProductListContent.cancelledTitle",allOrders:"Order.OrderProductListContent.allOrdersTitle",returned:"Order.OrderProductListContent.returnedTitle",refunded:"Order.OrderProductListContent.refundedTitle",sender:"Order.OrderProductListContent.GiftCard.sender",recipient:"Order.OrderProductListContent.GiftCard.recipient",message:"Order.OrderProductListContent.GiftCard.message",outOfStock:"Order.OrderProductListContent.stockStatus.outOfStock",downloadableCount:"Order.OrderProductListContent.downloadableCount"}),h=p(()=>{if(!s)return[];if(!f){const d=(s==null?void 0:s.items)??[],t=d.filter(a=>a.quantityReturned),n=d.filter(a=>a.quantityCanceled),l=d.filter(a=>!a.quantityCanceled);return[{type:"returned",list:t,title:o.returned},{type:"cancelled",list:n,title:o.cancelled},{type:"allItems",list:l,title:o.allOrders}].filter(a=>a.list.length>0)}const m=s.returns.find(d=>d.returnNumber===i);return[{type:"returned",list:(m==null?void 0:m.items)??[],title:o.returned}]},[s,f,o,i]);return s?h.every(m=>m.list.length===0)?null:r(Y,{variant:"secondary",className:"order-order-product-list-content",children:h.map((m,k)=>{var d;return E(se,{children:[O?r(g,{title:`${m.title} (${m.list.length})`}):null,r("ul",{className:"order-order-product-list-content__items",children:(d=m.list)==null?void 0:d.map(t=>r("li",{"data-testid":"order-product-list-content-item",children:r(ue,{loading:v,product:t,itemType:m.type,taxConfig:e,translations:o,showConfigurableOptions:u,routeProductDetails:y})},t.id))})]},k)})}):r(ae,{})},ue=({loading:v,product:e,itemType:s,taxConfig:O,translations:u,showConfigurableOptions:y,routeProductDetails:f})=>{var x,q,H,V,$,M,P,Q,F,G,R,Z,j,z,W,B,K;const{taxExcluded:i,taxIncluded:o}=O,h=ee((c,U,X)=>r(D,{amount:c,currency:U,weight:"normal",...X}),[]);let m={};const k=s==="cancelled",d=(q=(x=e==null?void 0:e.product)==null?void 0:x.stockStatus)==null?void 0:q.includes("IN_STOCK"),t=(e==null?void 0:e.giftCard)||{},n=(H=e==null?void 0:e.itemPrices)==null?void 0:H.priceIncludingTax,l=(V=e==null?void 0:e.itemPrices)==null?void 0:V.originalPrice,a=($=e==null?void 0:e.itemPrices)==null?void 0:$.price,b=s==="returned"?e==null?void 0:e.requestQuantity:e==null?void 0:e.totalQuantity,L=e.discounted&&((M=e.price)==null?void 0:M.value)!==(l==null?void 0:l.value)*b,_={..."configurableOptions"in e?e.configurableOptions:{},..."bundleOptions"in e?e.bundleOptions:{},..."senderName"in t&&(t!=null&&t.senderName)?{[u.sender]:t==null?void 0:t.senderName}:{},..."senderEmail"in t&&(t!=null&&t.senderEmail)?{[u.sender]:t==null?void 0:t.senderEmail}:{},..."recipientName"in t&&(t!=null&&t.recipientName)?{[u.recipient]:t==null?void 0:t.recipientName}:{},..."recipientEmail"in t&&(t!=null&&t.recipientEmail)?{[u.recipient]:t==null?void 0:t.recipientEmail}:{},..."message"in t&&(t!=null&&t.message)?{[u.message]:t==null?void 0:t.message}:{},..."downloadableLinks"in e&&(e!=null&&e.downloadableLinks)?{[`${(P=e==null?void 0:e.downloadableLinks)==null?void 0:P.count} ${u.downloadableCount}`]:(Q=e==null?void 0:e.downloadableLinks)==null?void 0:Q.result}:{}};if(o&&i){const c=L?l==null?void 0:l.value:(n==null?void 0:n.value)*b;m={taxExcluded:!0,taxIncluded:void 0,price:h(l==null?void 0:l.value,l==null?void 0:l.currency),total:E(w,{children:[h(c,l==null?void 0:l.currency,{variant:e.discounted&&(n==null?void 0:n.value)!==c?"strikethrough":"default"}),e.discounted&&(n==null?void 0:n.value)!==c?h(n==null?void 0:n.value,n==null?void 0:n.currency,{sale:!0,weight:"bold"}):null]}),totalExcludingTax:h((a==null?void 0:a.value)*b,a==null?void 0:a.currency)}}else if(!o&&i)m={taxExcluded:void 0,taxIncluded:void 0,price:h(l==null?void 0:l.value,l==null?void 0:l.currency),total:E(w,{children:[h((l==null?void 0:l.value)*b,n==null?void 0:n.currency,{variant:L?"strikethrough":"default"}),L?h((F=e.price)==null?void 0:F.value,(G=e.price)==null?void 0:G.currency,{sale:!0,weight:"bold"}):null]}),totalExcludingTax:h((a==null?void 0:a.value)*(e==null?void 0:e.totalQuantity),a==null?void 0:a.currency)};else if(o&&!i){const c=L?l.value:n.value*b;m={taxExcluded:void 0,taxIncluded:!0,price:h(n==null?void 0:n.value,n==null?void 0:n.currency),total:E(w,{children:[h(c,n==null?void 0:n.currency,{variant:L?"strikethrough":"default",weight:"bold"}),L?h(n==null?void 0:n.value,n==null?void 0:n.currency,{sale:!0,weight:"bold"}):null]})}}return r(I,{loading:v,alert:k&&d?E("span",{children:[r(T,{source:ie}),u.outOfStock]}):r(w,{}),configurations:(y==null?void 0:y(_))??_,title:f?r("a",{"data-testid":"product-name",className:S(["cart-summary-item__title",["cart-summary-item__title--strikethrough",k]]),href:f(e),children:(R=e==null?void 0:e.product)==null?void 0:R.name}):r("div",{"data-testid":"product-name",className:S(["cart-summary-item__title",["cart-summary-item__title--strikethrough",k]]),children:(Z=e==null?void 0:e.product)==null?void 0:Z.name}),sku:r("div",{children:(j=e==null?void 0:e.product)==null?void 0:j.sku}),quantity:b,image:f?r("a",{href:f(e),children:r(A,{src:(z=e==null?void 0:e.product)==null?void 0:z.thumbnail.url,alt:(W=e==null?void 0:e.product)==null?void 0:W.thumbnail.label,loading:"lazy",width:"90",height:"120"})}):r(A,{src:(B=e==null?void 0:e.product)==null?void 0:B.thumbnail.url,alt:(K=e==null?void 0:e.product)==null?void 0:K.thumbnail.label,loading:"lazy",width:"90",height:"120"}),...m})},Ce=({className:v,orderData:e,withHeader:s,showConfigurableOptions:O,routeProductDetails:u})=>{const{loading:y,taxConfig:f,order:i}=me({orderData:e});return r("div",{className:S(["order-order-product-list",v]),children:r(he,{loading:y,taxConfig:f,order:i,withHeader:s,showConfigurableOptions:O,routeProductDetails:u})})};export{Ce as OrderProductList,Ce as default};
