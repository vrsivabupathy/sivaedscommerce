/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as o,Fragment as S}from"@dropins/tools/preact-jsx-runtime.js";import{classes as A,Slot as Z}from"@dropins/tools/lib.js";import{useMemo as V,useCallback as j,useState as b,useEffect as H}from"@dropins/tools/preact-hooks.js";import{events as $}from"@dropins/tools/event-bus.js";import{c as z}from"../chunks/convertCase.js";import{g as B}from"../chunks/getAttributesForm.js";import{Card as q,Header as F,Price as K,Icon as G}from"@dropins/tools/components.js";import"../chunks/OrderCancelReasonsForm.js";import{u as J}from"../chunks/ReturnOrder.js";import*as d from"@dropins/tools/preact-compat.js";import{f as Q}from"../chunks/returnOrdersHelper.js";import{f as U}from"../chunks/formatDateToLocale.js";import{D as X}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact.js";import{Text as v,useText as Y}from"@dropins/tools/i18n.js";import"../chunks/network-error.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";const ee=a=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a},d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.93 14.8V18.75H5.97C4.75 18.75 3.75 17.97 3.75 17V6.5M3.75 6.5C3.75 5.53 4.74 4.75 5.97 4.75H15.94V8.25H5.97C4.75 8.25 3.75 7.47 3.75 6.5Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.35 11.64H14.04V14.81H19.35V11.64Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.9304 11.64V8.25H15.1504",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),te=a=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a},d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.00718 5H22.1507C22.7047 5 23.1579 5.45323 23.1579 6.00718V7.51794C23.1579 7.51794 1.01007 7.58844 1 7.55823V6.00718C1 5.45323 1.45323 5 2.00718 5Z",stroke:"currentColor",strokeWidth:1}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M23.1579 9.78409V18.3451C23.1579 18.899 22.7047 19.3523 22.1507 19.3523H2.00718C1.45323 19.3523 1 18.899 1 18.3451V9.78409H23.1579Z",stroke:"currentColor",strokeWidth:1}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3.01465 15.9682H8.40305",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.6192 17.5897C18.4535 17.5897 19.1299 16.9133 19.1299 16.0789C19.1299 15.2446 18.4535 14.5682 17.6192 14.5682C16.7848 14.5682 16.1084 15.2446 16.1084 16.0789C16.1084 16.9133 16.7848 17.5897 17.6192 17.5897Z",stroke:"currentColor",strokeWidth:1}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.8848 17.5897C20.7192 17.5897 21.3956 16.9133 21.3956 16.0789C21.3956 15.2446 20.7192 14.5682 19.8848 14.5682C19.0504 14.5682 18.374 15.2446 18.374 16.0789C18.374 16.9133 19.0504 17.5897 19.8848 17.5897Z",stroke:"currentColor",strokeWidth:1})),re=({loading:a,order:r,withHeader:g=!0,title:l,paymentIconsMap:p={},normalizeAddress:u,returnNumber:h,translations:e,slots:c})=>{var D,M,E,T,L,w;const i=(D=r==null?void 0:r.returns)==null?void 0:D[0],m=V(()=>({checkmo:ee,card:te,...p}),[p]),n=j(R=>{var x;return(x=u[R])==null?void 0:x.map((s,P)=>t("p",{children:s.label?`${s.label}: ${Array.isArray(s.value)?s.value.join(" "):s==null?void 0:s.value}`:Array.isArray(s.value)?s.value.join(" "):s==null?void 0:s.value},P))},[u]);if(!r||a)return t(X,{});const C=(r==null?void 0:r.email)??"",_=(M=r==null?void 0:r.shipping)==null?void 0:M.code,N=(E=r==null?void 0:r.shipping)==null?void 0:E.amount,W=(T=r==null?void 0:r.shipping)==null?void 0:T.currency,f=r==null?void 0:r.payments,k=f&&f.length>0,O=k?(L=f[0])==null?void 0:L.name:"",y=k?(w=f[0])==null?void 0:w.code:"",I=k&&O!=="";return o(q,{"data-testid":"order-details",variant:"secondary",className:A(["order-customer-details-content"]),children:[g?t(F,{title:l??(e==null?void 0:e.headerText)}):null,o("div",{className:"order-customer-details-content__container",children:[o("div",{className:"order-customer-details-content__container-email",children:[t("div",{className:"order-customer-details-content__container-title",children:e==null?void 0:e.emailTitle}),t("p",{children:C})]}),o("div",{className:"order-customer-details-content__container-shipping_address",children:[t("div",{className:"order-customer-details-content__container-title",children:e==null?void 0:e.shippingAddressTitle}),t("div",{className:"order-customer-details-content__container-description",children:n("shippingAddress")})]}),h?o("div",{className:"order-customer-details-content__container-return-information",children:[t("div",{className:"order-customer-details-content__container-title",children:e==null?void 0:e.returnInformationTitle}),t("div",{className:"order-customer-details-content__container-description",children:h&&(c!=null&&c.OrderReturnInformation)?t(Z,{"data-testid":"OrderReturnInformation",name:"OrderReturnInformation",slot:c==null?void 0:c.OrderReturnInformation,context:i}):o(S,{children:[o("p",{children:[t(v,{id:"Order.CustomerDetails.orderReturnLabels.createdReturnAt"}),t("span",{children:U(i==null?void 0:i.createdReturnAt)})]}),o("p",{children:[t(v,{id:"Order.CustomerDetails.orderReturnLabels.returnStatus"}),t(v,{id:`Order.CustomerDetails.resturnStatus.${Q(i==null?void 0:i.returnStatus)}`})]}),o("p",{children:[t(v,{id:"Order.CustomerDetails.orderReturnLabels.orderNumber"}),t("span",{children:i==null?void 0:i.orderNumber})]})]})})]}):o("div",{className:"order-customer-details-content__container-billing_address",children:[t("div",{className:"order-customer-details-content__container-title",children:e==null?void 0:e.billingAddressTitle}),t("div",{className:"order-customer-details-content__container-description",children:n("billingAddress")})]}),h?null:o("div",{className:"order-customer-details-content__container-shipping_methods",children:[t("div",{className:"order-customer-details-content__container-title",children:e==null?void 0:e.shippingMethodsTitle}),_?t(S,{children:N?o("p",{"data-testid":"shipping_methods_price",children:[t(K,{amount:N,currency:W})," ",_]}):t("p",{"data-testid":"shipping_methods_placeholder",children:e==null?void 0:e.freeShipping})}):null]}),h?null:o("div",{className:"order-customer-details-content__container-payment_methods",children:[t("div",{className:"order-customer-details-content__container-title",children:e==null?void 0:e.billingMethodsTitle}),I&&o("p",{"data-testid":"billing_methods_description",className:A([["order-customer-details-content__container-payment_methods--icon",!!m[y]]]),children:[t(G,{source:m[y]}),O]})]})]})]})},ie=["firstname","lastname","city","company","country_code","region","region_code","region_id","telephone","id","vat_id","postcode","street","street_2","default_shipping","default_billing"],ne=({orderData:a})=>{const[r,g]=b(!0),[l,p]=b(a),[u,h]=b([]);H(()=>{const i=$.on("order/data",m=>{p(m)},{eager:!0});return()=>{i==null||i.off()}},[]),H(()=>{B("shortRequest").then(i=>{if(i){const m=i.map(({name:n,orderNumber:C,label:_})=>({name:z(n),orderNumber:C,label:ie.includes(n)?null:_}));h(m)}}).finally(()=>{g(!1)})},[]);const e=j(i=>{if(!u.length||!l||!l[i])return[];const m=Object.fromEntries(Object.entries(l[i]).map(([n,C])=>[n.toLowerCase(),C]));return u.filter(({name:n})=>m[n.toLowerCase()]).map(n=>({name:n.name,orderNumber:n.orderNumber,value:m[n.name.toLowerCase()],label:n.label}))},[u,l]),c=V(()=>({billingAddress:e("billingAddress"),shippingAddress:e("shippingAddress")}),[e]);return{order:l,normalizeAddress:c,loading:r}},Ae=({paymentIconsMap:a,orderData:r,title:g,className:l,slots:p})=>{const u=Y({emailTitle:"Order.CustomerDetails.email.title",shippingAddressTitle:"Order.CustomerDetails.shippingAddress.title",shippingMethodsTitle:"Order.CustomerDetails.shippingMethods.title",billingAddressTitle:"Order.CustomerDetails.billingAddress.title",billingMethodsTitle:"Order.CustomerDetails.billingMethods.title",returnInformationTitle:"Order.CustomerDetails.returnInformation.title",headerText:"Order.CustomerDetails.headerText",freeShipping:"Order.CustomerDetails.freeShipping"}),h=J(),{order:e,normalizeAddress:c,loading:i}=ne({orderData:r});return t("div",{className:A(["order-customer-details",l]),children:t(re,{slots:p,loading:i,order:e,title:g,paymentIconsMap:a,normalizeAddress:c,returnNumber:h,translations:u})})};export{Ae as CustomerDetails,Ae as default};
