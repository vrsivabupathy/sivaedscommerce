/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsx as r,jsxs as i,Fragment as K}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as G,classes as g}from"@dropins/tools/lib.js";import{useState as y,useEffect as H,useCallback as V,useMemo as j}from"@dropins/tools/preact-hooks.js";import{events as J}from"@dropins/tools/event-bus.js";import{c as Q}from"../chunks/convertCase.js";import{g as U}from"../chunks/getAttributesForm.js";import{Icon as X,Price as Y,Card as ee,Header as te}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import*as a from"@dropins/tools/preact-compat.js";import{f as re}from"../chunks/returnOrdersHelper.js";import{f as ne}from"../chunks/formatDateToLocale.js";import{D as se}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact.js";import{Text as ie,useText as oe}from"@dropins/tools/i18n.js";import"../chunks/network-error.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";const ce=d=>a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...d},a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.93 14.8V18.75H5.97C4.75 18.75 3.75 17.97 3.75 17V6.5M3.75 6.5C3.75 5.53 4.74 4.75 5.97 4.75H15.94V8.25H5.97C4.75 8.25 3.75 7.47 3.75 6.5Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.35 11.64H14.04V14.81H19.35V11.64Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.9304 11.64V8.25H15.1504",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),ae=d=>a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...d},a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.00718 5H22.1507C22.7047 5 23.1579 5.45323 23.1579 6.00718V7.51794C23.1579 7.51794 1.01007 7.58844 1 7.55823V6.00718C1 5.45323 1.45323 5 2.00718 5Z",stroke:"currentColor",strokeWidth:1}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M23.1579 9.78409V18.3451C23.1579 18.899 22.7047 19.3523 22.1507 19.3523H2.00718C1.45323 19.3523 1 18.899 1 18.3451V9.78409H23.1579Z",stroke:"currentColor",strokeWidth:1}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3.01465 15.9682H8.40305",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.6192 17.5897C18.4535 17.5897 19.1299 16.9133 19.1299 16.0789C19.1299 15.2446 18.4535 14.5682 17.6192 14.5682C16.7848 14.5682 16.1084 15.2446 16.1084 16.0789C16.1084 16.9133 16.7848 17.5897 17.6192 17.5897Z",stroke:"currentColor",strokeWidth:1}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.8848 17.5897C20.7192 17.5897 21.3956 16.9133 21.3956 16.0789C21.3956 15.2446 20.7192 14.5682 19.8848 14.5682C19.0504 14.5682 18.374 15.2446 18.374 16.0789C18.374 16.9133 19.0504 17.5897 19.8848 17.5897Z",stroke:"currentColor",strokeWidth:1})),de=["firstname","lastname","city","company","country_code","region","region_code","region_id","telephone","id","vat_id","postcode","street","street_2","default_shipping","default_billing"],le=({orderData:d})=>{const[t,_]=y(!0),[l,p]=y(d),[u,e]=y([]);H(()=>{const n=J.on("order/data",m=>{p(m)},{eager:!0});return()=>{n==null||n.off()}},[]),H(()=>{U("shortRequest").then(n=>{if(n){const m=n.map(({name:s,orderNumber:C,label:f})=>({name:Q(s),orderNumber:C,label:de.includes(s)?null:f}));e(m)}}).finally(()=>{_(!1)})},[]);const o=V(n=>{if(!u.length||!l||!l[n])return[];const m=Object.fromEntries(Object.entries(l[n]).map(([s,C])=>[s.toLowerCase(),C]));return u.filter(({name:s})=>m[s.toLowerCase()]).map(s=>({name:s.name,orderNumber:s.orderNumber,value:m[s.name.toLowerCase()],label:s.label}))},[u,l]),h=j(()=>({billingAddress:o("billingAddress"),shippingAddress:o("shippingAddress")}),[o]);return{order:l,normalizeAddress:h,loading:t}},me=({loading:d,order:t,withHeader:_=!0,title:l,paymentIconsMap:p={},normalizeAddress:u,translations:e,slots:o})=>{var L,O,E,T,w,S;const h=!!(t!=null&&t.returnNumber),n=(L=t==null?void 0:t.returns)==null?void 0:L[0],m=j(()=>({checkmo:ce,card:ae,...p}),[p]),s=V(q=>{var x;return(x=u[q])==null?void 0:x.map((c,F)=>r("p",{children:c.label?`${c.label}: ${Array.isArray(c.value)?c.value.join(" "):c==null?void 0:c.value}`:Array.isArray(c.value)?c.value.join(" "):c==null?void 0:c.value},F))},[u]);if(!t||d)return r(se,{});const C=(t==null?void 0:t.email)??"",f=(O=t==null?void 0:t.shipping)==null?void 0:O.code,N=(E=t==null?void 0:t.shipping)==null?void 0:E.amount,R=(T=t==null?void 0:t.shipping)==null?void 0:T.currency,v=t==null?void 0:t.payments,k=v&&v.length>0,D=k?(w=v[0])==null?void 0:w.name:"",M=k?(S=v[0])==null?void 0:S.code:"",W=k&&D!=="",b=s("shippingAddress")??[],A=s("billingAddress")??[],I=i("div",{className:"order-customer-details-content__container-email",children:[r("div",{className:"order-customer-details-content__container-title",children:e==null?void 0:e.emailTitle}),r("p",{children:C})]}),P=h?i("div",{className:"order-customer-details-content__container-return-information",children:[r("div",{className:"order-customer-details-content__container-title",children:e==null?void 0:e.returnInformationTitle}),r("div",{className:"order-customer-details-content__container-description",children:o!=null&&o.OrderReturnInformation?r(G,{"data-testid":"OrderReturnInformation",name:"OrderReturnInformation",slot:o==null?void 0:o.OrderReturnInformation,context:n}):i(K,{children:[i("p",{children:[e.createdReturnAt,r("span",{children:ne(n==null?void 0:n.createdReturnAt)})]}),i("p",{children:[e.returnStatusLabel,r(ie,{id:`Order.CustomerDetails.returnStatus.${re(n==null?void 0:n.returnStatus)}`})]}),i("p",{children:[e.orderNumberLabel,r("span",{children:n==null?void 0:n.orderNumber})]})]})})]}):null,Z=b.length?i("div",{className:"order-customer-details-content__container-shipping_address",children:[r("div",{className:"order-customer-details-content__container-title",children:e.shippingAddressTitle}),r("div",{className:"order-customer-details-content__container-description",children:b})]}):null,$=A.length?i("div",{className:g(["order-customer-details-content__container-billing_address",["order-customer-details-content__container-billing_address--fullwidth",!b.length]]),children:[r("div",{className:"order-customer-details-content__container-title",children:e.billingAddressTitle}),r("div",{className:"order-customer-details-content__container-description",children:A})]}):null,z=W?i("div",{className:g(["order-customer-details-content__container-payment_methods",["order-customer-details-content__container-payment_methods--fullwidth",!f]]),children:[r("div",{className:"order-customer-details-content__container-title",children:e==null?void 0:e.paymentMethodsTitle}),i("p",{"data-testid":"payment_methods_description",className:g([["order-customer-details-content__container-payment_methods--icon",!!m[M]]]),children:[r(X,{source:m[M]}),D]})]}):null,B=f?i("div",{className:"order-customer-details-content__container-shipping_methods",children:[r("div",{className:"order-customer-details-content__container-title",children:e==null?void 0:e.shippingMethodsTitle}),N?i("p",{"data-testid":"shipping_methods_price",children:[r(Y,{amount:N,currency:R})," ",f]}):r("p",{"data-testid":"shipping_methods_placeholder",children:e==null?void 0:e.freeShipping})]}):null;return i(ee,{"data-testid":"order-details",variant:"secondary",className:g(["order-customer-details-content"]),children:[_?r(te,{title:l??(e==null?void 0:e.headerText)}):null,i("div",{className:g(["order-customer-details-content__container",["order-customer-details-content__container--no-margin",b.length||A.length]]),children:[I,Z,h?P:$,h?null:B,h?null:z]})]})},Oe=({paymentIconsMap:d,orderData:t,title:_,className:l,slots:p})=>{const u=oe({emailTitle:"Order.CustomerDetails.email.title",shippingAddressTitle:"Order.CustomerDetails.shippingAddress.title",shippingMethodsTitle:"Order.CustomerDetails.shippingMethods.title",billingAddressTitle:"Order.CustomerDetails.billingAddress.title",paymentMethodsTitle:"Order.CustomerDetails.paymentMethods.title",returnInformationTitle:"Order.CustomerDetails.returnInformation.title",headerText:"Order.CustomerDetails.headerText",freeShipping:"Order.CustomerDetails.freeShipping",createdReturnAt:"Order.CustomerDetails.orderReturnLabels.createdReturnAt",orderNumberLabel:"Order.CustomerDetails.orderReturnLabels.orderNumberLabel",returnStatusLabel:"Order.CustomerDetails.orderReturnLabels.returnStatusLabel"}),{order:e,normalizeAddress:o,loading:h}=le({orderData:t});return r("div",{className:g(["order-customer-details",l]),children:r(me,{slots:p,loading:h,order:e,title:_,paymentIconsMap:d,normalizeAddress:o,translations:u})})};export{Oe as CustomerDetails,Oe as default};
