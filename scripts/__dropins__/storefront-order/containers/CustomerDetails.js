import{jsx as t,jsxs as u,Fragment as P}from"@dropins/tools/preact-jsx-runtime.js";import{classes as b}from"@dropins/tools/lib.js";import{useMemo as V,useCallback as x,useState as k,useEffect as L}from"@dropins/tools/preact-hooks.js";import{events as Z}from"@dropins/tools/event-bus.js";import{c as R}from"../chunks/fetch-graphql.js";import{g as z}from"../chunks/getAttributesForm.js";import{Card as B,Header as F,Price as $,Icon as q}from"@dropins/tools/components.js";import"../chunks/CustomerDetailsContent.js";import*as m from"@dropins/tools/preact-compat.js";import{D as K}from"../chunks/OrderLoaders.js";import{useText as G}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/network-error.js";const I=o=>m.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},m.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.93 14.8V18.75H5.97C4.75 18.75 3.75 17.97 3.75 17V6.5M3.75 6.5C3.75 5.53 4.74 4.75 5.97 4.75H15.94V8.25H5.97C4.75 8.25 3.75 7.47 3.75 6.5Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),m.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.35 11.64H14.04V14.81H19.35V11.64Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),m.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.9304 11.64V8.25H15.1504",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),J=o=>m.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},m.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.00718 5H22.1507C22.7047 5 23.1579 5.45323 23.1579 6.00718V7.51794C23.1579 7.51794 1.01007 7.58844 1 7.55823V6.00718C1 5.45323 1.45323 5 2.00718 5Z",stroke:"currentColor",strokeWidth:1}),m.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M23.1579 9.78409V18.3451C23.1579 18.899 22.7047 19.3523 22.1507 19.3523H2.00718C1.45323 19.3523 1 18.899 1 18.3451V9.78409H23.1579Z",stroke:"currentColor",strokeWidth:1}),m.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3.01465 15.9682H8.40305",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round"}),m.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.6192 17.5897C18.4535 17.5897 19.1299 16.9133 19.1299 16.0789C19.1299 15.2446 18.4535 14.5682 17.6192 14.5682C16.7848 14.5682 16.1084 15.2446 16.1084 16.0789C16.1084 16.9133 16.7848 17.5897 17.6192 17.5897Z",stroke:"currentColor",strokeWidth:1}),m.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.8848 17.5897C20.7192 17.5897 21.3956 16.9133 21.3956 16.0789C21.3956 15.2446 20.7192 14.5682 19.8848 14.5682C19.0504 14.5682 18.374 15.2446 18.374 16.0789C18.374 16.9133 19.0504 17.5897 19.8848 17.5897Z",stroke:"currentColor",strokeWidth:1})),Q=({loading:o,order:e,withHeader:a=!0,title:c,paymentIconsMap:s={},normalizeAddress:r})=>{var N,M,E,T,D;const i=G({emailTitle:"Order.CustomerDetails.email.title",shippingAddressTitle:"Order.CustomerDetails.shippingAddress.title",shippingMethodsTitle:"Order.CustomerDetails.shippingMethods.title",billingAddressTitle:"Order.CustomerDetails.billingAddress.title",billingMethodsTitle:"Order.CustomerDetails.billingMethods.title",headerText:"Order.CustomerDetails.headerText",freeShipping:"Order.CustomerDetails.freeShipping"}),p=V(()=>({checkmo:I,card:J,...s}),[s]),_=x(j=>{var w;return(w=r[j])==null?void 0:w.map((f,S)=>t("div",{className:"order-customer-details-content__container-description--row",children:f==null?void 0:f.map((l,W)=>t("p",{children:l.label?`${l.label}: ${Array.isArray(l.value)?l.value.join(" "):l==null?void 0:l.value}`:Array.isArray(l.value)?l.value.join(" "):l==null?void 0:l.value},W))},S))},[r]);if(!e||o)return t(K,{});const d=(e==null?void 0:e.email)??"",h=(N=e==null?void 0:e.shipping)==null?void 0:N.code,n=(M=e==null?void 0:e.shipping)==null?void 0:M.amount,v=(E=e==null?void 0:e.shipping)==null?void 0:E.currency,g=e==null?void 0:e.payments,C=g&&g.length>0,A=C?(T=g[0])==null?void 0:T.name:"",y=C?(D=g[0])==null?void 0:D.code:"",H=C&&A!=="";return u(B,{"data-testid":"order-details",variant:"secondary",className:b(["order-customer-details-content"]),children:[a?t(F,{title:c??i.headerText}):null,u("div",{className:"order-customer-details-content__container",children:[u("div",{className:"order-customer-details-content__container-email",children:[t("div",{className:"order-customer-details-content__container-title",children:i.emailTitle}),t("p",{children:d})]}),u("div",{className:"order-customer-details-content__container-shipping_address",children:[t("div",{className:"order-customer-details-content__container-title",children:i.shippingAddressTitle}),t("div",{className:"order-customer-details-content__container-description",children:_("shippingAddress")})]}),u("div",{className:"order-customer-details-content__container-billing_address",children:[t("div",{className:"order-customer-details-content__container-title",children:i.billingAddressTitle}),t("div",{className:"order-customer-details-content__container-description",children:_("billingAddress")})]}),u("div",{className:"order-customer-details-content__container-shipping_methods",children:[t("div",{className:"order-customer-details-content__container-title",children:i.shippingMethodsTitle}),h?t(P,{children:n?u("p",{"data-testid":"shipping_methods_price",children:[t($,{amount:n,currency:v})," ",h]}):t("p",{"data-testid":"shipping_methods_placeholder",children:i.freeShipping})}):null]}),u("div",{className:"order-customer-details-content__container-billing_methods",children:[t("div",{className:"order-customer-details-content__container-title",children:i.billingMethodsTitle}),H&&u("p",{"data-testid":"billing_methods_description",className:b([["order-customer-details-content__container-billing_methods--icon",!!p[y]]]),children:[t(q,{source:p[y]}),A]})]})]})]})},U=["firstname","lastname","city","company","country_code","region","region_code","region_id","telephone","id","vat_id","postcode","street","street_2","default_shipping","default_billing"],O=o=>{o.sort((s,r)=>s.orderNumber-r.orderNumber);const e=[];let a=[];const c=s=>s.value!==void 0&&s.value!==null&&s.value!=="";for(let s=0;s<o.length;s++){const r=o[s];if(c(r))if(Array.isArray(r.value)){const i=r.value.map(p=>({...r,value:p}));e.push(i)}else e.length<4?(a.push(r),a.length===2&&(e.push(a),a=[])):e.push([r])}return a.length>0&&e.length<4&&e.push(a),e},X=({orderData:o})=>{const[e,a]=k(!0),[c,s]=k(o),[r,i]=k([]);L(()=>{const d=Z.on("order/data",h=>{s(h)},{eager:!0});return()=>{d==null||d.off()}},[]),L(()=>{z("shortRequest").then(d=>{if(d){const h=d.map(({name:n,orderNumber:v,label:g})=>({name:R(n),orderNumber:v,label:U.includes(n)?null:g}));i(h)}}).finally(()=>{a(!1)})},[]);const p=x(d=>{if(!r.length||!c||!c[d])return[];const h=Object.fromEntries(Object.entries(c[d]).map(([n,v])=>[n.toLowerCase(),v]));return r.filter(({name:n})=>h[n.toLowerCase()]).map(n=>({name:n.name,orderNumber:n.orderNumber,value:h[n.name.toLowerCase()],label:n.label}))},[r,c]),_=V(()=>({billingAddress:O(p("billingAddress")),shippingAddress:O(p("shippingAddress"))}),[p]);return{order:c,normalizeAddress:_,loading:e}},me=({paymentIconsMap:o,orderData:e,title:a,className:c})=>{const{order:s,normalizeAddress:r,loading:i}=X({orderData:e});return t("div",{className:b(["order-customer-details",c]),children:t(Q,{loading:i,order:s,title:a,paymentIconsMap:o,normalizeAddress:r})})};export{me as CustomerDetails,me as default};
