import{jsx as r,jsxs as v}from"@dropins/tools/preact-jsx-runtime.js";import{classes as A,Slot as q}from"@dropins/tools/lib.js";import{Checkbox as B,Button as M,CartItem as P,Image as H,Header as $,InLineAlert as W}from"@dropins/tools/components.js";import{u as j,a as V}from"../chunks/OrderCancel.js";import{useState as _,useRef as Z,useEffect as Q,useCallback as F}from"@dropins/tools/preact-hooks.js";import{events as z}from"@dropins/tools/event-bus.js";import{s as U}from"../chunks/setTaxStatus.js";import{createRef as G,Fragment as J}from"@dropins/tools/preact.js";import{s as K,p as X,r as Y,m as D}from"../chunks/returnOrdersHelper.js";import{g as I,r as ee}from"../chunks/requestReturn.js";import{g as te}from"../chunks/getStoreConfig.js";import*as R from"@dropins/tools/preact-compat.js";import{S as ne,C as re}from"../chunks/CartSummaryItem.js";import{O as se}from"../chunks/OrderLoaders.js";import{useText as ae}from"@dropins/tools/i18n.js";import"../chunks/getFormValues.js";import"../chunks/network-error.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/transform-attributes-form.js";import"../chunks/convertCase.js";const ie=s=>R.createElement("svg",{id:"Icon_Warning_Base",width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},R.createElement("g",{clipPath:"url(#clip0_841_1324)"},R.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.9949 2.30237L0.802734 21.6977H23.1977L11.9949 2.30237Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),R.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M12.4336 10.5504L12.3373 14.4766H11.6632L11.5669 10.5504V9.51273H12.4336V10.5504ZM11.5883 18.2636V17.2687H12.4229V18.2636H11.5883Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),R.createElement("defs",null,R.createElement("clipPath",{id:"clip0_841_1324"},R.createElement("rect",{width:24,height:21,fill:"white",transform:"translate(0 1.5)"})))),ce=s=>R.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},R.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),R.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),ue=({onSuccess:s,onError:a,handleSetInLineAlert:c,orderData:i})=>{const[m,l]=_({id:"",email:"",...i}),[L,k]=_("products"),[w,g]=_(!0),[d,f]=_([]),[C,y]=_([]),[t,b]=_({taxIncluded:!1,taxExcluded:!1}),[e,u]=_([]),h=Z([]);h.current.length!==d.length&&(h.current=d.map((n,o)=>h.current[o]||G())),Q(()=>{const n=z.on("order/data",o=>{l(o);const S=K(o);u(S),g(!1)},{eager:!0});return i!=null&&i.id&&g(!1),()=>{n==null||n.off()}},[i]),Q(()=>{te().then(n=>{if(!n)return;const o=U(n==null?void 0:n.shoppingCartDisplayPrice);b(o)})},[]),Q(()=>{I("RMA_ITEM").then(n=>{n!=null&&n.length&&(y(n),g(!1))})},[]);const E=F(n=>{f(o=>o.findIndex(p=>(p==null?void 0:p.productSku)===(n==null?void 0:n.productSku))>-1?o.filter(p=>(p==null?void 0:p.productSku)!==(n==null?void 0:n.productSku)):[...o,n])},[]),O=F(n=>{k(n),c(),n==="products"&&f([])},[c]),N=F((n,o)=>{const S=d.map(p=>p.productSku===o?{...p,currentReturnOrderQuantity:n}:p);f(S)},[d]),x=F(async(n,o)=>{if(!o)return;g(!0);const S={orderUid:m.id,contactEmail:m.email},p=X(h);ee({...S,items:p}).then(T=>{s==null||s(T),O("success"),c()}).catch(T=>{a==null||a(T.message),c({type:"error",heading:T.message})}),g(!1)},[O,a,s,c,m]);return{order:m,steps:L,loading:w,formsRef:h,taxConfig:t,attributesList:C,selectedProductList:d,itemsEligibleForReturn:e,handleSelectedProductList:E,handleSetQuantity:N,handleChangeStep:O,onSubmit:x}},oe={success:r(ce,{}),warning:r(ie,{}),error:r(ne,{})},le=()=>{const[s,a]=_({type:"success",heading:""}),c=F(i=>{if(!(i!=null&&i.type)){a({type:"success",heading:""});return}const m=oe[i.type];a({...i,icon:m})},[]);return{inLineAlertProps:s,handleSetInLineAlert:c}},de=({itemsEligibleForReturn:s,slots:a,loading:c,taxConfig:i,translations:m,selectedProductList:l,handleSelectedProductList:L,showConfigurableOptions:k,handleSetQuantity:w,handleChangeStep:g})=>v("ul",{className:"order-return-order-product-list",children:[s==null?void 0:s.map((d,f)=>{const{quantityReturnRequested:C,quantityShipped:y,eligibleForReturn:t}=d,b=l.some(h=>(h==null?void 0:h.productSku)===d.productSku&&d.eligibleForReturn),e=y===C&&t,u=y-C===0?C:y-C;return v("li",{className:A(["order-return-order-product-list__item",["order-return-order-product-list__item--blur",e]]),children:[r(B,{"data-testid":`key_${f}`,name:`key_${f}`,checked:b,disabled:e,onChange:()=>{L({...d,currentReturnOrderQuantity:1})}}),r(re,{loading:c,product:{...d,totalQuantity:u},itemType:"",taxConfig:i,translations:m,showConfigurableOptions:k,disabledIncrementer:!b,onQuantity:u>1?h=>{w(h,d.productSku)}:void 0}),r(q,{"data-testid":"returnOrderItem",name:"ReturnOrderItem",slot:a==null?void 0:a.ReturnOrderItem})]},f)}),r("li",{className:"order-return-order-product-list__item",children:r(M,{type:"button",onClick:()=>g("attributes"),disabled:!l.length,children:m.nextStep})})]}),pe=({routeReturnSuccess:s,translations:a,orderData:c})=>{const i=()=>{window.location.href=(s==null?void 0:s(c))??"#"};return v("div",{className:"order-return-order-message",children:[r("p",{className:"order-return-order-message__title",children:a.successTitle}),r("p",{className:"order-return-order-message__subtitle",children:a.successMessage}),r(M,{onClick:i,type:"button",children:a.backStore})]})},he=({slots:s,formsRef:a,selectedProductList:c,loading:i,fieldsConfig:m,translations:l,handleChangeStep:L,onSubmit:k})=>{const{formData:w,errors:g,formRef:d,handleChange:f,handleBlur:C,handleSubmit:y}=j({fieldsConfig:Y(m,c==null?void 0:c.length),onSubmit:k});return v("form",{className:"order-return-reason-form",ref:d,onSubmit:y,name:"returnReasonForm",children:[c.map((t,b)=>{var x,n,o,S,p;const e=(t==null?void 0:t.giftCard)||{},u=t==null?void 0:t.product,h=D(m,b),E=`${t==null?void 0:t.id}_${b}`,O=(t==null?void 0:t.currentReturnOrderQuantity)??1,N={...t!=null&&t.currentReturnOrderQuantity?{[l.configurationsListQuantity]:O}:{},..."configurableOptions"in t?t.configurableOptions:{},..."bundleOptions"in t?t.bundleOptions:{},..."senderName"in e?{[l.sender]:e==null?void 0:e.senderName}:{},..."senderEmail"in e&&(e!=null&&e.senderEmail)?{[l.sender]:e==null?void 0:e.senderEmail}:{},..."recipientName"in e&&(e!=null&&e.recipientName)?{[l.recipient]:e==null?void 0:e.recipientName}:{},..."recipientEmail"in e&&(e!=null&&e.recipientEmail)?{[l.recipient]:e==null?void 0:e.recipientEmail}:{},..."message"in e&&(e!=null&&e.message)?{[l.message]:e==null?void 0:e.message}:{},..."downloadableLinks"in t&&(t!=null&&t.downloadableLinks)?{[`${(x=t==null?void 0:t.downloadableLinks)==null?void 0:x.count} ${l.downloadableCount}`]:(n=t==null?void 0:t.downloadableLinks)==null?void 0:n.result}:{}};return v(J,{children:[r(P,{loading:i,title:r("div",{"data-testid":"product-name",children:(o=t==null?void 0:t.product)==null?void 0:o.name}),sku:r("div",{children:u==null?void 0:u.sku}),image:r(H,{src:((S=u==null?void 0:u.thumbnail)==null?void 0:S.url)??"",alt:((p=u==null?void 0:u.thumbnail)==null?void 0:p.label)??"",loading:"lazy",width:"90",height:"120"}),configurations:N}),r("form",{name:E,ref:a==null?void 0:a.current[b],"data-quantity":O,children:r(V,{className:"className",loading:i,fields:h,onChange:f,onBlur:C,errors:g,values:w})})]},b)}),r(q,{"data-testid":"returnFormActions",name:"ReturnFormActions",slot:s==null?void 0:s.ReturnFormActions,context:{handleChangeStep:L},children:v("div",{className:"order-return-reason-form__actions",children:[r(M,{variant:"secondary",type:"button",onClick:()=>{L("products")},children:l.backStep}),r(M,{children:l.submit})]})})]})},Qe=({className:s,orderData:a,slots:c,onSuccess:i,onError:m,routeReturnSuccess:l,showConfigurableOptions:L})=>{const k=ae({headerText:"Order.CreateReturn.headerText",successTitle:"Order.CreateReturn.success.title",successMessage:"Order.CreateReturn.success.message",sender:"Order.CreateReturn.giftCard.sender",recipient:"Order.CreateReturn.giftCard.recipient",message:"Order.CreateReturn.giftCard.message",outOfStock:"Order.CreateReturn.stockStatus.outOfStock",nextStep:"Order.CreateReturn.buttons.nextStep",backStep:"Order.CreateReturn.buttons.backStep",submit:"Order.CreateReturn.buttons.submit",backStore:"Order.CreateReturn.buttons.backStore",downloadableCount:"Order.CreateReturn.downloadableCount",returnedItems:"Order.CreateReturn.returnedItems",configurationsListQuantity:"Order.CreateReturn.configurationsList.quantity"}),{inLineAlertProps:w,handleSetInLineAlert:g}=le(),{order:d,itemsEligibleForReturn:f,formsRef:C,taxConfig:y,attributesList:t,steps:b,loading:e,selectedProductList:u,handleSelectedProductList:h,handleSetQuantity:E,handleChangeStep:O,onSubmit:N}=ue({orderData:a,onSuccess:i,onError:m,handleSetInLineAlert:g});if(e)return r("div",{children:r(se,{})});if(!e&&!t.length)return r("div",{});const x={products:r(de,{itemsEligibleForReturn:f,slots:c,translations:k,loading:e,taxConfig:y,selectedProductList:u,handleSelectedProductList:h,showConfigurableOptions:L,handleSetQuantity:E,handleChangeStep:O}),attributes:r(he,{slots:c,formsRef:C,loading:e,fieldsConfig:t,selectedProductList:u,handleChangeStep:O,translations:k,onSubmit:N}),success:r(pe,{translations:k,routeReturnSuccess:l,orderData:d}),error:null};return v("div",{className:A(["order-create-return",s]),children:[r($,{title:k.headerText}),w.heading?r(W,{className:"order-create-return_notification",variant:"secondary","data-testid":"orderCreateReturnNotification",...w}):null,x[b]]})};export{Qe as CreateReturn,Qe as default};
