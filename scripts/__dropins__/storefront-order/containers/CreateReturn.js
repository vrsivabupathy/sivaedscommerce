import{jsxs as w,jsx as n}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as H,classes as j}from"@dropins/tools/lib.js";import{Checkbox as K,Button as N,CartItem as Y,Image as A,Header as Q,InLineAlert as z}from"@dropins/tools/components.js";import{u as X,a as W}from"../chunks/ReturnReasonForm.js";import*as y from"@dropins/tools/preact-compat.js";import{useState as f,useCallback as T,useRef as V,useEffect as L}from"@dropins/tools/preact-hooks.js";import{Fragment as Z,createRef as G}from"@dropins/tools/preact.js";import{events as J}from"@dropins/tools/event-bus.js";import{C as ee,S as te}from"../chunks/CartSummaryItem.js";import{g as re}from"../chunks/getFormValues.js";import{s as ae}from"../chunks/setTaxStatus.js";import{g as ne}from"../chunks/getAttributesList.js";import{g as ie}from"../chunks/getStoreConfig.js";import{useText as ce}from"@dropins/tools/i18n.js";import"../chunks/network-error.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/transform-attributes-form.js";import"../chunks/convertCase.js";const ue=t=>y.createElement("svg",{id:"Icon_Warning_Base",width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},y.createElement("g",{clipPath:"url(#clip0_841_1324)"},y.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.9949 2.30237L0.802734 21.6977H23.1977L11.9949 2.30237Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),y.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M12.4336 10.5504L12.3373 14.4766H11.6632L11.5669 10.5504V9.51273H12.4336V10.5504ZM11.5883 18.2636V17.2687H12.4229V18.2636H11.5883Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),y.createElement("defs",null,y.createElement("clipPath",{id:"clip0_841_1324"},y.createElement("rect",{width:24,height:21,fill:"white",transform:"translate(0 1.5)"})))),le=t=>y.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},y.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),y.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),oe=[{type:"OrderItem",eligibleForReturn:!0,productName:"Crown Summit Backpack",quantityCanceled:0,quantityInvoiced:0,quantityOrdered:7,quantityRefunded:0,quantityReturned:0,quantityShipped:0,id:"NDEzNg==",discounted:!1,total:{value:266,currency:"USD"},totalInclTax:{value:266,currency:"USD"},price:{value:38,currency:"USD"},priceInclTax:{value:38,currency:"USD"},totalQuantity:7,regularPrice:{value:38,currency:"USD"},product:{__typename:"SimpleProduct",canonicalUrl:"",uid:"Nw==",name:"Crown Summit Backpack",sku:"24-MB03",onlyXLeftInStock:null,stockStatus:"IN_STOCK",thumbnail:{label:"Image",url:"https://mcstaging.aemshop.net/media/catalog/product/m/b/mb03-black-0.jpg?quality=80&bg-color=255,255,255&fit=bounds&height=&width="},priceRange:{maximumPrice:{regularPrice:{currency:"USD",value:38}}},id:"Nw==",image:"",productType:"SimpleProduct"},thumbnail:{label:"Image",url:"https://mcstaging.aemshop.net/media/catalog/product/m/b/mb03-black-0.jpg?quality=80&bg-color=255,255,255&fit=bounds&height=&width="},configurableOptions:{},bundleOptions:null,itemPrices:{priceIncludingTax:{value:41.14,currency:"USD"},originalPrice:{value:38,currency:"USD"},originalPriceIncludingTax:{value:41.135,currency:"USD"},price:{value:38,currency:"USD"}},downloadableLinks:null},{type:"OrderItem",eligibleForReturn:!0,productName:"Hollister Backyard Sweatshirt",quantityCanceled:0,quantityInvoiced:0,quantityOrdered:1,quantityRefunded:0,quantityReturned:0,quantityShipped:0,id:"NDEzOQ==",discounted:!1,total:{value:52,currency:"USD"},totalInclTax:{value:52,currency:"USD"},price:{value:52,currency:"USD"},priceInclTax:{value:52,currency:"USD"},totalQuantity:1,regularPrice:{value:52,currency:"USD"},product:{__typename:"ConfigurableProduct",canonicalUrl:"",uid:"Mzk0",name:"Hollister Backyard Sweatshirt",sku:"MH05",onlyXLeftInStock:null,stockStatus:"IN_STOCK",thumbnail:{label:"Hollister Backyard Sweatshirt",url:"https://mcstaging.aemshop.net/media/catalog/product/m/h/mh05-white_main_1.jpg?quality=80&bg-color=255,255,255&fit=bounds&height=&width="},priceRange:{maximumPrice:{regularPrice:{currency:"USD",value:52}}},id:"Mzk0",image:"",productType:"ConfigurableProduct"},thumbnail:{label:"Hollister Backyard Sweatshirt",url:"https://mcstaging.aemshop.net/media/catalog/product/m/h/mh05-white_main_1.jpg?quality=80&bg-color=255,255,255&fit=bounds&height=&width="},configurableOptions:{Color:"Red",Size:"XS"},bundleOptions:null,itemPrices:{priceIncludingTax:{value:56.29,currency:"USD"},originalPrice:{value:52,currency:"USD"},originalPriceIncludingTax:{value:56.29,currency:"USD"},price:{value:52,currency:"USD"}},downloadableLinks:null},{type:"BundleOrderItem",eligibleForReturn:!0,productName:"Sprite Yoga Companion Kit",quantityCanceled:0,quantityInvoiced:0,quantityOrdered:1,quantityRefunded:0,quantityReturned:0,quantityShipped:0,id:"NDE0NQ==",discounted:!0,total:{value:61,currency:"USD"},totalInclTax:{value:61,currency:"USD"},price:{value:61,currency:"USD"},priceInclTax:{value:61,currency:"USD"},totalQuantity:1,regularPrice:{value:77,currency:"USD"},product:{__typename:"BundleProduct",canonicalUrl:"",uid:"MTU0",name:"Sprite Yoga Companion Kit",sku:"24-WG080",onlyXLeftInStock:null,stockStatus:"IN_STOCK",thumbnail:{label:"Sprite Yoga Companion Kit",url:"https://mcstaging.aemshop.net/media/catalog/product/l/u/luma-yoga-kit-2.jpg?quality=80&bg-color=255,255,255&fit=bounds&height=&width="},priceRange:{maximumPrice:{regularPrice:{currency:"USD",value:77}}},id:"MTU0",image:"",productType:"BundleProduct"},thumbnail:{label:"Sprite Yoga Companion Kit",url:"https://mcstaging.aemshop.net/media/catalog/product/l/u/luma-yoga-kit-2.jpg?quality=80&bg-color=255,255,255&fit=bounds&height=&width="},configurableOptions:{},bundleOptions:{"Sprite Stasis Ball":"Sprite Stasis Ball 55 cm","Sprite Foam Yoga Brick":"Sprite Foam Yoga Brick","Sprite Yoga Strap":"Sprite Yoga Strap 6 foot","Sprite Foam Roller":"Sprite Foam Roller"},itemPrices:{priceIncludingTax:{value:64.87,currency:"USD"},originalPrice:{value:61,currency:"USD"},originalPriceIncludingTax:{value:61,currency:"USD"},price:{value:61,currency:"USD"}},downloadableLinks:null},{type:"OrderItem",eligibleForReturn:!0,productName:"Hollister Backyard Sweatshirt",quantityCanceled:0,quantityInvoiced:0,quantityOrdered:4,quantityRefunded:0,quantityReturned:0,quantityShipped:0,id:"NDE2MA==",discounted:!1,total:{value:208,currency:"USD"},totalInclTax:{value:208,currency:"USD"},price:{value:52,currency:"USD"},priceInclTax:{value:52,currency:"USD"},totalQuantity:4,regularPrice:{value:52,currency:"USD"},product:{__typename:"ConfigurableProduct",canonicalUrl:"",uid:"Mzk0",name:"Hollister Backyard Sweatshirt",sku:"MH05",onlyXLeftInStock:null,stockStatus:"IN_STOCK",thumbnail:{label:"Hollister Backyard Sweatshirt",url:"https://mcstaging.aemshop.net/media/catalog/product/m/h/mh05-white_main_1.jpg?quality=80&bg-color=255,255,255&fit=bounds&height=&width="},priceRange:{maximumPrice:{regularPrice:{currency:"USD",value:52}}},id:"Mzk0",image:"",productType:"ConfigurableProduct"},thumbnail:{label:"Hollister Backyard Sweatshirt",url:"https://mcstaging.aemshop.net/media/catalog/product/m/h/mh05-white_main_1.jpg?quality=80&bg-color=255,255,255&fit=bounds&height=&width="},configurableOptions:{Size:"XS",Color:"Green"},bundleOptions:null,itemPrices:{priceIncludingTax:{value:56.29,currency:"USD"},originalPrice:{value:52,currency:"USD"},originalPriceIncludingTax:{value:56.29,currency:"USD"},price:{value:52,currency:"USD"}},downloadableLinks:null},{type:"OrderItem",eligibleForReturn:!0,productName:"Hollister Backyard Sweatshirt",quantityCanceled:0,quantityInvoiced:0,quantityOrdered:4,quantityRefunded:0,quantityReturned:0,quantityShipped:0,id:"NDE2Ng==",discounted:!1,total:{value:208,currency:"USD"},totalInclTax:{value:208,currency:"USD"},price:{value:52,currency:"USD"},priceInclTax:{value:52,currency:"USD"},totalQuantity:4,regularPrice:{value:52,currency:"USD"},product:{__typename:"ConfigurableProduct",canonicalUrl:"",uid:"Mzk0",name:"Hollister Backyard Sweatshirt",sku:"MH05",onlyXLeftInStock:null,stockStatus:"IN_STOCK",thumbnail:{label:"Hollister Backyard Sweatshirt",url:"https://mcstaging.aemshop.net/media/catalog/product/m/h/mh05-white_main_1.jpg?quality=80&bg-color=255,255,255&fit=bounds&height=&width="},priceRange:{maximumPrice:{regularPrice:{currency:"USD",value:52}}},id:"Mzk0",image:"",productType:"ConfigurableProduct"},thumbnail:{label:"Hollister Backyard Sweatshirt",url:"https://mcstaging.aemshop.net/media/catalog/product/m/h/mh05-white_main_1.jpg?quality=80&bg-color=255,255,255&fit=bounds&height=&width="},configurableOptions:{Size:"XL",Color:"Red"},bundleOptions:null,itemPrices:{priceIncludingTax:{value:56.29,currency:"USD"},originalPrice:{value:52,currency:"USD"},originalPriceIncludingTax:{value:56.29,currency:"USD"},price:{value:52,currency:"USD"}},downloadableLinks:null},{type:"BundleOrderItem",eligibleForReturn:!0,productName:"Sprite Yoga Companion Kit",quantityCanceled:0,quantityInvoiced:0,quantityOrdered:1,quantityRefunded:0,quantityReturned:0,quantityShipped:0,id:"NDE3Mg==",discounted:!1,total:{value:77,currency:"USD"},totalInclTax:{value:77,currency:"USD"},price:{value:77,currency:"USD"},priceInclTax:{value:77,currency:"USD"},totalQuantity:1,regularPrice:{value:77,currency:"USD"},product:{__typename:"BundleProduct",canonicalUrl:"",uid:"MTU0",name:"Sprite Yoga Companion Kit",sku:"24-WG080",onlyXLeftInStock:null,stockStatus:"IN_STOCK",thumbnail:{label:"Sprite Yoga Companion Kit",url:"https://mcstaging.aemshop.net/media/catalog/product/l/u/luma-yoga-kit-2.jpg?quality=80&bg-color=255,255,255&fit=bounds&height=&width="},priceRange:{maximumPrice:{regularPrice:{currency:"USD",value:77}}},id:"MTU0",image:"",productType:"BundleProduct"},thumbnail:{label:"Sprite Yoga Companion Kit",url:"https://mcstaging.aemshop.net/media/catalog/product/l/u/luma-yoga-kit-2.jpg?quality=80&bg-color=255,255,255&fit=bounds&height=&width="},configurableOptions:{},bundleOptions:{"Sprite Foam Yoga Brick":"Sprite Foam Yoga Brick","Sprite Foam Roller":"Sprite Foam Roller","Sprite Stasis Ball":"Sprite Stasis Ball 75 cm","Sprite Yoga Strap":"Sprite Yoga Strap 10 foot"},itemPrices:{priceIncludingTax:{value:83.36,currency:"USD"},originalPrice:{value:77,currency:"USD"},originalPriceIncludingTax:{value:77,currency:"USD"},price:{value:77,currency:"USD"}},downloadableLinks:null}],se=({quantity:t,slots:e,loading:r=!1,taxConfig:c,translations:u={},selectedProductList:g,handleSelectedProductList:v,showConfigurableOptions:h,handleSetQuantity:k,moveToAttributesStep:U})=>(console.log("quantity",t),w("ul",{className:"order-return-order-product-list",children:[oe.map((s,D)=>{const S=`${D+1}_${s.id}`,C=g.some(o=>{var l;return((l=o==null?void 0:o.product)==null?void 0:l.uid)===s.product.uid&&s.eligibleForReturn&&s.quantityReturned===0}),i=s.totalQuantity>1?k:void 0;return w("li",{"data-testid":S,className:"order-return-order-product-list__item",children:[n(K,{name:S,checked:C,disabled:!s.eligibleForReturn&&s.quantityReturned!==0,onChange:()=>{v({...s,currentReturnOrderQuantity:t,checked:!0})}}),n(ee,{loading:r,product:s,itemType:"",taxConfig:c,translations:u,showConfigurableOptions:h,onQuantity:i}),e!=null&&e.ReturnOrderItem?n(H,{"data-testid":"returnOrderItem",name:"ReturnOrderItem",slot:e==null?void 0:e.ReturnOrderItem,context:{}}):null]},S)}),n("li",{className:"order-return-order-product-list__item",children:n(N,{type:"button",onClick:U,disabled:!g.length,children:u.nextStep})})]})),de=({routeReturnSuccess:t,translations:e})=>{const r=()=>{window.location.href=(t==null?void 0:t())??""};return w("div",{className:"order-return-order-message",children:[n("p",{className:"order-return-order-message__title",children:e.successTitle}),n("p",{className:"order-return-order-message__subtitle",children:e.successMessage}),n(N,{onClick:r,type:"button",children:e.backStore})]})},pe=t=>{const e={};return console.log("obj",t),Object.keys(t).forEach(r=>{if(r.match(/_(\d+)$/)){const u=r.replace(/_\d+$/,"");e[u]=t[r]}else e[r]=t[r]}),e},ge=(t,e)=>{const r=[];return t.forEach(c=>{for(let u=1;u<=e;u++){const g={...c,id:`${c.id}_${u}`,name:`${c.name}_${u}`,code:`${c.code}_${u}`,customUpperCode:`${c.customUpperCode}_${u}`};r.push(g)}}),console.log("clonedObjects",r),r},me=t=>Object.entries(t).map(([e,r])=>({attribute_code:e,value:r})),he=({slots:t,formsRef:e,selectedProductList:r,loading:c,fieldsConfig:u,translations:g,handleChangeStep:v,onSubmit:h})=>{const{formData:k,errors:U,formRef:s,handleChange:D,handleBlur:S,handleSubmit:C}=X({fieldsConfig:ge(u,r==null?void 0:r.length),onSubmit:h});return w("form",{className:"order-return-reason-form",ref:s,onSubmit:C,name:"returnReasonForm",children:[r.map((i,o)=>{var O,m,P;const l=i==null?void 0:i.product,q=u.map(d=>({...d,id:`${d.id}_${o+1}_${d.fieldType}`,name:`${d.name}_${o+1}`,code:`${d.code}_${o+1}`,customUpperCode:`${d.customUpperCode}_${o+1}`})),x=`${i==null?void 0:i.id}_${o}`;return w(Z,{children:[n(Y,{loading:c,title:n("div",{"data-testid":"product-name",children:(O=i==null?void 0:i.product)==null?void 0:O.name}),sku:n("div",{children:l==null?void 0:l.sku}),quantity:i==null?void 0:i.currentReturnOrderQuantity,image:n(A,{src:((m=l==null?void 0:l.thumbnail)==null?void 0:m.url)??"",alt:((P=l==null?void 0:l.thumbnail)==null?void 0:P.label)??"",loading:"lazy",width:"90",height:"120"})}),n("form",{name:x,ref:e==null?void 0:e.current[o],children:n(W,{className:"className",loading:c,fields:q,onChange:D,onBlur:S,errors:U,values:k})})]},o)}),w("div",{className:"order-return-reason-form__actions",children:[n(N,{variant:"secondary",type:"button",onClick:()=>{v("products")},children:g.backStep}),n(N,{children:g.submit})]})]})},ye={success:n(le,{}),warning:n(ue,{}),error:n(te,{})},Se=()=>{const[t,e]=f({type:"success",heading:""}),r=T(c=>{if(!(c!=null&&c.type)){e({type:"success",heading:""});return}const u=ye[c.type];e({...c,icon:u})},[]);return{inLineAlertProps:t,handleSetInLineAlert:r}},E="returnOrdersStepSession",be=({onSuccess:t,onError:e,handleSetInLineAlert:r,orderData:c})=>{const[u,g]=f(c),[v,h]=f({orderUid:"",contactEmail:""}),[k,U]=f(0),[s,D]=f("products"),[S,C]=f(!1),[i,o]=f(JSON.parse(sessionStorage.getItem(E))??[]),[l,q]=f([]),[x,O]=f({taxIncluded:!1,taxExcluded:!1}),m=V([]);m.current.length!==i.length&&(m.current=i.map((a,p)=>m.current[p]||G())),L(()=>{const a=J.on("order/data",p=>{g(p),h({orderUid:p.id??"",contactEmail:(p==null?void 0:p.email)??""})},{eager:!0});return()=>{a==null||a.off()}},[]),L(()=>{ie().then(a=>{a&&O(ae(a==null?void 0:a.shoppingCartDisplayPrice))}).finally(()=>{C(!1)})},[]),L(()=>{ne("RMA_ITEM").then(a=>{a.length&&q(a)})},[]);const P=T(a=>{o(p=>{const _=p.some(b=>{var R,I;return((R=b==null?void 0:b.product)==null?void 0:R.uid)===((I=a==null?void 0:a.product)==null?void 0:I.uid)})?p.filter(b=>{var R,I;return((R=b==null?void 0:b.product)==null?void 0:R.uid)!==((I=a==null?void 0:a.product)==null?void 0:I.uid)}):[...p,a];return sessionStorage.setItem(E,JSON.stringify(_)),_})},[]),d=T(a=>{D(a)},[]),M=T(()=>{i.length&&d("attributes")},[d,i.length]),$=T(a=>{U(a)},[]),F=T(async(a,p)=>{if(!p)return null;C(!0);const B=[];m.current.length&&m.current.forEach(({current:_})=>{const b=_==null?void 0:_.name.replace(/_\d+$/,""),R=pe(re(_));B.push({orderItemUid:b,quantityToReturn:1,selectedCustomAttributes:me(R)})})},[d,e,t,r,v]);return{orderReturnInfo:v,order:u,quantity:k,formsRef:m,taxConfig:x,attributesList:l,steps:s,loading:S,selectedProductList:i,handleSelectedProductList:P,handleSetQuantity:$,handleChangeStep:d,onSubmit:F,moveToAttributesStep:M}},Ee=({orderData:t,slots:e,className:r,onSuccess:c,onError:u,routeReturnSuccess:g,showConfigurableOptions:v})=>{const h=ce({headerText:"Order.CreateReturn.headerText",successTitle:"Order.CreateReturn.success.title",successMessage:"Order.CreateReturn.success.message",sender:"Order.CreateReturn.giftCard.sender",recipient:"Order.CreateReturn.giftCard.recipient",message:"Order.CreateReturn.giftCard.message",outOfStock:"Order.CreateReturn.stockStatus.outOfStock",nextStep:"Order.CreateReturn.buttons.nextStep",backStep:"Order.CreateReturn.buttons.backStep",submit:"Order.CreateReturn.buttons.submit",backStore:"Order.CreateReturn.buttons.backStore"}),{inLineAlertProps:k,handleSetInLineAlert:U}=Se(),{quantity:s,formsRef:D,taxConfig:S,attributesList:C,steps:i,loading:o,selectedProductList:l,handleSelectedProductList:q,handleSetQuantity:x,handleChangeStep:O,onSubmit:m,moveToAttributesStep:P}=be({orderData:t,onSuccess:c,onError:u,handleSetInLineAlert:U}),d={products:n(se,{quantity:s,slots:e,translations:h,loading:o,taxConfig:S,selectedProductList:l,handleSelectedProductList:q,showConfigurableOptions:v,handleSetQuantity:x,handleChangeStep:O,moveToAttributesStep:P}),attributes:n(he,{slots:e,formsRef:D,loading:o,fieldsConfig:C,selectedProductList:l,handleChangeStep:O,translations:h,onSubmit:m}),success:n(de,{translations:h,routeReturnSuccess:g}),error:null};return w("div",{className:j(["order-create-return",r]),children:[n(Q,{title:h.headerText}),k.heading?n(z,{className:"order-create-return_notification",variant:"secondary","data-testid":"orderCreateReturnNotification",...k}):null,d[i]]})};export{Ee as CreateReturn,Ee as default};
