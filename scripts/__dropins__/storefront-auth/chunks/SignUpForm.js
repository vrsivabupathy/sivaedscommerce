import{jsx as o,jsxs as A}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as Fe,classes as _e}from"@dropins/tools/lib.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/recaptcha.js";import{g as Pe,c as we,a as Ne}from"./createCustomerAddress.js";import{useState as d,useEffect as Le,useCallback as q}from"@dropins/tools/preact-hooks.js";import{s as ae,b as ye}from"./simplifyTransformAttributesForm.js";import{v as Ue,u as Te,a as xe}from"./usePasswordValidationMessage.js";import{a as Ee}from"./getCustomerToken.js";import{p as me,E as ne}from"./getStoreConfig.js";import{c as I,g as Me,u as Se,F as Ce,B as ue}from"./UpdatePasswordForm.js";import{c as ve}from"./transform-attributes-form.js";import{Header as Ae,InLineAlert as qe,InputPassword as ce,Field as R,Checkbox as ee}from"@dropins/tools/components.js";/* empty css                       */import{S as Ke}from"./SkeletonLoader.js";import{E as Be}from"./EmailConfirmationForm.js";import{useText as je}from"@dropins/tools/i18n.js";const le=(m,e)=>e!=null&&e.length?m.map(r=>{var n;const t=(n=e.find(({code:a})=>a===r.code))==null?void 0:n.defaultValue;return t?{...r,defaultValue:t}:r}):m,Ge=({inputsDefaultValueSet:m,fieldsConfigForApiVersion1:e,apiVersion2:r})=>{const[t,n]=d([]);return Le(()=>{(async()=>{if(r){const s=await Pe("customer_account_create");if(s!=null&&s.length)if(m!=null&&m.length){const f=le(s,m);n(f)}else n(s)}else{const s=ae(ye),f=ae(e),F=le(s,m);n(e&&e.length?f:F)}})()},[r,e,m]),{fieldsListConfigs:t}},He=(m,e)=>{const r=["date_of_birth","dob","email","firstname","gender","is_subscribed","lastname","middlename","password","prefix","suffix","taxvat"],t=ve(m,"snakeCase",{firstName:"firstname",lastName:"lastname"});if(!e)return{...t,...t!=null&&t.gender?{gender:Number(t==null?void 0:t.gender)}:{}};const n={},a=[];return Object.keys(t).forEach(s=>{r.includes(s)?n[s]=s.includes("gender")?Number(t[s]):t[s]:a.push({attribute_code:s,value:t[s]})}),a.length>0&&(n.custom_attributes=a),n},Ie=({requireRetypePassword:m,addressesData:e,translations:r,isEmailConfirmationRequired:t,apiVersion2:n=!0,passwordConfigs:a,isAutoSignInEnabled:s,routeRedirectOnSignIn:f,routeSignIn:F,onErrorCallback:w,onSuccessCallback:c,setActiveComponent:g,handleSetInLineAlertProps:h,routeRedirectOnEmailConfirmationClose:T})=>{const[N,V]=d(""),[p,i]=d(""),[l,x]=d(""),[K,_]=d(!1),[B,E]=d({userName:"",status:!1}),[L,M]=d(""),[W,$]=d(!1),[j,P]=d(!1),[S,G]=d(!0),J=q(u=>{V(u),i(u?L===u?"":r.passwordMismatch:r.requiredFieldError)},[r,L]),O=q(({target:u})=>{G(u.checked)},[]),Q=q(()=>{if(I(g)){g("signInForm");return}I(F)&&(window.location.href=F())},[g,F]),X=q(u=>{M(u)},[]),Y=q(()=>{h(),M(""),I(T)?window.location.href=T():(_(!1),g==null||g("signInForm"))},[h,T,g]),C=()=>{$(!0),P(!1)};return{confirmPassword:N,confirmPasswordMessage:p,isKeepMeLogged:S,userEmail:l,showEmailConfirmationForm:K,isSuccessful:B,isClickSubmit:W,signUpPasswordValue:L,isLoading:j,onSubmitSignUp:async(u,k)=>{var te,ie,se;if(h(),i(""),P(!0),!k){C(),!N&&i(r.requiredFieldError);return}if(m&&(p.length||L!==N)){C(),i(N.length?r.passwordMismatch:r.requiredFieldError);return}const de=n?"createCustomerV2":"createCustomer",{confirmPasswordField:Ve,...re}=Me(u.target),{email:z,password:v,is_subscribed:fe}=re,ge=(a==null?void 0:a.requiredCharacterClasses)||0,he=(a==null?void 0:a.minLength)||1;if(!Ue(v,ge)||he>(v==null?void 0:v.length)){C();return}const pe=He({...re,is_subscribed:!!fe||!1},n),{data:y,errors:U}=await we(pe,n),H=((ie=(te=y==null?void 0:y.createCustomer)==null?void 0:te.customer)==null?void 0:ie.firstname)||"";if(U&&(U!=null&&U.length))h==null||h({type:"error",text:U[0].message}),w==null||w(U),me(ne.CREATE_ACCOUNT_EVENT,{updateProfile:!1}),x(z);else{const D={email:"",...y==null?void 0:y[de]};if(me(ne.CREATE_ACCOUNT_EVENT,{email:D==null?void 0:D.email,updateProfile:!0}),t||!s){if(c==null||c({userName:H,status:!0}),t){(se=u.target)==null||se.reset(),M(""),_(!0),x(z),P(!1);return}if(!s){P(!1),E({userName:H,status:!0});return}}const b=await Ee({email:z,password:v,translations:r,handleSetInLineAlertProps:h,onErrorCallback:w});if(b!=null&&b.userName){if(e!=null&&e.length)for(const oe of e)try{await Ne(oe)}catch(be){console.error(r.failedCreateCustomerAddress,oe,be)}I(f)?window.location.href=f():(c==null||c({userName:b==null?void 0:b.userName,status:!0}),E({userName:b==null?void 0:b.userName,status:!0}))}else c==null||c({userName:H,status:!0}),E({userName:H,status:!0})}P(!1)},signInButton:Q,handleSetSignUpPasswordValue:X,onKeepMeLoggedChange:O,handleHideEmailConfirmationForm:Y,handleConfirmPasswordChange:J}},or=({requireRetypePassword:m=!1,addressesData:e,formSize:r="default",inputsDefaultValueSet:t,fieldsConfigForApiVersion1:n,apiVersion2:a=!0,isAutoSignInEnabled:s=!0,displayTermsOfUseCheckbox:f=!1,displayNewsletterCheckbox:F=!1,hideCloseBtnOnEmailConfirmation:w=!1,routeRedirectOnEmailConfirmationClose:c,routeRedirectOnSignIn:g,routeSignIn:h,onErrorCallback:T,onSuccessCallback:N,setActiveComponent:V,slots:p})=>{const i=je({title:"Auth.SignUpForm.title",buttonPrimary:"Auth.SignUpForm.buttonPrimary",buttonSecondary:"Auth.SignUpForm.buttonSecondary",privacyPolicyDefaultText:"Auth.SignUpForm.privacyPolicyDefaultText",subscribedDefaultText:"Auth.SignUpForm.subscribedDefaultText",keepMeLoggedText:"Auth.SignUpForm.keepMeLoggedText",customerTokenErrorMessage:"Auth.Api.customerTokenErrorMessage",failedCreateCustomerAddress:"Auth.SignUpForm.failedCreateCustomerAddress",placeholder:"Auth.InputPassword.placeholder",floatingLabel:"Auth.InputPassword.floatingLabel",requiredFieldError:"Auth.FormText.requiredFieldError",confirmPasswordPlaceholder:"Auth.SignUpForm.confirmPassword.placeholder",confirmPasswordFloatingLabel:"Auth.SignUpForm.confirmPassword.floatingLabel",passwordMismatch:"Auth.SignUpForm.confirmPassword.passwordMismatch"}),{passwordConfigs:l,isEmailConfirmationRequired:x}=Te(),{fieldsListConfigs:K}=Ge({fieldsConfigForApiVersion1:n,apiVersion2:a,inputsDefaultValueSet:t}),{inLineAlertProps:_,handleSetInLineAlertProps:B}=Se(),{confirmPassword:E,confirmPasswordMessage:L,isKeepMeLogged:M,userEmail:W,showEmailConfirmationForm:$,isSuccessful:j,isClickSubmit:P,signUpPasswordValue:S,isLoading:G,onSubmitSignUp:J,signInButton:O,handleSetSignUpPasswordValue:Q,onKeepMeLoggedChange:X,handleHideEmailConfirmationForm:Y,handleConfirmPasswordChange:C}=Ie({requireRetypePassword:m,addressesData:e,translations:i,isEmailConfirmationRequired:x,apiVersion2:a,passwordConfigs:l,isAutoSignInEnabled:s,routeRedirectOnSignIn:g,routeSignIn:h,onErrorCallback:T,onSuccessCallback:N,setActiveComponent:V,handleSetInLineAlertProps:B,routeRedirectOnEmailConfirmationClose:c}),{isValidUniqueSymbols:Z,defaultLengthMessage:u}=xe({password:S,isClickSubmit:P,passwordConfigs:l}),k=!x&&(e==null?void 0:e.length);return!K.length&&a?o("div",{className:`auth-sign-up-form auth-sign-up-form--${r} skeleton-loader`,"data-testid":"SignUpForm",children:o(Ke,{activeSkeleton:"signUpForm"})}):j.status&&(p!=null&&p.SuccessNotification)?o(Fe,{"data-testid":"successNotificationTestId",name:"SuccessNotification",slot:p==null?void 0:p.SuccessNotification,context:{isSuccessful:j}}):$?o(Be,{formSize:r,userEmail:W,inLineAlertProps:_,hideCloseBtnOnEmailConfirmation:w,handleSetInLineAlertProps:B,onPrimaryButtonClick:Y}):A("div",{className:_e(["auth-sign-up-form",`auth-sign-up-form--${r}`]),"data-testid":"SignUpForm",children:[o(Ae,{title:i.title,divider:!1,className:"auth-sign-up-form__title"}),_.text?o(qe,{className:"auth-sign-up-form__notification",type:_.type,variant:"secondary",heading:_.text,icon:_.icon}):null,A(Ce,{onSubmit:J,className:"auth-sign-up-form__form",loading:G,name:"signUp_form",fieldsConfig:K,children:[A(ce,{validateLengthConfig:u,className:"auth-sign-up-form__form__field",autoComplete:"current-password",name:"password",minLength:l==null?void 0:l.minLength,errorMessage:Z==="error"||(u==null?void 0:u.status)==="error"||P&&S.length<=0?i.requiredFieldError:void 0,defaultValue:S,uniqueSymbolsStatus:Z,requiredCharacterClasses:l==null?void 0:l.requiredCharacterClasses,onValue:Q,placeholder:i.placeholder,floatingLabel:i.floatingLabel,children:[m?o("div",{className:"auth-sign-up-form__form__confirm-wrapper",children:o(ce,{className:"auth-sign-up-form__form__field auth-sign-up-form__form__field--confirm-password",autoComplete:"confirmPassword",name:"confirmPasswordField",placeholder:i.confirmPasswordPlaceholder,floatingLabel:i.confirmPasswordFloatingLabel,errorMessage:L,defaultValue:E,onValue:C})}):null,k?o("div",{className:"auth-sign-up-form__automatic-login","data-testid":"automaticLogin",children:o(R,{children:o(ee,{name:"",placeholder:i.keepMeLoggedText,label:i.keepMeLoggedText,checked:M,onChange:X})})}):null]}),F||f?A("div",{className:"auth-sign-up-form__item auth-sign-up-form__checkbox",children:[F?o(R,{children:o(ee,{"data-testid":"isSubscribed",name:"is_subscribed",placeholder:i.subscribedDefaultText,label:i.subscribedDefaultText})}):null,f?o(R,{children:o(ee,{"data-testid":"privacyPolicy",name:"privacyPolicy",placeholder:i.privacyPolicyDefaultText,label:i.privacyPolicyDefaultText})}):null]}):null,A("div",{className:"auth-sign-up-form-buttons",children:[o(ue,{type:"button",variant:"tertiary",style:{padding:0},buttonText:i.buttonSecondary,enableLoader:!1,onClick:O}),o(ue,{type:"submit",buttonText:i.buttonPrimary,variant:"primary",enableLoader:G})]})]}),o("div",{id:"createCustomerV2"})]})};export{or as S};
